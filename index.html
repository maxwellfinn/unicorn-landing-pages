<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Unicorn AI | Marketing Platform</title>
  <link rel="icon" type="image/png" href="/icon.png">
  <link rel="apple-touch-icon" href="/icon.png">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      /* Brand Colors - Blue Gradient from Icon */
      --primary-blue: #3B9FD8;
      --primary-blue-dark: #2878A8;
      --primary-blue-light: #5BB5E8;
      --primary-blue-lighter: #00C4E8;

      /* Secondary Blues - From Icon Gradient */
      --secondary-blue: #5BA3C8;
      --secondary-blue-light: #7DBDDC;
      --tertiary-blue: #3A7A9E;

      /* Accent Colors - Using Blues */
      --accent: #00C4E8;
      --accent-dark: #3B9FD8;
      --accent-light: #5BB5E8;
      --accent-muted: rgba(59, 159, 216, 0.15);

      /* Neutral Colors */
      --dark-gray: #3D4246;
      --text-dark: #2D3436;
      --text-medium: #636E72;
      --text-light: #B2BEC3;

      /* Backgrounds */
      --bg-white: #FFFFFF;
      --bg-light: #F8FAFB;
      --bg-card: #FFFFFF;
      --bg-sidebar: #1a2634;
      --bg-sidebar-hover: #243342;
      --bg-sidebar-active: #2d3e4f;

      /* Borders */
      --border-light: #E8EDEF;
      --border-card: rgba(0, 0, 0, 0.06);

      /* Status Colors */
      --success: #3B9FD8;
      --success-light: rgba(59, 159, 216, 0.1);
      --warning: #FDCB6E;
      --warning-light: rgba(253, 203, 110, 0.1);
      --error: #E17055;
      --error-light: rgba(225, 112, 85, 0.1);
      --danger-color: #dc2626;

      /* Shadows */
      --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.04);
      --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.08);
      --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.12);
      --shadow-card: 0 1px 3px rgba(0, 0, 0, 0.05), 0 4px 12px rgba(0, 0, 0, 0.04);
      --shadow-card-hover: 0 4px 20px rgba(0, 0, 0, 0.1);

      /* Sidebar */
      --sidebar-width: 72px;
      --sidebar-width-expanded: 260px;

      /* Border Radius */
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 16px;
      --radius-xl: 20px;

      /* Transitions */
      --transition-fast: 0.15s ease;
      --transition-normal: 0.25s ease;
      --transition-slow: 0.4s ease;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg-light);
      color: var(--text-dark);
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* ============================================
       LOADING SCREEN
    ============================================ */
    .loading-screen {
      position: fixed;
      inset: 0;
      background: linear-gradient(135deg, #f8fafb 0%, #e8f4f8 100%);
      z-index: 9999;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      transition: opacity 0.5s ease, visibility 0.5s ease;
    }

    .loading-screen.hidden {
      opacity: 0;
      visibility: hidden;
      pointer-events: none;
    }

    .unicorn-loader {
      width: 200px;
      height: 200px;
      position: relative;
    }

    .unicorn-character {
      position: absolute;
      width: 120px;
      height: 100px;
      left: 50%;
      transform: translateX(-50%);
      top: 20px;
    }

    .unicorn-body {
      position: absolute;
      width: 60px;
      height: 45px;
      background: linear-gradient(135deg, #fff 0%, #f0f0f0 100%);
      border-radius: 30px 30px 25px 25px;
      top: 35px;
      left: 30px;
      box-shadow: inset -5px -5px 10px rgba(0,0,0,0.05);
    }

    .unicorn-head {
      position: absolute;
      width: 35px;
      height: 32px;
      background: linear-gradient(135deg, #fff 0%, #f5f5f5 100%);
      border-radius: 50% 50% 45% 45%;
      top: 20px;
      left: 65px;
    }

    .unicorn-horn {
      position: absolute;
      width: 0;
      height: 0;
      border-left: 6px solid transparent;
      border-right: 6px solid transparent;
      border-bottom: 25px solid var(--primary-blue);
      top: -2px;
      left: 75px;
      transform: rotate(15deg);
      animation: hornGlow 1.5s ease-in-out infinite;
    }

    @keyframes hornGlow {
      0%, 100% { filter: drop-shadow(0 0 3px var(--primary-blue)); }
      50% { filter: drop-shadow(0 0 8px var(--primary-blue-light)); }
    }

    .unicorn-ear {
      position: absolute;
      width: 12px;
      height: 16px;
      background: #fff;
      border-radius: 50% 50% 0 0;
      top: 12px;
      left: 68px;
      transform: rotate(-15deg);
    }

    .unicorn-mane {
      position: absolute;
      top: 25px;
      left: 55px;
    }

    .mane-strand {
      position: absolute;
      width: 8px;
      height: 20px;
      border-radius: 4px;
      animation: maneWave 1s ease-in-out infinite;
    }

    .mane-strand:nth-child(1) { background: var(--primary-blue); left: 0; }
    .mane-strand:nth-child(2) { background: #5bb5e8; left: 6px; animation-delay: 0.1s; height: 25px; top: -3px; }
    .mane-strand:nth-child(3) { background: #5BA3C8; left: 12px; animation-delay: 0.2s; height: 22px; top: -1px; }

    @keyframes maneWave {
      0%, 100% { transform: rotate(-5deg); }
      50% { transform: rotate(5deg); }
    }

    .unicorn-eye {
      position: absolute;
      width: 6px;
      height: 6px;
      background: var(--dark-gray);
      border-radius: 50%;
      top: 32px;
      left: 85px;
      animation: blink 3s ease-in-out infinite;
    }

    @keyframes blink {
      0%, 90%, 100% { transform: scaleY(1); }
      95% { transform: scaleY(0.1); }
    }

    .unicorn-snout {
      position: absolute;
      width: 4px;
      height: 3px;
      background: #ffb6c1;
      border-radius: 50%;
      top: 42px;
      left: 92px;
    }

    .unicorn-leg-front {
      position: absolute;
      width: 10px;
      height: 20px;
      background: #fff;
      border-radius: 5px;
      top: 70px;
    }

    .unicorn-leg-front.left {
      left: 45px;
      animation: typeLeft 0.3s ease-in-out infinite;
    }

    .unicorn-leg-front.right {
      left: 58px;
      animation: typeRight 0.3s ease-in-out infinite 0.15s;
    }

    @keyframes typeLeft {
      0%, 100% { transform: translateY(0) rotate(-5deg); }
      50% { transform: translateY(-8px) rotate(-15deg); }
    }

    @keyframes typeRight {
      0%, 100% { transform: translateY(0) rotate(5deg); }
      50% { transform: translateY(-8px) rotate(15deg); }
    }

    .unicorn-leg-back {
      position: absolute;
      width: 10px;
      height: 18px;
      background: #f5f5f5;
      border-radius: 5px;
      top: 72px;
    }

    .unicorn-leg-back.left { left: 32px; }
    .unicorn-leg-back.right { left: 75px; }

    .unicorn-tail {
      position: absolute;
      top: 50px;
      left: 15px;
    }

    .tail-strand {
      position: absolute;
      width: 6px;
      height: 25px;
      border-radius: 3px;
      animation: tailWag 1.2s ease-in-out infinite;
      transform-origin: top;
    }

    .tail-strand:nth-child(1) { background: var(--primary-blue); left: 0; }
    .tail-strand:nth-child(2) { background: #5bb5e8; left: 5px; animation-delay: 0.1s; }
    .tail-strand:nth-child(3) { background: #5BA3C8; left: 10px; animation-delay: 0.2s; }

    @keyframes tailWag {
      0%, 100% { transform: rotate(-15deg); }
      50% { transform: rotate(15deg); }
    }

    .laptop {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
    }

    .laptop-screen {
      width: 80px;
      height: 50px;
      background: linear-gradient(135deg, #2d3436 0%, #3d4246 100%);
      border-radius: 4px 4px 0 0;
      border: 3px solid #636e72;
      position: relative;
      overflow: hidden;
    }

    .laptop-screen::before {
      content: '';
      position: absolute;
      inset: 4px;
      background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
      border-radius: 2px;
    }

    .code-line {
      position: absolute;
      height: 3px;
      border-radius: 1px;
      animation: codePulse 0.8s ease-in-out infinite;
    }

    .code-line:nth-child(1) { width: 25px; background: var(--primary-blue); top: 10px; left: 8px; }
    .code-line:nth-child(2) { width: 35px; background: #5BA3C8; top: 17px; left: 8px; animation-delay: 0.2s; }
    .code-line:nth-child(3) { width: 20px; background: #FDCB6E; top: 24px; left: 8px; animation-delay: 0.4s; }
    .code-line:nth-child(4) { width: 30px; background: var(--primary-blue-light); top: 31px; left: 8px; animation-delay: 0.6s; }

    @keyframes codePulse {
      0%, 100% { opacity: 0.6; }
      50% { opacity: 1; }
    }

    .laptop-base {
      width: 90px;
      height: 6px;
      background: linear-gradient(to bottom, #b2bec3, #636e72);
      border-radius: 0 0 4px 4px;
      margin-left: -5px;
    }

    .loading-text {
      margin-top: 30px;
      font-size: 1rem;
      font-weight: 600;
      color: var(--text-medium);
    }

    .loading-dots::after {
      content: '';
      animation: dots 1.5s steps(4, end) infinite;
    }

    @keyframes dots {
      0% { content: ''; }
      25% { content: '.'; }
      50% { content: '..'; }
      75% { content: '...'; }
    }

    /* ============================================
       INTERACTIVE BACKGROUND
    ============================================ */
    .bg-interactive {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 0;
      overflow: hidden;
    }

    .bg-gradient-orb {
      position: absolute;
      border-radius: 50%;
      filter: blur(80px);
      opacity: 0.4;
      transition: transform 0.3s ease-out;
    }

    .orb-1 {
      width: 500px;
      height: 500px;
      background: linear-gradient(135deg, rgba(59, 159, 216, 0.25) 0%, rgba(0, 184, 148, 0.15) 100%);
      top: -150px;
      right: -100px;
    }

    .orb-2 {
      width: 400px;
      height: 400px;
      background: linear-gradient(135deg, rgba(0, 184, 148, 0.2) 0%, rgba(59, 159, 216, 0.1) 100%);
      bottom: -100px;
      left: 200px;
    }

    .cursor-glow {
      position: fixed;
      width: 350px;
      height: 350px;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(59, 159, 216, 0.12) 0%, transparent 70%);
      pointer-events: none;
      z-index: 1;
      transform: translate(-50%, -50%);
      transition: opacity 0.3s ease;
      opacity: 0;
    }

    .cursor-glow.active {
      opacity: 1;
    }

    /* ============================================
       LAYOUT - SIDEBAR + MAIN
    ============================================ */
    .app-layout {
      display: flex;
      min-height: 100vh;
      position: relative;
      z-index: 2;
    }

    /* ============================================
       NEW SIDEBAR - Icon-based, Collapsible
    ============================================ */
    .sidebar {
      width: var(--sidebar-width);
      background: var(--bg-sidebar);
      color: #fff;
      display: flex;
      flex-direction: column;
      position: fixed;
      left: 0;
      top: 0;
      bottom: 0;
      z-index: 100;
      transition: width var(--transition-normal);
      overflow: hidden;
    }

    .sidebar:hover,
    .sidebar.expanded {
      width: var(--sidebar-width-expanded);
    }

    .sidebar-header {
      padding: 1rem;
      border-bottom: 1px solid rgba(255,255,255,0.06);
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 64px;
    }

    .sidebar:hover .sidebar-header,
    .sidebar.expanded .sidebar-header {
      justify-content: flex-start;
      padding: 1rem 1.25rem;
    }

    .sidebar-logo {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      white-space: nowrap;
    }

    .sidebar-logo-icon {
      width: 40px;
      height: 40px;
      border-radius: var(--radius-md);
      background: linear-gradient(135deg, var(--primary-blue) 0%, var(--accent) 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .sidebar-logo-icon svg {
      width: 24px;
      height: 24px;
      color: var(--bg-sidebar);
    }

    .sidebar-logo-icon-img {
      width: 36px;
      height: 36px;
      object-fit: contain;
      flex-shrink: 0;
    }

    .sidebar-logo-text {
      font-size: 1rem;
      font-weight: 700;
      color: #fff;
      opacity: 0;
      transform: translateX(-10px);
      transition: all var(--transition-normal);
    }

    .sidebar:hover .sidebar-logo-text,
    .sidebar.expanded .sidebar-logo-text {
      opacity: 1;
      transform: translateX(0);
    }

    .sidebar-nav {
      flex: 1;
      padding: 0.75rem 0;
      overflow-y: auto;
      overflow-x: hidden;
    }

    .nav-section {
      padding: 0 0.5rem;
      margin-bottom: 0.5rem;
    }

    .nav-section-title {
      font-size: 0.6rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: rgba(255,255,255,0.3);
      padding: 0.75rem 1rem;
      margin-bottom: 0.25rem;
      white-space: nowrap;
      opacity: 0;
      transition: opacity var(--transition-normal);
    }

    .sidebar:hover .nav-section-title,
    .sidebar.expanded .nav-section-title {
      opacity: 1;
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 0.875rem;
      padding: 0.75rem 1rem;
      border-radius: var(--radius-md);
      color: rgba(255,255,255,0.6);
      text-decoration: none;
      font-size: 0.875rem;
      font-weight: 500;
      cursor: pointer;
      transition: all var(--transition-fast);
      margin: 0.125rem 0;
      position: relative;
      white-space: nowrap;
    }

    .nav-item:hover {
      background: var(--bg-sidebar-hover);
      color: #fff;
    }

    .nav-item.active {
      background: var(--accent);
      color: var(--bg-sidebar);
    }

    .nav-item.active:hover {
      background: var(--accent-dark);
    }

    .nav-item svg {
      width: 22px;
      height: 22px;
      flex-shrink: 0;
    }

    .nav-item-label {
      opacity: 0;
      transform: translateX(-10px);
      transition: all var(--transition-normal);
    }

    .sidebar:hover .nav-item-label,
    .sidebar.expanded .nav-item-label {
      opacity: 1;
      transform: translateX(0);
    }

    .nav-item .badge {
      position: absolute;
      top: 50%;
      right: 0.75rem;
      transform: translateY(-50%);
      background: rgba(255,255,255,0.15);
      color: rgba(255,255,255,0.8);
      font-size: 0.65rem;
      font-weight: 700;
      padding: 0.15rem 0.4rem;
      border-radius: 8px;
      opacity: 0;
      transition: opacity var(--transition-normal);
    }

    .sidebar:hover .nav-item .badge,
    .sidebar.expanded .nav-item .badge {
      opacity: 1;
    }

    .nav-item.active .badge {
      background: rgba(0,0,0,0.2);
      color: var(--bg-sidebar);
    }

    /* Badge dot for collapsed sidebar */
    .nav-item .badge-dot {
      position: absolute;
      top: 8px;
      right: 8px;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--accent);
      transition: opacity var(--transition-normal);
    }

    .sidebar:hover .nav-item .badge-dot,
    .sidebar.expanded .nav-item .badge-dot {
      opacity: 0;
    }

    .nav-divider {
      height: 1px;
      background: rgba(255,255,255,0.06);
      margin: 0.75rem 1rem;
    }

    .sidebar-footer {
      padding: 0.75rem 0.5rem;
      border-top: 1px solid rgba(255,255,255,0.06);
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.5rem;
      border-radius: var(--radius-md);
      cursor: pointer;
      transition: background var(--transition-fast);
    }

    .user-info:hover {
      background: var(--bg-sidebar-hover);
    }

    .user-avatar {
      width: 36px;
      height: 36px;
      border-radius: var(--radius-md);
      background: linear-gradient(135deg, var(--primary-blue) 0%, var(--accent) 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 0.875rem;
      color: var(--bg-sidebar);
      flex-shrink: 0;
    }

    .user-details {
      flex: 1;
      min-width: 0;
      opacity: 0;
      transform: translateX(-10px);
      transition: all var(--transition-normal);
    }

    .sidebar:hover .user-details,
    .sidebar.expanded .user-details {
      opacity: 1;
      transform: translateX(0);
    }

    .user-name {
      font-size: 0.8rem;
      font-weight: 600;
      color: #fff;
      white-space: nowrap;
    }

    .user-role {
      font-size: 0.65rem;
      color: rgba(255,255,255,0.5);
    }

    /* ============================================
       MAIN CONTENT
    ============================================ */
    .main-content {
      flex: 1;
      margin-left: var(--sidebar-width);
      min-height: 100vh;
      transition: margin-left var(--transition-normal);
    }

    .main-header {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--border-light);
      padding: 1rem 2rem;
      position: sticky;
      top: 0;
      z-index: 50;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .header-left {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }

    .header-greeting {
      font-size: 0.8rem;
      color: var(--text-medium);
      font-weight: 500;
    }

    .page-title {
      font-size: 1.5rem;
      font-weight: 800;
      color: var(--text-dark);
      letter-spacing: -0.02em;
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .header-actions {
      display: flex;
      gap: 0.5rem;
    }

    .main-body {
      padding: 1.5rem 2rem 2rem;
    }

    /* ============================================
       NEW DASHBOARD COMPONENTS
    ============================================ */

    /* Metrics Grid */
    .metrics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .metric-card {
      background: var(--bg-card);
      border: 1px solid var(--border-card);
      border-radius: var(--radius-lg);
      padding: 1.25rem;
      position: relative;
      overflow: hidden;
      transition: all var(--transition-normal);
    }

    .metric-card::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, transparent 0%, var(--accent-muted) 100%);
      opacity: 0;
      transition: opacity var(--transition-normal);
    }

    .metric-card:hover {
      transform: translateY(-4px);
      border-color: var(--accent);
      box-shadow: var(--shadow-card-hover), 0 0 0 1px var(--accent-muted);
    }

    .metric-card:hover::before {
      opacity: 1;
    }

    .metric-card-header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      margin-bottom: 1rem;
      position: relative;
      z-index: 1;
    }

    .metric-icon {
      width: 40px;
      height: 40px;
      border-radius: var(--radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--bg-light);
    }

    .metric-icon svg {
      width: 20px;
      height: 20px;
      color: var(--text-medium);
    }

    .metric-icon.blue { background: rgba(59, 159, 216, 0.1); }
    .metric-icon.blue svg { color: var(--primary-blue); }
    .metric-icon.green { background: var(--success-light); }
    .metric-icon.green svg { color: var(--success); }
    .metric-icon.cyan { background: var(--accent-muted); }
    .metric-icon.cyan svg { color: var(--accent-dark); }
    .metric-icon.orange { background: var(--warning-light); }
    .metric-icon.orange svg { color: var(--warning); }

    .metric-trend {
      display: flex;
      align-items: center;
      gap: 0.25rem;
      font-size: 0.7rem;
      font-weight: 600;
      padding: 0.25rem 0.5rem;
      border-radius: 6px;
    }

    .metric-trend.up {
      background: var(--success-light);
      color: var(--success);
    }

    .metric-trend.down {
      background: var(--error-light);
      color: var(--error);
    }

    .metric-trend svg {
      width: 12px;
      height: 12px;
    }

    .metric-card-body {
      position: relative;
      z-index: 1;
    }

    .metric-label {
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--text-medium);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 0.5rem;
    }

    .metric-value {
      font-size: 2rem;
      font-weight: 800;
      color: var(--text-dark);
      line-height: 1;
      letter-spacing: -0.02em;
    }

    .metric-sublabel {
      font-size: 0.75rem;
      color: var(--text-light);
      margin-top: 0.5rem;
    }

    /* Quick Actions Grid */
    .quick-actions-section {
      margin-bottom: 1.5rem;
    }

    .section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1rem;
    }

    .section-title {
      font-size: 1rem;
      font-weight: 700;
      color: var(--text-dark);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .section-title-icon {
      width: 20px;
      height: 20px;
      color: var(--text-medium);
    }

    .quick-actions-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 0.75rem;
    }

    .quick-action-card {
      background: var(--bg-card);
      border: 1px solid var(--border-card);
      border-radius: var(--radius-lg);
      padding: 1.25rem 1rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      cursor: pointer;
      transition: all var(--transition-normal);
    }

    .quick-action-card:hover {
      transform: translateY(-2px);
      border-color: var(--primary-blue);
      box-shadow: var(--shadow-card-hover);
    }

    .quick-action-card.accent:hover {
      border-color: var(--accent);
    }

    .quick-action-icon {
      width: 44px;
      height: 44px;
      border-radius: var(--radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 0.75rem;
      background: var(--bg-light);
      transition: all var(--transition-normal);
    }

    .quick-action-icon svg {
      width: 22px;
      height: 22px;
      color: var(--text-medium);
    }

    .quick-action-card:hover .quick-action-icon {
      background: var(--primary-blue);
    }

    .quick-action-card:hover .quick-action-icon svg {
      color: white;
    }

    .quick-action-card.accent:hover .quick-action-icon {
      background: var(--accent);
    }

    .quick-action-card.accent:hover .quick-action-icon svg {
      color: var(--bg-sidebar);
    }

    .quick-action-label {
      font-size: 0.8rem;
      font-weight: 600;
      color: var(--text-dark);
    }

    .quick-action-sublabel {
      font-size: 0.7rem;
      color: var(--text-light);
      margin-top: 0.25rem;
    }

    /* Dashboard Grid Layout */
    .dashboard-grid {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 1.5rem;
    }

    @media (max-width: 1200px) {
      .dashboard-grid {
        grid-template-columns: 1fr;
      }
    }

    /* Activity Feed */
    .activity-card {
      background: var(--bg-card);
      border: 1px solid var(--border-card);
      border-radius: var(--radius-lg);
      overflow: hidden;
    }

    .activity-card-header {
      padding: 1rem 1.25rem;
      border-bottom: 1px solid var(--border-light);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .activity-card-title {
      font-size: 0.9rem;
      font-weight: 700;
      color: var(--text-dark);
    }

    .activity-list {
      padding: 0.5rem 0;
      max-height: 320px;
      overflow-y: auto;
    }

    .activity-item {
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
      padding: 0.75rem 1.25rem;
      transition: background var(--transition-fast);
    }

    .activity-item:hover {
      background: var(--bg-light);
    }

    .activity-icon {
      width: 32px;
      height: 32px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      background: var(--bg-light);
    }

    .activity-icon svg {
      width: 16px;
      height: 16px;
      color: var(--text-medium);
    }

    .activity-icon.success { background: var(--success-light); }
    .activity-icon.success svg { color: var(--success); }
    .activity-icon.blue { background: rgba(59, 159, 216, 0.1); }
    .activity-icon.blue svg { color: var(--primary-blue); }
    .activity-icon.cyan { background: var(--accent-muted); }
    .activity-icon.cyan svg { color: var(--accent-dark); }

    .activity-card-body {
      padding: 0;
      max-height: 400px;
      overflow-y: auto;
    }

    .activity-content {
      flex: 1;
      min-width: 0;
    }

    .activity-title {
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--text-dark);
      margin-bottom: 0.125rem;
    }

    .activity-meta {
      font-size: 0.7rem;
      color: var(--text-light);
    }

    .activity-status {
      font-size: 0.65rem;
      font-weight: 600;
      padding: 0.25rem 0.5rem;
      border-radius: 6px;
      text-transform: capitalize;
    }

    .activity-status.status-pending {
      background: var(--warning-light);
      color: #B8860B;
    }

    .activity-status.status-complete,
    .activity-status.status-completed {
      background: var(--success-light);
      color: var(--success);
    }

    .activity-status.status-researching {
      background: rgba(59, 159, 216, 0.1);
      color: var(--primary-blue);
    }

    .activity-text {
      font-size: 0.8rem;
      color: var(--text-dark);
      line-height: 1.4;
    }

    .activity-text strong {
      font-weight: 600;
    }

    .activity-time {
      font-size: 0.7rem;
      color: var(--text-light);
      margin-top: 0.25rem;
    }

    .activity-item {
      cursor: pointer;
    }

    /* Recent Items Card */
    .recent-card {
      background: var(--bg-card);
      border: 1px solid var(--border-card);
      border-radius: var(--radius-lg);
      overflow: hidden;
    }

    .recent-card-header {
      padding: 1rem 1.25rem;
      border-bottom: 1px solid var(--border-light);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .recent-card-title {
      font-size: 0.9rem;
      font-weight: 700;
      color: var(--text-dark);
    }

    .view-all-link {
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--primary-blue);
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }

    .view-all-link:hover {
      text-decoration: underline;
    }

    .recent-list {
      padding: 0.5rem 0;
    }

    .recent-item {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 0.75rem 1.25rem;
      transition: background var(--transition-fast);
      cursor: pointer;
    }

    .recent-item:hover {
      background: var(--bg-light);
    }

    .recent-item-icon {
      width: 36px;
      height: 36px;
      border-radius: var(--radius-sm);
      background: var(--bg-light);
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .recent-item-icon svg {
      width: 18px;
      height: 18px;
      color: var(--text-medium);
    }

    .recent-item-info {
      flex: 1;
      min-width: 0;
    }

    .recent-item-name {
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--text-dark);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .recent-item-meta {
      font-size: 0.7rem;
      color: var(--text-light);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .recent-item-status {
      padding: 0.2rem 0.5rem;
      border-radius: 6px;
      font-size: 0.65rem;
      font-weight: 700;
      text-transform: uppercase;
    }

    .recent-item-status.live {
      background: var(--success-light);
      color: var(--success);
    }

    .recent-item-status.draft {
      background: var(--bg-light);
      color: var(--text-medium);
    }

    /* ============================================
       BUTTONS
    ============================================ */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      padding: 0.75rem 1.5rem;
      border-radius: 12px;
      font-size: 0.875rem;
      font-weight: 600;
      cursor: pointer;
      border: none;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--primary-blue) 0%, var(--primary-blue-dark) 100%);
      color: white;
      box-shadow: 0 4px 15px rgba(59, 159, 216, 0.3);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(59, 159, 216, 0.4);
    }

    .btn-secondary {
      background: var(--bg-white);
      color: var(--text-dark);
      border: 1px solid var(--border-light);
    }

    .btn-secondary:hover {
      background: var(--bg-light);
      border-color: var(--primary-blue);
      color: var(--primary-blue);
    }

    .btn-accent {
      background: var(--accent);
      color: var(--bg-sidebar);
      font-weight: 700;
      box-shadow: 0 4px 15px rgba(191, 255, 0, 0.3);
    }

    .btn-accent:hover {
      background: var(--accent-dark);
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(191, 255, 0, 0.4);
    }

    .btn-dark {
      background: var(--bg-sidebar);
      color: #fff;
    }

    .btn-dark:hover {
      background: var(--bg-sidebar-hover);
      transform: translateY(-2px);
    }

    .btn-ghost {
      background: transparent;
      color: var(--text-medium);
      padding: 0.5rem;
    }

    .btn-ghost:hover {
      background: var(--bg-light);
      color: var(--primary-blue);
    }

    .btn-success {
      background: linear-gradient(135deg, var(--success) 0%, #00a884 100%);
      color: white;
      box-shadow: 0 4px 15px rgba(0, 184, 148, 0.3);
    }

    .btn-success:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0, 184, 148, 0.4);
    }

    .btn-small {
      padding: 0.5rem 1rem;
      font-size: 0.75rem;
      border-radius: 8px;
    }

    .btn-icon {
      width: 36px;
      height: 36px;
      padding: 0;
      border-radius: 10px;
    }

    .table-actions {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .table-actions .btn-icon {
      width: 32px;
      height: 32px;
      background: var(--bg-light);
      border: 1px solid var(--border-light);
    }

    .table-actions .btn-icon:hover {
      background: var(--primary-blue);
      border-color: var(--primary-blue);
      color: white;
    }

    .table-actions .btn-icon svg {
      color: var(--text-medium);
    }

    .table-actions .btn-icon:hover svg {
      color: white;
    }

    /* ============================================
       STATS CARDS
    ============================================ */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    @media (max-width: 1200px) {
      .stats-grid { grid-template-columns: repeat(2, 1fr); }
    }

    @media (max-width: 768px) {
      .stats-grid { grid-template-columns: 1fr; }
    }

    .stat-card {
      background: var(--bg-white);
      border-radius: 16px;
      padding: 1.5rem;
      border: 1px solid var(--border-light);
      transition: all 0.3s ease;
    }

    .stat-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-md);
    }

    .stat-icon {
      width: 44px;
      height: 44px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.25rem;
      margin-bottom: 1rem;
    }

    .stat-icon.blue { background: rgba(59, 159, 216, 0.1); }
    .stat-icon.green { background: rgba(59, 159, 216, 0.1); }
    .stat-icon.orange { background: rgba(253, 203, 110, 0.15); }
    .stat-icon.purple { background: rgba(162, 155, 254, 0.15); }

    .stat-label {
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-medium);
      margin-bottom: 0.5rem;
    }

    .stat-value {
      font-size: 2rem;
      font-weight: 800;
      color: var(--text-dark);
    }

    /* ============================================
       PAGES SECTION
    ============================================ */
    .section-card {
      background: var(--bg-white);
      border-radius: 20px;
      border: 1px solid var(--border-light);
      overflow: hidden;
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1.25rem 1.5rem;
      border-bottom: 1px solid var(--border-light);
      background: var(--bg-light);
    }

    .section-title {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .section-title h2 {
      font-size: 1.125rem;
      font-weight: 700;
      color: var(--text-dark);
    }

    .section-title .badge {
      background: var(--primary-blue);
      color: white;
      font-size: 0.7rem;
      font-weight: 700;
      padding: 0.2rem 0.5rem;
      border-radius: 10px;
    }

    /* Pages Table */
    .pages-table-wrapper {
      overflow-x: auto;
    }

    .pages-table {
      width: 100%;
      border-collapse: collapse;
    }

    .pages-table th {
      padding: 1rem 1.25rem;
      text-align: left;
      font-size: 0.7rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-medium);
      background: var(--bg-light);
      border-bottom: 1px solid var(--border-light);
    }

    .pages-table td {
      padding: 1rem 1.25rem;
      border-bottom: 1px solid var(--border-light);
      vertical-align: middle;
    }

    .pages-table tbody tr {
      transition: background 0.2s ease;
    }

    .pages-table tbody tr:hover {
      background: rgba(59, 159, 216, 0.03);
    }

    .pages-table tbody tr:last-child td {
      border-bottom: none;
    }

    .page-name {
      display: flex;
      flex-direction: column;
      gap: 0.2rem;
    }

    .page-name strong {
      font-weight: 600;
      color: var(--text-dark);
    }

    .page-name small {
      font-size: 0.75rem;
      color: var(--text-light);
    }

    .status-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.375rem;
      padding: 0.35rem 0.75rem;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 600;
    }

    .status-badge .dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
    }

    .status-live {
      background: rgba(0, 184, 148, 0.1);
      color: var(--success);
    }

    .status-live .dot {
      background: var(--success);
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .status-draft {
      background: rgba(253, 203, 110, 0.15);
      color: #d4a017;
    }

    .status-draft .dot {
      background: var(--warning);
    }

    .page-link {
      color: var(--primary-blue);
      text-decoration: none;
      font-size: 0.875rem;
      font-weight: 500;
    }

    .page-link:hover {
      text-decoration: underline;
    }

    .actions {
      display: flex;
      gap: 0.375rem;
    }

    .metric {
      font-weight: 600;
      color: var(--text-dark);
    }

    .metric-secondary {
      color: var(--text-light);
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 4rem 2rem;
    }

    .empty-illustration {
      width: 140px;
      height: 140px;
      margin: 0 auto 1.5rem;
      background: linear-gradient(135deg, var(--bg-light) 0%, #e8f4f8 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 3.5rem;
    }

    .empty-state h3 {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--text-dark);
      margin-bottom: 0.5rem;
    }

    .empty-state p {
      color: var(--text-medium);
      max-width: 350px;
      margin: 0 auto 1.5rem;
      line-height: 1.5;
    }

    /* ============================================
       MODALS
    ============================================ */
    .modal-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(45, 52, 54, 0.6);
      backdrop-filter: blur(8px);
      z-index: 1000;
      justify-content: center;
      align-items: center;
      padding: 1rem;
    }

    .modal-overlay.active {
      display: flex;
    }

    .modal {
      background: var(--bg-white);
      border-radius: 20px;
      width: 100%;
      max-width: 900px;
      max-height: 90vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      box-shadow: var(--shadow-lg);
    }

    .modal.modal-large {
      max-width: 1200px;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1.25rem 1.5rem;
      border-bottom: 1px solid var(--border-light);
      background: var(--bg-light);
    }

    .modal-header h2 {
      font-size: 1.125rem;
      font-weight: 700;
      color: var(--text-dark);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .modal-close {
      width: 32px;
      height: 32px;
      border-radius: 8px;
      background: transparent;
      border: none;
      color: var(--text-medium);
      font-size: 1.25rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }

    .modal-close:hover {
      background: var(--bg-white);
      color: var(--error);
    }

    .modal-body {
      padding: 1.5rem;
      overflow-y: auto;
      flex: 1;
    }

    .modal-footer {
      display: flex;
      justify-content: flex-end;
      gap: 0.75rem;
      padding: 1.25rem 1.5rem;
      border-top: 1px solid var(--border-light);
      background: var(--bg-light);
    }

    /* Form Styles */
    .form-group {
      margin-bottom: 1.25rem;
    }

    .form-group label {
      display: block;
      font-size: 0.875rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: var(--text-dark);
    }

    .form-group label span {
      color: var(--error);
    }

    .form-group input,
    .form-group textarea,
    .form-group select {
      width: 100%;
      padding: 0.75rem 1rem;
      background: var(--bg-light);
      border: 2px solid var(--border-light);
      border-radius: 10px;
      color: var(--text-dark);
      font-size: 0.875rem;
      font-family: inherit;
      transition: all 0.2s ease;
    }

    .form-group input:focus,
    .form-group textarea:focus,
    .form-group select:focus {
      outline: none;
      border-color: var(--primary-blue);
      background: var(--bg-white);
    }

    .form-group textarea {
      min-height: 200px;
      font-family: 'SF Mono', Monaco, monospace;
      font-size: 0.8125rem;
      line-height: 1.5;
      resize: vertical;
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    }

    @media (max-width: 640px) {
      .form-row { grid-template-columns: 1fr; }
    }

    .form-hint {
      font-size: 0.75rem;
      color: var(--text-light);
      margin-top: 0.375rem;
    }

    /* Deploy Result */
    .deploy-result {
      background: rgba(0, 184, 148, 0.08);
      border: 2px solid var(--success);
      border-radius: 12px;
      padding: 1.25rem;
      margin-bottom: 1.25rem;
    }

    .deploy-result h4 {
      color: var(--success);
      font-size: 0.95rem;
      font-weight: 700;
      margin-bottom: 0.375rem;
    }

    .deploy-result p {
      color: var(--text-medium);
      font-size: 0.875rem;
    }

    .deploy-result a {
      color: var(--success);
      font-weight: 600;
    }

    /* ============================================
       DOMAIN CONFIGURATION
    ============================================ */
    .domain-section {
      margin-top: 1.25rem;
      padding-top: 1.25rem;
      border-top: 1px solid var(--border-light);
    }

    .domain-section-title {
      font-size: 0.85rem;
      font-weight: 700;
      color: var(--text-dark);
      margin-bottom: 0.75rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .domain-section-title svg {
      width: 16px;
      height: 16px;
      color: var(--primary-blue);
    }

    .domain-options {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .domain-option {
      background: var(--bg-light);
      border: 2px solid var(--border-light);
      border-radius: var(--radius-md);
      padding: 1rem;
      cursor: pointer;
      transition: all var(--transition-fast);
    }

    .domain-option:hover {
      border-color: var(--primary-blue);
      background: rgba(59, 159, 216, 0.03);
    }

    .domain-option.selected {
      border-color: var(--primary-blue);
      background: rgba(59, 159, 216, 0.08);
    }

    .domain-option-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 0.5rem;
    }

    .domain-option-radio {
      width: 18px;
      height: 18px;
      border: 2px solid var(--border-light);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      transition: all var(--transition-fast);
    }

    .domain-option.selected .domain-option-radio {
      border-color: var(--primary-blue);
      background: var(--primary-blue);
    }

    .domain-option.selected .domain-option-radio::after {
      content: '';
      width: 6px;
      height: 6px;
      background: white;
      border-radius: 50%;
    }

    .domain-option-title {
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--text-dark);
    }

    .domain-option-badge {
      font-size: 0.65rem;
      font-weight: 700;
      padding: 0.2rem 0.5rem;
      border-radius: 4px;
      background: var(--primary-blue);
      color: white;
      margin-left: auto;
    }

    .domain-option-badge.pro {
      background: linear-gradient(135deg, var(--primary-blue) 0%, var(--accent) 100%);
    }

    .domain-option-description {
      font-size: 0.75rem;
      color: var(--text-medium);
      margin-left: 2rem;
    }

    .domain-preview {
      margin-top: 0.75rem;
      margin-left: 2rem;
      font-family: 'SF Mono', Monaco, monospace;
      font-size: 0.8rem;
      color: var(--primary-blue);
      background: rgba(59, 159, 216, 0.08);
      padding: 0.5rem 0.75rem;
      border-radius: 6px;
      display: inline-block;
    }

    .domain-input-group {
      margin-top: 0.75rem;
      margin-left: 2rem;
      display: flex;
      gap: 0.5rem;
    }

    .domain-input-group input {
      flex: 1;
      padding: 0.5rem 0.75rem;
      border: 1px solid var(--border-light);
      border-radius: 6px;
      font-size: 0.8rem;
    }

    .domain-input-group input:focus {
      outline: none;
      border-color: var(--primary-blue);
    }

    .domain-input-suffix {
      display: flex;
      align-items: center;
      padding: 0 0.75rem;
      background: var(--bg-light);
      border: 1px solid var(--border-light);
      border-radius: 6px;
      font-size: 0.8rem;
      color: var(--text-medium);
    }

    .dns-instructions {
      margin-top: 1rem;
      background: var(--bg-light);
      border-radius: var(--radius-md);
      padding: 1rem;
    }

    .dns-instructions-title {
      font-size: 0.8rem;
      font-weight: 600;
      color: var(--text-dark);
      margin-bottom: 0.75rem;
    }

    .dns-record {
      display: grid;
      grid-template-columns: 80px 1fr 1fr;
      gap: 0.5rem;
      font-size: 0.75rem;
      margin-bottom: 0.5rem;
    }

    .dns-record-header {
      font-weight: 600;
      color: var(--text-medium);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid var(--border-light);
    }

    .dns-record-value {
      font-family: 'SF Mono', Monaco, monospace;
      color: var(--text-dark);
      padding: 0.25rem 0;
    }

    .dns-status {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-top: 0.75rem;
      font-size: 0.75rem;
    }

    .dns-status-indicator {
      width: 8px;
      height: 8px;
      border-radius: 50%;
    }

    .dns-status-indicator.pending {
      background: var(--warning);
    }

    .dns-status-indicator.verified {
      background: var(--primary-blue);
    }

    .dns-status-indicator.error {
      background: var(--error);
    }

    /* Domain Management Modal */
    .domain-list {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .domain-list-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: var(--bg-light);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-md);
      padding: 0.875rem 1rem;
    }

    .domain-list-item-info {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }

    .domain-list-item-domain {
      font-family: 'SF Mono', Monaco, monospace;
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--text-dark);
    }

    .domain-list-item-page {
      font-size: 0.7rem;
      color: var(--text-medium);
    }

    .domain-list-item-status {
      font-size: 0.65rem;
      font-weight: 600;
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
    }

    .domain-list-item-status.active {
      background: rgba(59, 159, 216, 0.1);
      color: var(--primary-blue);
    }

    .domain-list-item-status.pending {
      background: var(--warning-light);
      color: #B8860B;
    }

    .domain-list-item-actions {
      display: flex;
      gap: 0.5rem;
    }

    /* ============================================
       ANALYTICS MODAL
    ============================================ */
    .analytics-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    @media (max-width: 640px) {
      .analytics-grid { grid-template-columns: 1fr; }
    }

    .analytics-card {
      background: var(--bg-light);
      border: 1px solid var(--border-light);
      border-radius: 12px;
      padding: 1.25rem;
      text-align: center;
    }

    .analytics-card .label {
      font-size: 0.7rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-medium);
      margin-bottom: 0.375rem;
    }

    .analytics-card .value {
      font-size: 1.75rem;
      font-weight: 800;
      color: var(--text-dark);
    }

    /* Tabs */
    .tabs {
      display: flex;
      gap: 0.25rem;
      margin-bottom: 1.5rem;
      border-bottom: 2px solid var(--border-light);
    }

    .tab {
      padding: 0.75rem 1.25rem;
      background: none;
      border: none;
      color: var(--text-medium);
      font-size: 0.875rem;
      font-weight: 600;
      cursor: pointer;
      position: relative;
      transition: all 0.2s ease;
    }

    .tab::after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 0;
      right: 0;
      height: 2px;
      background: var(--primary-blue);
      transform: scaleX(0);
      transition: transform 0.2s ease;
    }

    .tab:hover {
      color: var(--text-dark);
    }

    .tab.active {
      color: var(--primary-blue);
    }

    .tab.active::after {
      transform: scaleX(1);
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    /* Leads Table */
    .leads-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.875rem;
    }

    .leads-table th,
    .leads-table td {
      padding: 0.875rem;
      text-align: left;
      border-bottom: 1px solid var(--border-light);
    }

    .leads-table th {
      font-size: 0.7rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-medium);
      background: var(--bg-light);
    }

    /* ============================================
       GENERATE PAGE MODAL
    ============================================ */
    .generate-options {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    @media (max-width: 1024px) {
      .generate-options { grid-template-columns: repeat(3, 1fr); }
    }

    @media (max-width: 768px) {
      .generate-options { grid-template-columns: repeat(2, 1fr); }
    }

    @media (max-width: 480px) {
      .generate-options { grid-template-columns: 1fr; }
    }

    .generate-option {
      background: var(--bg-light);
      border: 2px solid var(--border-light);
      border-radius: 14px;
      padding: 1rem;
      cursor: pointer;
      transition: all 0.2s ease;
      text-align: center;
    }

    .generate-option:hover {
      border-color: var(--primary-blue);
      background: var(--bg-white);
    }

    .generate-option.selected {
      border-color: var(--primary-blue);
      background: rgba(59, 159, 216, 0.05);
    }

    .generate-option-icon {
      width: 48px;
      height: 48px;
      border-radius: 12px;
      background: linear-gradient(135deg, var(--primary-blue) 0%, var(--primary-blue-dark) 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 0.75rem;
      font-size: 1.35rem;
    }

    .generate-option h4 {
      font-size: 1rem;
      font-weight: 700;
      color: var(--text-dark);
      margin-bottom: 0.375rem;
    }

    .generate-option p {
      font-size: 0.8rem;
      color: var(--text-medium);
      line-height: 1.4;
    }

    /* ============================================
       PIPELINE PROGRESS
    ============================================ */
    .pipeline-progress {
      padding: 1rem;
    }

    .pipeline-steps {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .pipeline-step {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1rem;
      background: var(--bg-light);
      border-radius: 12px;
      border: 2px solid var(--border-light);
      transition: all 0.3s ease;
    }

    .pipeline-step.pending {
      opacity: 0.5;
    }

    .pipeline-step.running {
      border-color: var(--primary-blue);
      background: rgba(59, 159, 216, 0.05);
      animation: pulseBorder 1.5s ease-in-out infinite;
    }

    .pipeline-step.completed {
      border-color: var(--success);
      background: rgba(0, 184, 148, 0.05);
    }

    .pipeline-step.failed {
      border-color: var(--error);
      background: rgba(225, 112, 85, 0.05);
    }

    @keyframes pulseBorder {
      0%, 100% { box-shadow: 0 0 0 0 rgba(59, 159, 216, 0.4); }
      50% { box-shadow: 0 0 0 8px rgba(59, 159, 216, 0); }
    }

    .step-indicator {
      position: relative;
      width: 48px;
      height: 48px;
      flex-shrink: 0;
    }

    .step-icon {
      width: 48px;
      height: 48px;
      border-radius: 12px;
      background: var(--bg-white);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      border: 2px solid var(--border-light);
    }

    .pipeline-step.running .step-icon {
      border-color: var(--primary-blue);
    }

    .pipeline-step.completed .step-icon {
      border-color: var(--success);
      background: var(--success);
    }

    .pipeline-step.completed .step-icon::after {
      content: '';
      position: absolute;
      color: white;
      font-size: 1.5rem;
      font-weight: bold;
    }

    .step-status {
      position: absolute;
      bottom: -4px;
      right: -4px;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: var(--bg-white);
      border: 2px solid var(--border-light);
      display: none;
    }

    .pipeline-step.running .step-status {
      display: block;
      background: var(--primary-blue);
      border-color: var(--primary-blue);
      animation: spin 1s linear infinite;
    }

    .pipeline-step.running .step-status::after {
      content: '';
      position: absolute;
      inset: 2px;
      border: 2px solid transparent;
      border-top-color: white;
      border-radius: 50%;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .step-info {
      flex: 1;
    }

    .step-name {
      font-weight: 600;
      font-size: 0.95rem;
      color: var(--text-dark);
      margin-bottom: 0.25rem;
    }

    .step-desc {
      font-size: 0.8rem;
      color: var(--text-medium);
    }

    .pipeline-step.running .step-desc::after {
      content: '...';
      animation: dots 1.5s steps(4, end) infinite;
    }

    .pipeline-summary {
      margin-top: 1.5rem;
      padding: 1rem;
      background: var(--bg-light);
      border-radius: 12px;
      border: 1px solid var(--border-light);
    }

    .summary-stats {
      display: flex;
      justify-content: space-around;
      gap: 1rem;
    }

    .summary-stat {
      text-align: center;
    }

    .summary-stat .stat-label {
      font-size: 0.75rem;
      color: var(--text-medium);
      display: block;
      margin-bottom: 0.25rem;
    }

    .summary-stat .stat-value {
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--text-dark);
    }

    /* ============================================
       VISUAL EDITOR MODAL
    ============================================ */
    .editor-container {
      display: flex;
      flex-direction: column;
      height: 100%;
    }

    .editor-toolbar {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      padding: 0.75rem;
      background: var(--bg-light);
      border-bottom: 1px solid var(--border-light);
      align-items: center;
    }

    .toolbar-group {
      display: flex;
      align-items: center;
      gap: 0.25rem;
      padding-right: 0.75rem;
      border-right: 1px solid var(--border-light);
    }

    .toolbar-group:last-child {
      border-right: none;
    }

    .toolbar-btn {
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--bg-white);
      border: 1px solid var(--border-light);
      border-radius: 6px;
      cursor: pointer;
      color: var(--text-dark);
      font-size: 0.875rem;
      transition: all 0.15s ease;
    }

    .toolbar-btn:hover {
      background: var(--primary-blue);
      color: white;
      border-color: var(--primary-blue);
    }

    .toolbar-btn.active {
      background: var(--primary-blue);
      color: white;
      border-color: var(--primary-blue);
    }

    .toolbar-btn svg {
      width: 16px;
      height: 16px;
    }

    .toolbar-select {
      padding: 0.4rem 0.75rem;
      border: 1px solid var(--border-light);
      border-radius: 6px;
      font-size: 0.8rem;
      background: var(--bg-white);
      color: var(--text-dark);
      cursor: pointer;
      min-width: 100px;
    }

    .toolbar-select:focus {
      outline: none;
      border-color: var(--primary-blue);
    }

    .toolbar-color {
      width: 32px;
      height: 32px;
      padding: 2px;
      border: 1px solid var(--border-light);
      border-radius: 6px;
      cursor: pointer;
      background: var(--bg-white);
    }

    .toolbar-color::-webkit-color-swatch-wrapper {
      padding: 0;
    }

    .toolbar-color::-webkit-color-swatch {
      border: none;
      border-radius: 4px;
    }

    .toolbar-label {
      font-size: 0.7rem;
      color: var(--text-medium);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.03em;
    }

    .editor-main {
      display: grid;
      grid-template-columns: 1fr 320px;
      gap: 1rem;
      flex: 1;
      min-height: 0;
      padding: 1rem;
    }

    @media (max-width: 1200px) {
      .editor-main {
        grid-template-columns: 1fr;
      }
      .editor-sidebar {
        display: none;
      }
    }

    .editor-preview-wrapper {
      display: flex;
      flex-direction: column;
      border: 1px solid var(--border-light);
      border-radius: 12px;
      overflow: hidden;
      background: #fff;
    }

    .preview-header {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 0.75rem;
      background: var(--bg-light);
      border-bottom: 1px solid var(--border-light);
    }

    .preview-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
    }

    .preview-dot.red { background: #ff5f57; }
    .preview-dot.yellow { background: #ffbd2e; }
    .preview-dot.green { background: var(--primary-blue); }

    .preview-url {
      flex: 1;
      text-align: center;
      font-size: 0.75rem;
      color: var(--text-light);
      background: var(--bg-white);
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      margin: 0 0.5rem;
    }

    .editor-iframe-container {
      flex: 1;
      position: relative;
      overflow: hidden;
    }

    .editor-preview-wrapper iframe {
      width: 100%;
      height: 100%;
      border: none;
    }

    .editor-sidebar {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      overflow-y: auto;
    }

    .sidebar-panel {
      background: var(--bg-white);
      border: 1px solid var(--border-light);
      border-radius: 12px;
      overflow: hidden;
    }

    .panel-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.75rem 1rem;
      background: var(--bg-light);
      border-bottom: 1px solid var(--border-light);
      cursor: pointer;
    }

    .panel-header h4 {
      font-size: 0.8rem;
      font-weight: 600;
      color: var(--text-dark);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .panel-toggle {
      font-size: 0.75rem;
      color: var(--text-light);
      transition: transform 0.2s ease;
    }

    .panel-header.collapsed .panel-toggle {
      transform: rotate(-90deg);
    }

    .panel-content {
      padding: 1rem;
    }

    .panel-content.collapsed {
      display: none;
    }

    /* Chat Panel */
    .chat-messages {
      max-height: 200px;
      overflow-y: auto;
      padding: 0.75rem;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      background: var(--bg-light);
      border-radius: 8px;
      margin-bottom: 0.75rem;
    }

    .chat-message {
      padding: 0.5rem 0.75rem;
      border-radius: 8px;
      font-size: 0.8rem;
      line-height: 1.4;
    }

    .chat-message.user {
      background: var(--primary-blue);
      color: white;
      align-self: flex-end;
      max-width: 85%;
    }

    .chat-message.assistant {
      background: var(--bg-white);
      color: var(--text-dark);
      align-self: flex-start;
      border: 1px solid var(--border-light);
      max-width: 85%;
    }

    .chat-input-wrapper {
      display: flex;
      gap: 0.5rem;
    }

    .chat-input {
      flex: 1;
      padding: 0.5rem 0.75rem;
      border: 1px solid var(--border-light);
      border-radius: 8px;
      font-size: 0.8rem;
      font-family: inherit;
      resize: none;
    }

    .chat-input:focus {
      outline: none;
      border-color: var(--primary-blue);
    }

    /* Element Properties Panel */
    .property-row {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.75rem;
    }

    .property-row:last-child {
      margin-bottom: 0;
    }

    .property-label {
      font-size: 0.75rem;
      color: var(--text-medium);
      min-width: 70px;
    }

    .property-input {
      flex: 1;
      padding: 0.4rem 0.6rem;
      border: 1px solid var(--border-light);
      border-radius: 6px;
      font-size: 0.8rem;
      font-family: inherit;
    }

    .property-input:focus {
      outline: none;
      border-color: var(--primary-blue);
    }

    .property-color {
      width: 32px;
      height: 28px;
      padding: 2px;
      border: 1px solid var(--border-light);
      border-radius: 6px;
      cursor: pointer;
    }

    /* Media Upload */
    .upload-zone {
      border: 2px dashed var(--border-light);
      border-radius: 8px;
      padding: 1.5rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .upload-zone:hover {
      border-color: var(--primary-blue);
      background: rgba(59, 159, 216, 0.03);
    }

    .upload-zone-icon {
      font-size: 1.5rem;
      margin-bottom: 0.5rem;
    }

    .upload-zone-text {
      font-size: 0.8rem;
      color: var(--text-medium);
    }

    .upload-zone-hint {
      font-size: 0.7rem;
      color: var(--text-light);
      margin-top: 0.25rem;
    }

    /* Device Preview Toggle */
    .device-toggle {
      display: flex;
      gap: 0.25rem;
      background: var(--bg-light);
      padding: 0.25rem;
      border-radius: 8px;
    }

    .device-btn {
      padding: 0.4rem 0.6rem;
      border: none;
      background: transparent;
      border-radius: 6px;
      cursor: pointer;
      color: var(--text-medium);
      font-size: 0.75rem;
      transition: all 0.15s ease;
    }

    .device-btn.active {
      background: var(--bg-white);
      color: var(--text-dark);
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    .device-btn svg {
      width: 16px;
      height: 16px;
    }

    /* Link Editor Modal */
    .link-editor-popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: var(--bg-white);
      border-radius: 12px;
      box-shadow: var(--shadow-lg);
      padding: 1.5rem;
      z-index: 2000;
      min-width: 350px;
      display: none;
    }

    .link-editor-popup.active {
      display: block;
    }

    .link-editor-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.3);
      z-index: 1999;
      display: none;
    }

    .link-editor-backdrop.active {
      display: block;
    }

    /* ============================================
       CLIENT LIST STYLES
    ============================================ */
    .clients-table {
      width: 100%;
      border-collapse: collapse;
    }

    .clients-table th {
      padding: 1rem 1.25rem;
      text-align: left;
      font-size: 0.7rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-medium);
      background: var(--bg-light);
      border-bottom: 1px solid var(--border-light);
    }

    .clients-table td {
      padding: 1rem 1.25rem;
      border-bottom: 1px solid var(--border-light);
      vertical-align: middle;
    }

    .clients-table tbody tr {
      transition: background 0.2s ease;
      cursor: pointer;
    }

    .clients-table tbody tr:hover {
      background: rgba(59, 159, 216, 0.03);
    }

    .clients-table tbody tr:last-child td {
      border-bottom: none;
    }

    .client-name-cell {
      display: flex;
      align-items: center;
      gap: 0.875rem;
    }

    .client-avatar {
      width: 40px;
      height: 40px;
      border-radius: 12px;
      background: linear-gradient(135deg, var(--primary-blue) 0%, var(--primary-blue-dark) 100%);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 1rem;
      flex-shrink: 0;
    }

    .client-name-info {
      display: flex;
      flex-direction: column;
      gap: 0.125rem;
    }

    .client-name-info strong {
      font-weight: 600;
      color: var(--text-dark);
    }

    .client-name-info small {
      font-size: 0.75rem;
      color: var(--text-light);
    }

    .industry-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.375rem;
      padding: 0.35rem 0.75rem;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 600;
      background: rgba(59, 159, 216, 0.1);
      color: var(--primary-blue);
    }

    .research-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.375rem;
      padding: 0.35rem 0.75rem;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 600;
    }

    .research-badge.completed {
      background: rgba(0, 184, 148, 0.1);
      color: var(--success);
    }

    .research-badge.completed .dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--success);
    }

    .research-badge.pending {
      background: rgba(253, 203, 110, 0.15);
      color: #d4a017;
    }

    .research-badge.pending .dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--warning);
    }

    /* ============================================
       CLIENT DETAIL STYLES
    ============================================ */
    .client-detail-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1.5rem;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
    }

    .client-detail-back {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .client-detail-title {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .client-detail-title h2 {
      margin: 0;
      font-size: 1.5rem;
      font-weight: 800;
      color: var(--text-dark);
    }

    .client-detail-actions {
      display: flex;
      gap: 0.5rem;
    }

    .client-tabs {
      display: flex;
      gap: 0.25rem;
      margin-bottom: 1.5rem;
      background: var(--bg-white);
      padding: 0.375rem;
      border-radius: 14px;
      border: 1px solid var(--border-light);
      overflow-x: auto;
      box-shadow: var(--shadow-sm);
    }

    .client-tab {
      padding: 0.625rem 1.25rem;
      border: none;
      background: transparent;
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--text-medium);
      cursor: pointer;
      border-radius: 10px;
      transition: all 0.2s ease;
      white-space: nowrap;
    }

    .client-tab:hover {
      background: var(--bg-light);
      color: var(--text-dark);
    }

    .client-tab.active {
      background: linear-gradient(135deg, var(--primary-blue) 0%, var(--primary-blue-dark) 100%);
      color: white;
      box-shadow: 0 4px 12px rgba(59, 159, 216, 0.25);
    }

    .client-tab-content {
      display: none;
    }

    .client-tab-content.active {
      display: block;
    }

    /* Overview Tab */
    .client-overview-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1.5rem;
      margin-bottom: 1.5rem;
    }

    @media (max-width: 900px) {
      .client-overview-grid { grid-template-columns: 1fr; }
    }

    .client-info-card {
      padding: 1.5rem;
    }

    .client-info-card h3 {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.875rem;
      font-weight: 700;
      color: var(--text-dark);
      margin-bottom: 1.25rem;
      padding-bottom: 0.75rem;
      border-bottom: 1px solid var(--border-light);
    }

    .client-info-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1.25rem;
    }

    .info-item {
      display: flex;
      flex-direction: column;
      gap: 0.375rem;
    }

    .info-item label {
      font-size: 0.7rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-medium);
    }

    .info-item span, .info-item a {
      font-size: 0.9375rem;
      color: var(--text-dark);
      font-weight: 500;
    }

    .info-link {
      color: var(--primary-blue);
      text-decoration: none;
    }

    .info-link:hover {
      text-decoration: underline;
    }

    .client-stats-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1rem;
    }

    .client-stat-item {
      text-align: center;
      padding: 1rem;
      background: var(--bg-light);
      border-radius: 12px;
      transition: all 0.3s ease;
    }

    .client-stat-item:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-sm);
    }

    .client-stat-item .stat-number {
      font-size: 1.75rem;
      font-weight: 800;
      color: var(--primary-blue);
      line-height: 1.2;
    }

    .client-stat-item .stat-label {
      font-size: 0.7rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-medium);
      margin-top: 0.25rem;
    }

    .value-props-list {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      padding: 1.5rem;
    }

    .value-prop-tag {
      background: linear-gradient(135deg, rgba(59, 159, 216, 0.1) 0%, rgba(59, 159, 216, 0.05) 100%);
      color: var(--primary-blue);
      padding: 0.5rem 1rem;
      border-radius: 20px;
      font-size: 0.8125rem;
      font-weight: 600;
      border: 1px solid rgba(59, 159, 216, 0.2);
      transition: all 0.2s ease;
    }

    .value-prop-tag:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(59, 159, 216, 0.15);
    }

    /* Brand Guide Styles */
    .brand-guide-container {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }

    .brand-section-card {
      padding: 0;
      overflow: hidden;
    }

    .brand-section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 1.5rem;
      border-bottom: 1px solid var(--border-light);
      background: var(--bg-light);
    }

    .brand-section-header h3 {
      font-size: 0.9375rem;
      font-weight: 700;
      color: var(--text-dark);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .brand-section-body {
      padding: 1.5rem;
    }

    .color-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 1.25rem;
    }

    .color-item {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .color-item label {
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-medium);
    }

    .color-input-group {
      display: flex;
      gap: 0.5rem;
      align-items: center;
    }

    .color-input-group input[type="color"] {
      width: 52px;
      height: 40px;
      border: 2px solid var(--border-light);
      border-radius: 10px;
      cursor: pointer;
      padding: 3px;
      transition: all 0.2s ease;
    }

    .color-input-group input[type="color"]:hover {
      border-color: var(--primary-blue);
    }

    .color-hex-input {
      flex: 1;
      padding: 0.625rem 0.875rem;
      border: 1px solid var(--border-light);
      border-radius: 10px;
      font-family: 'Monaco', 'Consolas', monospace;
      font-size: 0.8125rem;
      transition: all 0.2s ease;
    }

    .color-hex-input:focus {
      outline: none;
      border-color: var(--primary-blue);
      box-shadow: 0 0 0 3px rgba(59, 159, 216, 0.15);
    }

    .typography-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1.25rem;
    }

    @media (max-width: 768px) {
      .typography-grid { grid-template-columns: 1fr; }
    }

    .font-preview {
      margin-top: 1.25rem;
      padding: 1.25rem;
      background: linear-gradient(135deg, var(--bg-light) 0%, #f0f4f8 100%);
      border-radius: 12px;
      border: 1px solid var(--border-light);
    }

    .font-preview h4 {
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-medium);
      margin-bottom: 0.75rem;
    }

    .spacing-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1.25rem;
    }

    @media (max-width: 768px) {
      .spacing-grid { grid-template-columns: 1fr; }
    }

    .button-preview-grid {
      display: flex;
      gap: 1.5rem;
      align-items: flex-end;
      flex-wrap: wrap;
    }

    .button-preview-item {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .button-preview-item label {
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-medium);
    }

    .btn-preview-primary {
      padding: 0.875rem 1.75rem;
      border: none;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .btn-preview-secondary {
      padding: 0.875rem 1.75rem;
      background: transparent;
      border: 2px solid;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    /* Research Styles */
    .research-container {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }

    .research-section-card {
      padding: 0;
      overflow: hidden;
    }

    .research-section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 1.5rem;
      border-bottom: 1px solid var(--border-light);
      background: var(--bg-light);
    }

    .research-section-header h3 {
      font-size: 0.9375rem;
      font-weight: 700;
      color: var(--text-dark);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .research-section-body {
      padding: 1.5rem;
    }

    .research-field {
      margin-bottom: 1.25rem;
    }

    .research-field:last-child {
      margin-bottom: 0;
    }

    .research-field label {
      display: block;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-medium);
      margin-bottom: 0.5rem;
    }

    .research-input {
      width: 100%;
      padding: 0.75rem 1rem;
      border: 1px solid var(--border-light);
      border-radius: 10px;
      font-size: 0.9375rem;
      font-family: inherit;
      transition: all 0.2s ease;
    }

    .research-input:focus {
      outline: none;
      border-color: var(--primary-blue);
      box-shadow: 0 0 0 3px rgba(59, 159, 216, 0.15);
    }

    .research-textarea {
      width: 100%;
      min-height: 100px;
      padding: 0.75rem 1rem;
      border: 1px solid var(--border-light);
      border-radius: 10px;
      font-size: 0.9375rem;
      font-family: inherit;
      resize: vertical;
      transition: all 0.2s ease;
    }

    .research-textarea:focus {
      outline: none;
      border-color: var(--primary-blue);
      box-shadow: 0 0 0 3px rgba(59, 159, 216, 0.15);
    }

    .products-list, .audiences-list {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .product-card, .audience-card {
      background: var(--bg-light);
      border: 1px solid var(--border-light);
      border-radius: 12px;
      padding: 1.25rem;
      transition: all 0.2s ease;
    }

    .product-card:hover, .audience-card:hover {
      border-color: var(--primary-blue);
      box-shadow: 0 4px 12px rgba(59, 159, 216, 0.1);
    }

    .product-card h4, .audience-card h4 {
      margin: 0 0 0.5rem 0;
      font-size: 0.9375rem;
      font-weight: 700;
      color: var(--text-dark);
    }

    .product-card p, .audience-card p {
      margin: 0;
      font-size: 0.875rem;
      color: var(--text-medium);
      line-height: 1.5;
    }

    /* Facts Styles */
    .facts-container {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }

    .facts-section-card {
      padding: 0;
      overflow: hidden;
    }

    .facts-section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 1.5rem;
      border-bottom: 1px solid var(--border-light);
      background: var(--bg-light);
    }

    .facts-section-header h3 {
      font-size: 0.9375rem;
      font-weight: 700;
      color: var(--text-dark);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .facts-section-body {
      padding: 1.5rem;
    }

    .facts-list, .statistics-list {
      display: flex;
      flex-direction: column;
      gap: 0.875rem;
    }

    .fact-item {
      display: flex;
      align-items: flex-start;
      gap: 1rem;
      padding: 1rem 1.25rem;
      background: var(--bg-light);
      border-radius: 12px;
      border: 1px solid var(--border-light);
      transition: all 0.2s ease;
    }

    .fact-item:hover {
      border-color: var(--primary-blue);
      transform: translateX(4px);
    }

    .fact-type {
      padding: 0.375rem 0.625rem;
      border-radius: 6px;
      font-size: 0.6875rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.02em;
      flex-shrink: 0;
    }

    .fact-type.statistic {
      background: rgba(59, 159, 216, 0.1);
      color: var(--primary-blue);
    }

    .fact-type.testimonial {
      background: rgba(0, 184, 148, 0.1);
      color: var(--success);
    }

    .fact-type.feature {
      background: rgba(253, 203, 110, 0.2);
      color: #b8860b;
    }

    .fact-content {
      flex: 1;
    }

    .fact-text {
      font-size: 0.9375rem;
      color: var(--text-dark);
      margin-bottom: 0.375rem;
      line-height: 1.5;
    }

    .fact-source {
      font-size: 0.75rem;
      color: var(--text-light);
    }

    .testimonials-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 1rem;
    }

    .testimonial-card {
      background: var(--bg-light);
      border: 1px solid var(--border-light);
      border-radius: 12px;
      padding: 1.25rem;
      transition: all 0.2s ease;
    }

    .testimonial-card:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-sm);
    }

    .testimonial-quote {
      font-style: italic;
      color: var(--text-dark);
      margin-bottom: 1rem;
      position: relative;
      padding-left: 1rem;
      border-left: 3px solid var(--primary-blue);
      line-height: 1.6;
    }

    .testimonial-author {
      font-weight: 600;
      font-size: 0.875rem;
      color: var(--text-dark);
    }

    .testimonial-role {
      font-size: 0.75rem;
      color: var(--text-light);
      margin-top: 0.125rem;
    }

    /* Client Pages List */
    .client-pages-section {
      padding: 0;
      overflow: hidden;
    }

    .client-pages-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 1.5rem;
      border-bottom: 1px solid var(--border-light);
      background: var(--bg-light);
    }

    .client-pages-header h3 {
      font-size: 0.9375rem;
      font-weight: 700;
      color: var(--text-dark);
    }

    .client-pages-body {
      padding: 1.5rem;
    }

    .client-pages-list {
      display: flex;
      flex-direction: column;
      gap: 0.875rem;
    }

    .client-page-item {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1rem 1.25rem;
      background: var(--bg-light);
      border-radius: 12px;
      border: 1px solid var(--border-light);
      transition: all 0.2s ease;
    }

    .client-page-item:hover {
      border-color: var(--primary-blue);
      transform: translateX(4px);
    }

    .client-page-item .page-name {
      flex: 1;
      font-weight: 600;
      color: var(--text-dark);
    }

    .text-muted {
      color: var(--text-light);
      font-size: 0.875rem;
    }

    .client-page-item .page-status {
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
    }

    .client-page-item .page-status.live {
      background: rgba(0, 184, 148, 0.1);
      color: var(--success);
    }

    .client-page-item .page-status.draft {
      background: rgba(253, 203, 110, 0.2);
      color: #b8860b;
    }

    .text-muted {
      color: var(--text-light);
      font-size: 14px;
    }

    /* Clients List Table */
    .clients-table {
      width: 100%;
      border-collapse: collapse;
    }

    .clients-table th,
    .clients-table td {
      padding: 12px 16px;
      text-align: left;
      border-bottom: 1px solid var(--border-light);
    }

    .clients-table th {
      font-size: 12px;
      font-weight: 600;
      color: var(--text-light);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .clients-table tr:hover {
      background: var(--bg-light);
    }

    .clients-table .client-name-cell {
      font-weight: 500;
      color: var(--primary-blue);
      cursor: pointer;
    }

    .clients-table .client-name-cell:hover {
      text-decoration: underline;
    }

    @media (max-width: 768px) {
      .client-overview-grid {
        grid-template-columns: 1fr;
      }

      .client-info-grid {
        grid-template-columns: 1fr;
      }

      .typography-grid,
      .spacing-grid {
        grid-template-columns: 1fr;
      }

      .color-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .client-tabs {
        flex-wrap: nowrap;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }

      .button-preview-grid {
        flex-direction: column;
        align-items: stretch;
      }
    }

    /* ============================================
       LOADING SPINNER
    ============================================ */
    .loading-spinner {
      display: inline-block;
      width: 18px;
      height: 18px;
      border: 2px solid rgba(255,255,255,0.3);
      border-top-color: white;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* ============================================
       AD GENERATOR
    ============================================ */
    .badge-new {
      background: linear-gradient(135deg, var(--primary-blue), #5BA3C8);
      color: white;
      font-size: 0.65rem;
      padding: 0.2rem 0.5rem;
      border-radius: 12px;
      font-weight: 600;
    }

    .ad-generator-layout {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }

    .ad-gen-step {
      background: var(--bg-light);
      border-radius: 12px;
      padding: 1.5rem;
      border: 1px solid var(--border-light);
    }

    .ad-gen-step-title {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 1rem;
      color: var(--text-dark);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .ad-gen-step-title::before {
      content: '';
      width: 24px;
      height: 24px;
      background: var(--primary-blue);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .ad-client-info-card {
      background: white;
      border-radius: 8px;
      border: 1px solid var(--border-light);
      padding: 1rem;
      margin-top: 1rem;
    }

    .ad-client-info-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 0.75rem;
    }

    .ad-client-info-header span:first-child {
      font-weight: 600;
      font-size: 1rem;
    }

    .ad-client-info-body {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1rem;
    }

    .ad-client-stat {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }

    .ad-client-stat .stat-label {
      font-size: 0.75rem;
      color: var(--text-medium);
    }

    .ad-gen-modes {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1rem;
    }

    .ad-gen-mode-card {
      background: white;
      border: 2px solid var(--border-light);
      border-radius: 12px;
      padding: 1.5rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .ad-gen-mode-card:hover {
      border-color: var(--primary-blue-light);
      transform: translateY(-2px);
    }

    .ad-gen-mode-card.selected {
      border-color: var(--primary-blue);
      background: rgba(59, 159, 216, 0.05);
    }

    .ad-gen-mode-icon {
      font-size: 2rem;
      margin-bottom: 0.75rem;
    }

    .ad-gen-mode-card h4 {
      font-weight: 600;
      margin-bottom: 0.5rem;
    }

    .ad-gen-mode-card p {
      font-size: 0.85rem;
      color: var(--text-medium);
    }

    .bias-grid, .style-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 0.5rem;
      max-height: 200px;
      overflow-y: auto;
      padding: 0.5rem;
      background: white;
      border: 1px solid var(--border-light);
      border-radius: 8px;
    }

    .bias-item, .style-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem;
      background: var(--bg-light);
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.8rem;
      transition: all 0.15s ease;
    }

    .bias-item:hover, .style-item:hover {
      background: rgba(59, 159, 216, 0.1);
    }

    .bias-item.selected, .style-item.selected {
      background: var(--primary-blue);
      color: white;
    }

    .bias-item input, .style-item input {
      display: none;
    }

    .power-stacks {
      margin-top: 0.75rem;
      padding-top: 0.75rem;
      border-top: 1px solid var(--border-light);
    }

    .power-stack-label {
      font-size: 0.8rem;
      color: var(--text-medium);
      display: block;
      margin-bottom: 0.5rem;
    }

    .power-stack-buttons {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .power-stack-btn {
      padding: 0.4rem 0.8rem;
      border: 1px solid var(--border-light);
      background: white;
      border-radius: 16px;
      font-size: 0.75rem;
      cursor: pointer;
      transition: all 0.15s ease;
    }

    .power-stack-btn:hover {
      border-color: var(--primary-blue);
      color: var(--primary-blue);
    }

    .power-stack-btn.selected {
      background: var(--primary-blue);
      color: white;
      border-color: var(--primary-blue);
    }

    .ad-gen-actions {
      display: flex;
      justify-content: flex-end;
      gap: 0.75rem;
      padding: 1rem 0;
    }

    .ad-gen-results {
      background: white;
      border-radius: 12px;
      border: 1px solid var(--border-light);
      padding: 1.5rem;
    }

    .ad-results-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--border-light);
    }

    .ad-results-header h3 {
      font-size: 1.1rem;
      font-weight: 600;
    }

    .ad-results-actions {
      display: flex;
      gap: 0.5rem;
    }

    .results-section-title {
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--text-medium);
      margin-bottom: 1rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .ad-copy-results-list, .ad-image-results-list {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .ad-result-card {
      background: var(--bg-light);
      border-radius: 8px;
      padding: 1rem;
      border: 1px solid var(--border-light);
    }

    .ad-result-card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.75rem;
    }

    .ad-result-card-header h4 {
      font-size: 0.85rem;
      font-weight: 600;
    }

    .ad-result-card-header .copy-btn {
      padding: 0.25rem 0.5rem;
      font-size: 0.7rem;
      background: white;
      border: 1px solid var(--border-light);
      border-radius: 4px;
      cursor: pointer;
    }

    .ad-result-card-header .copy-btn:hover {
      background: var(--primary-blue);
      color: white;
      border-color: var(--primary-blue);
    }

    .ad-copy-content {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .ad-copy-field {
      background: white;
      padding: 0.75rem;
      border-radius: 6px;
      border: 1px solid var(--border-light);
    }

    .ad-copy-field-label {
      font-size: 0.7rem;
      color: var(--text-medium);
      text-transform: uppercase;
      margin-bottom: 0.25rem;
    }

    .ad-copy-field-value {
      font-size: 0.9rem;
      line-height: 1.4;
    }

    .ad-prompt-content {
      background: white;
      padding: 1rem;
      border-radius: 6px;
      font-family: 'Monaco', 'Menlo', monospace;
      font-size: 0.8rem;
      line-height: 1.5;
      white-space: pre-wrap;
      max-height: 200px;
      overflow-y: auto;
    }

    .ad-prompt-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-top: 0.75rem;
    }

    .ad-prompt-tag {
      padding: 0.2rem 0.5rem;
      background: rgba(59, 159, 216, 0.1);
      color: var(--primary-blue);
      border-radius: 4px;
      font-size: 0.7rem;
    }

    .ad-gen-stats {
      display: flex;
      gap: 1.5rem;
      padding-top: 1rem;
      margin-top: 1rem;
      border-top: 1px solid var(--border-light);
      font-size: 0.85rem;
      color: var(--text-medium);
    }

    /* Toast Notifications */
    .toast-notification {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      padding: 1rem 1.5rem;
      border-radius: 8px;
      background: var(--bg-dark);
      color: white;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
      transform: translateY(100px);
      opacity: 0;
      transition: all 0.3s ease;
      z-index: 10000;
      max-width: 400px;
    }

    .toast-notification.show {
      transform: translateY(0);
      opacity: 1;
    }

    .toast-success {
      background: #059669;
    }

    .toast-error {
      background: #dc2626;
    }

    .toast-warning {
      background: #d97706;
    }

    .toast-info {
      background: #2563eb;
    }

    .toast-icon {
      font-size: 1.2rem;
    }

    .toast-message {
      font-size: 0.9rem;
    }

    /* Generation Progress UI */
    .generating-message {
      text-align: center;
      padding: 3rem 2rem;
      color: var(--text-medium);
    }

    .generating-message .loading-spinner {
      width: 40px;
      height: 40px;
      border-width: 3px;
      margin: 0 auto 1.5rem;
    }

    .generating-message p {
      font-size: 1.1rem;
      margin: 0;
    }

    .generating-submessage {
      font-size: 0.85rem !important;
      color: var(--text-light);
      margin-top: 0.5rem !important;
    }

    .error-message {
      text-align: center;
      padding: 3rem 2rem;
      color: var(--danger-color);
    }

    .error-message p {
      margin: 0 0 0.5rem;
    }

    .error-details {
      font-size: 0.85rem;
      color: var(--text-medium);
      margin-bottom: 1.5rem !important;
    }

    @media (max-width: 768px) {
      .ad-gen-modes {
        grid-template-columns: 1fr;
      }

      .toast-notification {
        left: 1rem;
        right: 1rem;
        bottom: 1rem;
        max-width: none;
      }

      .ad-client-info-body {
        grid-template-columns: 1fr;
      }

      .bias-grid, .style-grid {
        grid-template-columns: 1fr;
      }
    }

    /* ============================================
       MOBILE RESPONSIVE
    ============================================ */
    .mobile-menu-toggle {
      display: none;
      background: none;
      border: none;
      padding: 0.5rem;
      cursor: pointer;
      color: var(--text-dark);
    }

    @media (max-width: 1024px) {
      .sidebar {
        transform: translateX(-100%);
      }

      .sidebar.open {
        transform: translateX(0);
      }

      .main-content {
        margin-left: 0;
      }

      .mobile-menu-toggle {
        display: block;
      }

      .sidebar-overlay {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,0.5);
        z-index: 99;
      }

      .sidebar-overlay.active {
        display: block;
      }
    }

    @media (max-width: 768px) {
      .main-body {
        padding: 1rem;
      }

      .main-header {
        padding: 1rem;
      }

      .page-title {
        font-size: 1.25rem;
      }

      .pages-table .hide-mobile {
        display: none;
      }
    }

    /* ============================================
       SCROLLBAR
    ============================================ */
    ::-webkit-scrollbar {
      width: 6px;
      height: 6px;
    }

    ::-webkit-scrollbar-track {
      background: var(--bg-light);
    }

    ::-webkit-scrollbar-thumb {
      background: var(--border-light);
      border-radius: 3px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--text-light);
    }
  </style>
</head>
<body>
  <!-- Loading Screen -->
  <div class="loading-screen" id="loadingScreen">
    <div class="unicorn-loader">
      <div class="unicorn-character">
        <div class="unicorn-tail">
          <div class="tail-strand"></div>
          <div class="tail-strand"></div>
          <div class="tail-strand"></div>
        </div>
        <div class="unicorn-leg-back left"></div>
        <div class="unicorn-leg-back right"></div>
        <div class="unicorn-body"></div>
        <div class="unicorn-leg-front left"></div>
        <div class="unicorn-leg-front right"></div>
        <div class="unicorn-mane">
          <div class="mane-strand"></div>
          <div class="mane-strand"></div>
          <div class="mane-strand"></div>
        </div>
        <div class="unicorn-head"></div>
        <div class="unicorn-ear"></div>
        <div class="unicorn-horn"></div>
        <div class="unicorn-eye"></div>
        <div class="unicorn-snout"></div>
      </div>
      <div class="laptop">
        <div class="laptop-screen">
          <div class="code-line"></div>
          <div class="code-line"></div>
          <div class="code-line"></div>
          <div class="code-line"></div>
        </div>
        <div class="laptop-base"></div>
      </div>
    </div>
    <div class="loading-text">Building magic<span class="loading-dots"></span></div>
  </div>

  <!-- Interactive Background -->
  <div class="bg-interactive">
    <div class="bg-gradient-orb orb-1"></div>
    <div class="bg-gradient-orb orb-2"></div>
  </div>
  <div class="cursor-glow" id="cursorGlow"></div>

  <!-- Mobile Sidebar Overlay -->
  <div class="sidebar-overlay" id="sidebarOverlay" onclick="closeSidebar()"></div>

  <!-- Main Layout -->
  <div class="app-layout">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-logo">
          <img src="/icon.png" alt="Unicorn" class="sidebar-logo-icon-img">
          <span class="sidebar-logo-text">Unicorn AI</span>
        </div>
      </div>

      <nav class="sidebar-nav">
        <div class="nav-section">
          <div class="nav-section-title">Main</div>
          <a class="nav-item active" data-page="dashboard">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="3" width="7" height="7" rx="1"/>
              <rect x="14" y="3" width="7" height="7" rx="1"/>
              <rect x="3" y="14" width="7" height="7" rx="1"/>
              <rect x="14" y="14" width="7" height="7" rx="1"/>
            </svg>
            <span class="nav-item-label">Dashboard</span>
          </a>
          <a class="nav-item" data-page="pages">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
              <polyline points="14,2 14,8 20,8"/>
            </svg>
            <span class="nav-item-label">Landing Pages</span>
            <span class="badge" id="navPageCount">0</span>
          </a>
        </div>

        <div class="nav-section">
          <div class="nav-section-title">Clients</div>
          <a class="nav-item" data-page="clients">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
              <circle cx="9" cy="7" r="4"/>
              <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
              <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
            </svg>
            <span class="nav-item-label">All Clients</span>
            <span class="badge" id="navClientCount">0</span>
          </a>
        </div>

        <div class="nav-divider"></div>

        <div class="nav-section">
          <div class="nav-section-title">Create</div>
          <a class="nav-item" data-page="adGenerator">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
            </svg>
            <span class="nav-item-label">Ad Generator</span>
          </a>
          <a class="nav-item" onclick="openGenerateModal()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 2L2 7l10 5 10-5-10-5z"/>
              <path d="M2 17l10 5 10-5"/>
              <path d="M2 12l10 5 10-5"/>
            </svg>
            <span class="nav-item-label">Generate Page</span>
          </a>
          <a class="nav-item" onclick="openCreateModal()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
              <polyline points="17 8 12 3 7 8"/>
              <line x1="12" y1="3" x2="12" y2="15"/>
            </svg>
            <span class="nav-item-label">Import HTML</span>
          </a>
        </div>

        <div class="nav-divider"></div>

        <div class="nav-section">
          <div class="nav-section-title">Analytics</div>
          <a class="nav-item" data-page="analytics">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M18 20V10"/>
              <path d="M12 20V4"/>
              <path d="M6 20v-6"/>
            </svg>
            <span class="nav-item-label">Reports</span>
          </a>
          <a class="nav-item" data-page="leads">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M22 12h-4l-3 9L9 3l-3 9H2"/>
            </svg>
            <span class="nav-item-label">Leads</span>
          </a>
        </div>

        <div class="nav-section">
          <div class="nav-section-title">Settings</div>
          <a class="nav-item" data-page="domains">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"/>
              <line x1="2" y1="12" x2="22" y2="12"/>
              <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>
            </svg>
            <span class="nav-item-label">Domains</span>
          </a>
        </div>
      </nav>

      <div class="sidebar-footer">
        <div class="user-info">
          <div class="user-avatar">UM</div>
          <div class="user-details">
            <div class="user-name">Unicorn Team</div>
            <div class="user-role">Administrator</div>
          </div>
        </div>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <header class="main-header">
        <div class="header-left">
          <span class="header-greeting">Welcome back!</span>
          <h1 class="page-title" id="mainPageTitle">Dashboard</h1>
        </div>
        <div class="header-right">
          <div class="header-actions">
            <button class="btn btn-secondary btn-small" onclick="loadPages()">
              <svg width="14" height="14" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M1 7a6 6 0 1 1 1 3.5"/>
                <path d="M1 11V7h4"/>
              </svg>
              Refresh
            </button>
            <button class="btn btn-primary" onclick="openGenerateModal()">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2">
                <polygon points="8 1 2 9 7 9 6 15 14 6 9 6 8 1"/>
              </svg>
              Create with AI
            </button>
          </div>
        </div>
      </header>

      <div class="main-body">
        <!-- Dashboard Content (default view) -->
        <div id="dashboardSection" class="page-section">
          <!-- Metrics Grid -->
          <div class="metrics-grid">
            <div class="metric-card">
              <div class="metric-card-header">
                <div class="metric-icon blue">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                    <polyline points="14,2 14,8 20,8"/>
                  </svg>
                </div>
                <div class="metric-trend up">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="18 15 12 9 6 15"/>
                  </svg>
                  12%
                </div>
              </div>
              <div class="metric-card-body">
                <div class="metric-label">Total Pages</div>
                <div class="metric-value" id="statPages">0</div>
                <div class="metric-sublabel">All landing pages</div>
              </div>
            </div>

            <div class="metric-card">
              <div class="metric-card-header">
                <div class="metric-icon blue">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/>
                    <polyline points="12 6 12 12 16 14"/>
                  </svg>
                </div>
                <div class="metric-trend up">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="18 15 12 9 6 15"/>
                  </svg>
                  8%
                </div>
              </div>
              <div class="metric-card-body">
                <div class="metric-label">Live Pages</div>
                <div class="metric-value" id="statLive">0</div>
                <div class="metric-sublabel">Active campaigns</div>
              </div>
            </div>

            <div class="metric-card">
              <div class="metric-card-header">
                <div class="metric-icon cyan">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                    <circle cx="12" cy="12" r="3"/>
                  </svg>
                </div>
                <div class="metric-trend up">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="18 15 12 9 6 15"/>
                  </svg>
                  24%
                </div>
              </div>
              <div class="metric-card-body">
                <div class="metric-label">Total Views</div>
                <div class="metric-value" id="statViews">0</div>
                <div class="metric-sublabel">Last 30 days</div>
              </div>
            </div>

            <div class="metric-card">
              <div class="metric-card-header">
                <div class="metric-icon blue">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                    <circle cx="9" cy="7" r="4"/>
                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                    <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                  </svg>
                </div>
                <div class="metric-trend up">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="18 15 12 9 6 15"/>
                  </svg>
                  18%
                </div>
              </div>
              <div class="metric-card-body">
                <div class="metric-label">Total Leads</div>
                <div class="metric-value" id="statLeads">0</div>
                <div class="metric-sublabel">Conversions</div>
              </div>
            </div>
          </div>

          <!-- Quick Actions -->
          <div class="quick-actions-section">
            <div class="section-header">
              <div class="section-title">
                <svg class="section-title-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
                </svg>
                Quick Actions
              </div>
            </div>
            <div class="quick-actions-grid">
              <div class="quick-action-card accent" onclick="showPage('adGenerator')">
                <div class="quick-action-icon">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
                  </svg>
                </div>
                <div class="quick-action-label">Generate Ad Copy</div>
                <div class="quick-action-sublabel">AI-powered</div>
              </div>
              <div class="quick-action-card" onclick="openGenerateModal()">
                <div class="quick-action-icon">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                    <path d="M2 17l10 5 10-5"/>
                    <path d="M2 12l10 5 10-5"/>
                  </svg>
                </div>
                <div class="quick-action-label">New Landing Page</div>
                <div class="quick-action-sublabel">AI generate</div>
              </div>
              <div class="quick-action-card" onclick="openAddClientModal()">
                <div class="quick-action-icon">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                    <circle cx="8.5" cy="7" r="4"/>
                    <line x1="20" y1="8" x2="20" y2="14"/>
                    <line x1="17" y1="11" x2="23" y2="11"/>
                  </svg>
                </div>
                <div class="quick-action-label">Add Client</div>
                <div class="quick-action-sublabel">New brand</div>
              </div>
              <div class="quick-action-card" onclick="openCreateModal()">
                <div class="quick-action-icon">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                    <polyline points="17 8 12 3 7 8"/>
                    <line x1="12" y1="3" x2="12" y2="15"/>
                  </svg>
                </div>
                <div class="quick-action-label">Import HTML</div>
                <div class="quick-action-sublabel">Upload page</div>
              </div>
              <div class="quick-action-card" onclick="showPage('clients')">
                <div class="quick-action-icon">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                    <circle cx="9" cy="7" r="4"/>
                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                    <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                  </svg>
                </div>
                <div class="quick-action-label">View Clients</div>
                <div class="quick-action-sublabel">Brand profiles</div>
              </div>
              <div class="quick-action-card" onclick="showPage('analytics')">
                <div class="quick-action-icon">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M18 20V10"/>
                    <path d="M12 20V4"/>
                    <path d="M6 20v-6"/>
                  </svg>
                </div>
                <div class="quick-action-label">Analytics</div>
                <div class="quick-action-sublabel">Performance</div>
              </div>
            </div>
          </div>

          <!-- Dashboard Grid (Recent Activity + Pages) -->
          <div class="dashboard-grid">
            <!-- Recent Pages -->
            <div class="activity-card">
              <div class="activity-card-header">
                <div class="activity-card-title">Recent Landing Pages</div>
                <button class="btn btn-secondary btn-small" onclick="showPage('pages')">View All</button>
              </div>
              <div id="pagesContainer" class="activity-card-body">
                <div class="empty-state" style="padding: 2rem;">
                  <div class="empty-illustration"></div>
                  <h3>No landing pages yet</h3>
                  <p>Create your first page by generating one with AI or importing HTML.</p>
                  <button class="btn btn-primary" onclick="openGenerateModal()">Generate with AI</button>
                </div>
              </div>
            </div>

            <!-- Recent Activity / Clients -->
            <div class="activity-card">
              <div class="activity-card-header">
                <div class="activity-card-title">Recent Clients</div>
                <button class="btn btn-secondary btn-small" onclick="showPage('clients')">View All</button>
              </div>
              <div id="recentClientsContainer" class="activity-card-body">
                <div class="empty-state" style="padding: 2rem;">
                  <div class="empty-illustration"></div>
                  <h3>No clients yet</h3>
                  <p>Add your first client to get started.</p>
                  <button class="btn btn-secondary" onclick="openAddClientModal()">Add Client</button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Pages Section (hidden by default) -->
        <div id="pagesSection" class="page-section" style="display: none;">
          <div class="section-card">
            <div class="section-header">
              <div class="section-title">
                <h2>All Landing Pages</h2>
                <span class="badge" id="pageCount">0</span>
              </div>
              <div style="display: flex; gap: 8px;">
                <button class="btn btn-secondary btn-small" onclick="loadPages()">
                  <svg width="14" height="14" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M1 7a6 6 0 1 1 1 3.5"/>
                    <path d="M1 11V7h4"/>
                  </svg>
                  Refresh
                </button>
                <button class="btn btn-primary btn-small" onclick="openGenerateModal()">
                  <svg width="14" height="14" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-width="2">
                    <polygon points="7 1 2 9 6 9 5 13 12 5 8 5 7 1"/>
                  </svg>
                  Generate
                </button>
              </div>
            </div>
            <div id="allPagesContainer">
              <div class="empty-state">
                <div class="empty-illustration"></div>
                <h3>No landing pages yet</h3>
                <p>Create your first page by generating one with AI or importing HTML.</p>
                <button class="btn btn-primary" onclick="openGenerateModal()">Generate with AI</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Clients Section (hidden by default) -->
        <div id="clientsSection" class="page-section" style="display: none;">
          <div class="section-card">
            <div class="section-header">
              <div class="section-title">
                <h2>All Clients</h2>
                <span class="badge" id="clientsPageCount">0</span>
              </div>
              <div style="display: flex; gap: 8px;">
                <button class="btn btn-secondary btn-small" onclick="loadClientsPage()">
                  <svg width="14" height="14" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M1 7a6 6 0 1 1 1 3.5"/>
                    <path d="M1 11V7h4"/>
                  </svg>
                  Refresh
                </button>
                <button class="btn btn-primary btn-small" onclick="openAddClientModal()">
                  <svg width="14" height="14" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="7" y1="2" x2="7" y2="12"/>
                    <line x1="2" y1="7" x2="12" y2="7"/>
                  </svg>
                  Add Client
                </button>
              </div>
            </div>
            <div id="clientsListContainer" class="pages-table-wrapper">
              <div class="empty-state">
                <div class="empty-illustration"></div>
                <h3>No clients yet</h3>
                <p>Add your first client to store their brand assets and research.</p>
                <button class="btn btn-primary" onclick="openAddClientModal()">Add Client</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Client Detail Section (hidden by default) -->
        <div id="clientDetailSection" class="page-section" style="display: none;">
          <div class="client-detail-header">
            <div class="client-detail-back">
              <button class="btn btn-secondary btn-small" onclick="showClientsPage()">
                <svg width="14" height="14" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M9 12L4 7l5-5"/>
                </svg>
                Back
              </button>
              <div class="client-detail-title">
                <h2 id="clientDetailName">Client Name</h2>
                <span class="industry-badge" id="clientDetailIndustry">Industry</span>
              </div>
            </div>
            <div class="client-detail-actions">
              <button class="btn btn-secondary btn-small" onclick="triggerClientResearch()">
                <svg width="14" height="14" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="5.5" cy="5.5" r="4.5"/>
                  <path d="M13 13l-4-4"/>
                </svg>
                Re-Research
              </button>
              <button class="btn btn-primary btn-small" onclick="generatePageForClient()">
                <svg width="14" height="14" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M7 1L1 4l6 3 6-3-6-3z"/>
                  <path d="M1 10l6 3 6-3"/>
                </svg>
                Generate Page
              </button>
            </div>
          </div>

          <!-- Client Tabs -->
          <div class="client-tabs">
            <button class="client-tab active" data-tab="overview" onclick="switchClientTab('overview')">Overview</button>
            <button class="client-tab" data-tab="brand" onclick="switchClientTab('brand')">Brand Guide</button>
            <button class="client-tab" data-tab="research" onclick="switchClientTab('research')">Research</button>
            <button class="client-tab" data-tab="facts" onclick="switchClientTab('facts')">Verified Facts</button>
            <button class="client-tab" data-tab="pages" onclick="switchClientTab('pages')">Pages</button>
          </div>

          <!-- Overview Tab -->
          <div id="clientTabOverview" class="client-tab-content active">
            <div class="client-overview-grid">
              <div class="section-card client-info-card">
                <h3>
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                    <circle cx="12" cy="7" r="4"/>
                  </svg>
                  Client Information
                </h3>
                <div class="client-info-grid">
                  <div class="info-item">
                    <label>Website</label>
                    <a href="#" id="clientWebsiteLink" target="_blank" class="info-link"></a>
                  </div>
                  <div class="info-item">
                    <label>Industry</label>
                    <span id="clientIndustryInfo"></span>
                  </div>
                  <div class="info-item">
                    <label>Research Status</label>
                    <span id="clientResearchStatus" class="research-badge pending"><span class="dot"></span></span>
                  </div>
                  <div class="info-item">
                    <label>Last Researched</label>
                    <span id="clientLastResearched"></span>
                  </div>
                </div>
              </div>
              <div class="section-card client-info-card">
                <h3>
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 20V10"/>
                    <path d="M18 20V4"/>
                    <path d="M6 20v-4"/>
                  </svg>
                  Quick Stats
                </h3>
                <div class="client-stats-grid">
                  <div class="client-stat-item">
                    <span class="stat-number" id="clientPagesCount">0</span>
                    <span class="stat-label">Pages</span>
                  </div>
                  <div class="client-stat-item">
                    <span class="stat-number" id="clientFactsCount">0</span>
                    <span class="stat-label">Facts</span>
                  </div>
                  <div class="client-stat-item">
                    <span class="stat-number" id="clientTestimonialsCount">0</span>
                    <span class="stat-label">Testimonials</span>
                  </div>
                </div>
              </div>
            </div>
            <div class="section-card">
              <div class="section-header">
                <div class="section-title">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
                  </svg>
                  <h2>Value Propositions</h2>
                </div>
              </div>
              <div id="clientValueProps" class="value-props-list">
                <p class="text-muted">No value propositions found. Run research to extract them.</p>
              </div>
            </div>
          </div>

          <!-- Brand Guide Tab -->
          <div id="clientTabBrand" class="client-tab-content">
            <div class="brand-guide-container">
              <div class="section-card brand-section-card">
                <div class="brand-section-header">
                  <h3>
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <circle cx="13.5" cy="6.5" r="2.5"/>
                      <circle cx="6.5" cy="17.5" r="2.5"/>
                      <circle cx="17.5" cy="17.5" r="2.5"/>
                      <path d="M13.5 9v1.5a3.5 3.5 0 0 1-3.5 3.5H9"/>
                      <path d="M6.5 15V10a3.5 3.5 0 0 1 3.5-3.5h1"/>
                      <path d="M17.5 15v-1.5a3.5 3.5 0 0 0-3.5-3.5H12"/>
                    </svg>
                    Colors
                  </h3>
                  <button class="btn btn-primary btn-small" onclick="saveBrandGuide()">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                      <polyline points="17 21 17 13 7 13 7 21"/>
                      <polyline points="7 3 7 8 15 8"/>
                    </svg>
                    Save Changes
                  </button>
                </div>
                <div class="brand-section-body">
                  <div class="color-grid">
                    <div class="color-item">
                      <label>Primary</label>
                      <div class="color-input-group">
                        <input type="color" id="brandPrimaryColor" value="#3974ff">
                        <input type="text" id="brandPrimaryColorHex" value="#3974ff" class="color-hex-input">
                      </div>
                    </div>
                    <div class="color-item">
                      <label>Secondary</label>
                      <div class="color-input-group">
                        <input type="color" id="brandSecondaryColor" value="#00ACE9">
                        <input type="text" id="brandSecondaryColorHex" value="#00ACE9" class="color-hex-input">
                      </div>
                    </div>
                    <div class="color-item">
                      <label>Accent</label>
                      <div class="color-input-group">
                        <input type="color" id="brandAccentColor" value="#3D916B">
                        <input type="text" id="brandAccentColorHex" value="#3D916B" class="color-hex-input">
                      </div>
                    </div>
                    <div class="color-item">
                      <label>Background</label>
                      <div class="color-input-group">
                        <input type="color" id="brandBackgroundColor" value="#ffffff">
                        <input type="text" id="brandBackgroundColorHex" value="#ffffff" class="color-hex-input">
                      </div>
                    </div>
                    <div class="color-item">
                      <label>Text</label>
                      <div class="color-input-group">
                        <input type="color" id="brandTextColor" value="#1f2937">
                        <input type="text" id="brandTextColorHex" value="#1f2937" class="color-hex-input">
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="section-card brand-section-card">
                <div class="brand-section-header">
                  <h3>
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <polyline points="4 7 4 4 20 4 20 7"/>
                      <line x1="9" y1="20" x2="15" y2="20"/>
                      <line x1="12" y1="4" x2="12" y2="20"/>
                    </svg>
                    Typography
                  </h3>
                </div>
                <div class="brand-section-body">
                  <div class="typography-grid">
                    <div class="form-group">
                      <label>Heading Font</label>
                      <input type="text" id="brandHeadingFont" placeholder="system-ui, -apple-system, sans-serif" class="research-input">
                    </div>
                    <div class="form-group">
                      <label>Body Font</label>
                      <input type="text" id="brandBodyFont" placeholder="system-ui, -apple-system, sans-serif" class="research-input">
                    </div>
                  </div>
                  <div class="font-preview">
                    <h4>Preview</h4>
                    <div id="fontPreviewHeading" style="font-size: 1.5rem; font-weight: 700; margin-bottom: 0.5rem; color: var(--text-dark);">Heading Text Sample</div>
                    <div id="fontPreviewBody" style="font-size: 1rem; line-height: 1.6; color: var(--text-medium);">Body text sample. This is how your landing page copy will look with the selected fonts.</div>
                  </div>
                </div>
              </div>

              <div class="section-card brand-section-card">
                <div class="brand-section-header">
                  <h3>
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <rect x="3" y="3" width="18" height="18" rx="2"/>
                      <path d="M3 9h18"/>
                      <path d="M9 21V9"/>
                    </svg>
                    Spacing & Layout
                  </h3>
                </div>
                <div class="brand-section-body">
                  <div class="spacing-grid">
                    <div class="form-group">
                      <label>Border Radius</label>
                      <input type="text" id="brandBorderRadius" placeholder="8px" class="research-input">
                    </div>
                    <div class="form-group">
                      <label>Spacing Unit</label>
                      <input type="text" id="brandSpacingUnit" placeholder="4px" class="research-input">
                    </div>
                    <div class="form-group">
                      <label>Max Width</label>
                      <input type="text" id="brandMaxWidth" placeholder="1200px" class="research-input">
                    </div>
                  </div>
                </div>
              </div>

              <div class="section-card brand-section-card">
                <div class="brand-section-header">
                  <h3>
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <rect x="3" y="3" width="18" height="18" rx="4"/>
                      <path d="M8 12h8"/>
                    </svg>
                    Button Styles
                  </h3>
                </div>
                <div class="brand-section-body">
                  <div class="button-preview-grid">
                    <div class="button-preview-item">
                      <label>Primary Button</label>
                      <button id="brandPrimaryBtnPreview" class="btn-preview-primary">Call to Action</button>
                    </div>
                    <div class="button-preview-item">
                      <label>Secondary Button</label>
                      <button id="brandSecondaryBtnPreview" class="btn-preview-secondary">Learn More</button>
                    </div>
                  </div>
                </div>
              </div>

              <div class="section-card brand-section-card">
                <div class="brand-section-header">
                  <h3>
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M12 20h9"/>
                      <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/>
                    </svg>
                    Brand Voice
                  </h3>
                </div>
                <div class="brand-section-body">
                  <div class="research-field">
                    <label>Tone</label>
                    <input type="text" id="brandVoiceTone" placeholder="professional, friendly, authoritative" class="research-input">
                  </div>
                  <div class="research-field">
                    <label>Keywords (comma-separated)</label>
                    <input type="text" id="brandVoiceKeywords" placeholder="innovative, trusted, premium" class="research-input">
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Research Tab -->
          <div id="clientTabResearch" class="client-tab-content">
            <div class="research-container">
              <div class="section-card research-section-card">
                <div class="research-section-header">
                  <h3>
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/>
                      <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>
                    </svg>
                    Business Research
                  </h3>
                  <button class="btn btn-primary btn-small" onclick="saveResearchData()">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                      <polyline points="17 21 17 13 7 13 7 21"/>
                      <polyline points="7 3 7 8 15 8"/>
                    </svg>
                    Save Changes
                  </button>
                </div>
                <div class="research-section-body">
                  <div class="research-field">
                    <label>Company Name</label>
                    <input type="text" id="researchCompanyName" class="research-input">
                  </div>
                  <div class="research-field">
                    <label>Industry</label>
                    <input type="text" id="researchIndustry" class="research-input">
                  </div>
                  <div class="research-field">
                    <label>Tagline</label>
                    <input type="text" id="researchTagline" class="research-input">
                  </div>
                  <div class="research-field">
                    <label>Value Propositions</label>
                    <textarea id="researchValueProps" class="research-textarea" placeholder="One per line"></textarea>
                  </div>
                  <div class="research-field">
                    <label>Brand Voice Description</label>
                    <textarea id="researchBrandVoice" class="research-textarea"></textarea>
                  </div>
                  <div class="research-field">
                    <label>Unique Differentiators</label>
                    <textarea id="researchDifferentiators" class="research-textarea" placeholder="One per line"></textarea>
                  </div>
                </div>
              </div>

              <div class="section-card research-section-card">
                <div class="research-section-header">
                  <h3>
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                      <polyline points="3.27 6.96 12 12.01 20.73 6.96"/>
                      <line x1="12" y1="22.08" x2="12" y2="12"/>
                    </svg>
                    Products/Services
                  </h3>
                  <button class="btn btn-secondary btn-small" onclick="addProductField()">
                    <svg width="14" height="14" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-width="2">
                      <line x1="7" y1="2" x2="7" y2="12"/>
                      <line x1="2" y1="7" x2="12" y2="7"/>
                    </svg>
                    Add Product
                  </button>
                </div>
                <div class="research-section-body">
                  <div id="researchProductsList" class="products-list">
                    <p class="text-muted">No products found. Run research or add manually.</p>
                  </div>
                </div>
              </div>

              <div class="section-card research-section-card">
                <div class="research-section-header">
                  <h3>
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                      <circle cx="9" cy="7" r="4"/>
                      <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                      <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                    </svg>
                    Target Audiences
                  </h3>
                </div>
                <div class="research-section-body">
                  <div id="researchAudiencesList" class="audiences-list">
                    <p class="text-muted">No target audiences found.</p>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Facts Tab -->
          <div id="clientTabFacts" class="client-tab-content">
            <div class="facts-container">
              <div class="section-card facts-section-card">
                <div class="facts-section-header">
                  <h3>
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                      <polyline points="22 4 12 14.01 9 11.01"/>
                    </svg>
                    Verified Claims
                  </h3>
                  <button class="btn btn-primary btn-small" onclick="addNewFact()">
                    <svg width="14" height="14" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-width="2">
                      <line x1="7" y1="2" x2="7" y2="12"/>
                      <line x1="2" y1="7" x2="12" y2="7"/>
                    </svg>
                    Add Fact
                  </button>
                </div>
                <div class="facts-section-body">
                  <div id="verifiedFactsList" class="facts-list">
                    <p class="text-muted">No verified facts yet. These are extracted during research.</p>
                  </div>
                </div>
              </div>

              <div class="section-card facts-section-card">
                <div class="facts-section-header">
                  <h3>
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                    </svg>
                    Testimonials
                  </h3>
                </div>
                <div class="facts-section-body">
                  <div id="testimonialsList" class="testimonials-grid">
                    <p class="text-muted">No testimonials found.</p>
                  </div>
                </div>
              </div>

              <div class="section-card facts-section-card">
                <div class="facts-section-header">
                  <h3>
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <line x1="18" y1="20" x2="18" y2="10"/>
                      <line x1="12" y1="20" x2="12" y2="4"/>
                      <line x1="6" y1="20" x2="6" y2="14"/>
                    </svg>
                    Statistics
                  </h3>
                </div>
                <div class="facts-section-body">
                  <div id="statisticsList" class="statistics-list">
                    <p class="text-muted">No statistics found.</p>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Pages Tab -->
          <div id="clientTabPages" class="client-tab-content">
            <div class="section-card client-pages-section">
              <div class="client-pages-header">
                <h3>
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                    <polyline points="14 2 14 8 20 8"/>
                    <line x1="16" y1="13" x2="8" y2="13"/>
                    <line x1="16" y1="17" x2="8" y2="17"/>
                    <polyline points="10 9 9 9 8 9"/>
                  </svg>
                  Generated Pages
                </h3>
                <button class="btn btn-primary btn-small" onclick="generatePageForClient()">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
                  </svg>
                  Generate New Page
                </button>
              </div>
              <div class="client-pages-body">
                <div id="clientPagesList" class="client-pages-list">
                  <p class="text-muted">No pages generated for this client yet.</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

        <!-- Domains Section (hidden by default) -->
        <div id="domainsSection" class="page-section" style="display: none;">
          <div class="section-card">
            <div class="section-header">
              <div class="section-title">
                <h2>Custom Domains</h2>
                <span class="badge" id="domainCount">0</span>
              </div>
              <div style="display: flex; gap: 0.5rem;">
                <button class="btn btn-secondary btn-small" onclick="loadAllDomains()">
                  <svg width="14" height="14" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M1 7a6 6 0 1 1 1 3.5"/>
                    <path d="M1 11V7h4"/>
                  </svg>
                  Refresh
                </button>
                <button class="btn btn-primary btn-small" onclick="openAddDomainFlow()">
                  <svg width="14" height="14" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="7" y1="2" x2="7" y2="12"/>
                    <line x1="2" y1="7" x2="12" y2="7"/>
                  </svg>
                  Add Custom Domain
                </button>
              </div>
            </div>

            <div style="padding: 1.5rem;">
              <!-- Info box about default URLs -->
              <div style="background: linear-gradient(135deg, rgba(59, 159, 216, 0.08) 0%, rgba(59, 159, 216, 0.03) 100%); border: 1px solid rgba(59, 159, 216, 0.15); border-radius: var(--radius-md); padding: 1.25rem; margin-bottom: 1.5rem;">
                <div style="display: flex; align-items: flex-start; gap: 1rem;">
                  <div style="width: 40px; height: 40px; background: var(--primary-blue); border-radius: 10px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                      <circle cx="12" cy="12" r="10"/>
                      <line x1="12" y1="16" x2="12" y2="12"/>
                      <line x1="12" y1="8" x2="12.01" y2="8"/>
                    </svg>
                  </div>
                  <div>
                    <div style="font-weight: 600; color: var(--text-dark); margin-bottom: 0.375rem;">Default Landing Page URLs</div>
                    <p style="color: var(--text-medium); font-size: 0.85rem; margin: 0; line-height: 1.5;">
                      All landing pages are available at <code style="background: white; padding: 0.125rem 0.375rem; border-radius: 4px; font-size: 0.8rem;">unicornmarketers.com/p/your-slug</code>.
                      Add a custom domain below to use your own branded URL.
                    </p>
                  </div>
                </div>
              </div>

              <!-- Stats -->
              <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;">
                <div style="background: var(--bg-light); border-radius: var(--radius-md); padding: 1rem; text-align: center;">
                  <div style="font-size: 2rem; font-weight: 700; color: var(--primary-blue);" id="customDomainCount">0</div>
                  <div style="font-size: 0.75rem; color: var(--text-medium);">Custom Domains</div>
                </div>
              </div>

              <!-- Add Domain Form (hidden by default) -->
              <div id="addDomainForm" style="display: none; margin-bottom: 1.5rem; padding: 1.5rem; background: white; border-radius: var(--radius-lg); border: 2px solid var(--primary-blue); box-shadow: 0 4px 12px rgba(59, 159, 216, 0.15);">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.25rem;">
                  <div style="display: flex; align-items: center; gap: 0.75rem;">
                    <div style="width: 36px; height: 36px; background: linear-gradient(135deg, var(--primary-blue) 0%, var(--primary-blue-dark) 100%); border-radius: 10px; display: flex; align-items: center; justify-content: center;">
                      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                        <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/>
                        <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/>
                      </svg>
                    </div>
                    <h4 style="font-size: 1rem; font-weight: 700; color: var(--text-dark); margin: 0;">Add Custom Domain</h4>
                  </div>
                  <button class="btn btn-icon btn-ghost" onclick="closeAddDomainForm()" style="padding: 0.25rem;">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <line x1="18" y1="6" x2="6" y2="18"/>
                      <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                  </button>
                </div>

                <div class="form-group" style="margin-bottom: 1.25rem;">
                  <label style="font-size: 0.85rem; font-weight: 600; color: var(--text-dark); display: block; margin-bottom: 0.5rem;">Select Landing Page</label>
                  <select id="domainPageSelect" onchange="updateDomainPageSelection()" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border-light); border-radius: 10px; font-size: 0.9rem; background: var(--bg-light);">
                    <option value="">-- Select a live page --</option>
                  </select>
                  <div id="noPagesMessage" style="display: none; margin-top: 0.75rem; padding: 1rem; background: var(--warning-light); border-radius: 10px; font-size: 0.85rem; color: #B8860B;">
                    No live pages found. <a href="#" onclick="showPage('pages'); return false;" style="color: var(--primary-blue); font-weight: 600;">Deploy a page first</a> to add a domain.
                  </div>
                </div>

                <div id="domainTypeSelection" style="display: none;">
                  <div style="margin-bottom: 1.25rem; padding: 1rem; background: linear-gradient(135deg, rgba(59, 159, 216, 0.1) 0%, rgba(59, 159, 216, 0.05) 100%); border: 1px solid rgba(59, 159, 216, 0.2); border-radius: 10px;">
                    <div style="font-size: 0.75rem; color: var(--text-medium); margin-bottom: 0.375rem; text-transform: uppercase; letter-spacing: 0.5px;">Current URL:</div>
                    <div style="font-family: 'SF Mono', Monaco, monospace; font-size: 0.9rem; color: var(--primary-blue); font-weight: 600;" id="currentPageUrl">unicornmarketers.com/p/slug</div>
                  </div>

                  <div class="form-group" style="margin-bottom: 1rem;">
                    <label style="font-size: 0.85rem; font-weight: 600; color: var(--text-dark); display: block; margin-bottom: 0.5rem;">Your Custom Domain</label>
                    <input type="text" id="addCustomDomainInput" placeholder="promo.yourbrand.com" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border-light); border-radius: 10px; font-size: 0.9rem; font-family: 'SF Mono', Monaco, monospace; background: var(--bg-light);">
                  </div>

                  <div style="padding: 1rem; background: linear-gradient(135deg, #FEF3C7 0%, #FEF9C3 100%); border: 1px solid #FCD34D; border-radius: 10px; font-size: 0.8rem; color: #92400E; margin-bottom: 1.25rem;">
                    <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <line x1="12" y1="8" x2="12" y2="12"/>
                        <line x1="12" y1="16" x2="12.01" y2="16"/>
                      </svg>
                      <strong>DNS Configuration Required</strong>
                    </div>
                    Add a CNAME record pointing to <code style="background: white; padding: 0.25rem 0.5rem; border-radius: 6px; font-family: monospace;">unicornmarketers.com</code>
                  </div>

                  <div style="display: flex; gap: 0.75rem; justify-content: flex-end; padding-top: 0.5rem; border-top: 1px solid var(--border-light);">
                    <button class="btn btn-secondary" onclick="closeAddDomainForm()">Cancel</button>
                    <button class="btn btn-primary" onclick="submitAddDomain()" id="submitDomainBtn">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 0.5rem;">
                        <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/>
                        <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/>
                      </svg>
                      Connect Domain
                    </button>
                  </div>
                </div>
              </div>

              <div id="allDomainsContainer">
                <div class="empty-state" style="padding: 3rem 2rem;">
                  <div class="empty-illustration"></div>
                  <h3>No custom domains configured</h3>
                  <p>Your pages are live at unicornmarketers.com/p/slug. Add a custom domain for branded URLs.</p>
                  <button class="btn btn-primary" onclick="openAddDomainFlow()">Add Custom Domain</button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Ad Generator Section (hidden by default) -->
        <div id="adGeneratorSection" class="page-section" style="display: none;">
          <div class="section-card">
            <div class="section-header">
              <div class="section-title">
                <h2>Meta Ad Generator</h2>
                <span class="badge badge-new">AI Powered</span>
              </div>
            </div>

            <div class="ad-generator-layout">
              <!-- Step 1: Client Selection -->
              <div class="ad-gen-step" id="adGenStep1">
                <h3 class="ad-gen-step-title">1. Select Client</h3>
                <div class="form-group">
                  <label for="adClientSelect">Client</label>
                  <select id="adClientSelect" onchange="loadClientForAdGen()">
                    <option value="">-- Select a client --</option>
                  </select>
                </div>
                <div id="adClientInfo" style="display: none;">
                  <div class="ad-client-info-card">
                    <div class="ad-client-info-header">
                      <span id="adClientName">Client Name</span>
                      <span class="industry-badge" id="adClientIndustry">Industry</span>
                    </div>
                    <div class="ad-client-info-body">
                      <div class="ad-client-stat">
                        <span class="stat-label">Products:</span>
                        <span id="adClientProducts">0</span>
                      </div>
                      <div class="ad-client-stat">
                        <span class="stat-label">Verified Claims:</span>
                        <span id="adClientClaims">0</span>
                      </div>
                      <div class="ad-client-stat">
                        <span class="stat-label">Brand Guide:</span>
                        <span id="adClientBrand">Not Set</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Step 2: Generation Mode -->
              <div class="ad-gen-step" id="adGenStep2" style="display: none;">
                <h3 class="ad-gen-step-title">2. Choose Generation Mode</h3>
                <div class="ad-gen-modes">
                  <div class="ad-gen-mode-card" onclick="selectAdGenMode('copy')" data-mode="copy">
                    <div class="ad-gen-mode-icon"></div>
                    <h4>Ad Copy</h4>
                    <p>Generate Meta ad copy with hooks, headlines, and CTAs</p>
                  </div>
                  <div class="ad-gen-mode-card" onclick="selectAdGenMode('image')" data-mode="image">
                    <div class="ad-gen-mode-icon"></div>
                    <h4>Image Prompts</h4>
                    <p>Generate Nano Banana 2 image prompts</p>
                  </div>
                  <div class="ad-gen-mode-card" onclick="selectAdGenMode('full')" data-mode="full">
                    <div class="ad-gen-mode-icon"></div>
                    <h4>Full Campaign</h4>
                    <p>Generate both copy and image prompts together</p>
                  </div>
                </div>
              </div>

              <!-- Step 3A: Copy Generation Options -->
              <div class="ad-gen-step" id="adGenCopyOptions" style="display: none;">
                <h3 class="ad-gen-step-title">3. Ad Copy Settings</h3>

                <div class="form-row">
                  <div class="form-group">
                    <label for="adCopyAdType">Ad Type</label>
                    <select id="adCopyAdType">
                      <option value="single_image">Single Image Ad</option>
                      <option value="carousel">Carousel Ad</option>
                      <option value="video">Video Ad</option>
                      <option value="story">Story Ad</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label for="adCopyTone">Tone</label>
                    <select id="adCopyTone">
                      <option value="conversational">Conversational</option>
                      <option value="urgent">Urgent</option>
                      <option value="professional">Professional</option>
                      <option value="playful">Playful</option>
                      <option value="authoritative">Authoritative</option>
                    </select>
                  </div>
                </div>

                <div class="form-group">
                  <label for="adCopyHook">Hook Framework</label>
                  <select id="adCopyHook">
                    <option value="problem_agitate">Problem-Agitate-Solution</option>
                    <option value="curiosity">Curiosity Gap</option>
                    <option value="contrarian">Contrarian</option>
                    <option value="social_proof">Social Proof</option>
                    <option value="direct_benefit">Direct Benefit</option>
                    <option value="story">Story Hook</option>
                    <option value="question">Question Hook</option>
                    <option value="statistic">Statistic Lead</option>
                    <option value="before_after">Before/After</option>
                    <option value="fear_of_missing">FOMO</option>
                  </select>
                </div>

                <div class="form-group">
                  <label for="adCopyAudience">Target Audience (Optional)</label>
                  <textarea id="adCopyAudience" rows="2" placeholder="Describe your ideal customer..."></textarea>
                </div>

                <div class="form-group">
                  <label for="adCopyOffer">Offer Details (Optional)</label>
                  <input type="text" id="adCopyOffer" placeholder="e.g., 20% off, Free shipping, etc.">
                </div>

                <div class="form-group">
                  <label for="adCopyVariations">Number of Variations</label>
                  <select id="adCopyVariations">
                    <option value="3">3 variations</option>
                    <option value="5" selected>5 variations</option>
                    <option value="10">10 variations</option>
                  </select>
                </div>
              </div>

              <!-- Step 3B: Image Prompt Options -->
              <div class="ad-gen-step" id="adGenImageOptions" style="display: none;">
                <h3 class="ad-gen-step-title">3. Image Prompt Settings</h3>

                <div class="form-group">
                  <label for="adImageAwareness">Awareness Level</label>
                  <select id="adImageAwareness">
                    <option value="unaware">Unaware - Pattern interrupt, curiosity</option>
                    <option value="problem_aware" selected>Problem Aware - Pain visualization</option>
                    <option value="solution_aware">Solution Aware - Differentiation</option>
                    <option value="product_aware">Product Aware - Social proof</option>
                    <option value="most_aware">Most Aware - Urgency, offer</option>
                  </select>
                </div>

                <div class="form-group">
                  <label>Cognitive Biases (Select 1-5)</label>
                  <div class="bias-grid" id="biasGrid">
                    <!-- Will be populated dynamically -->
                  </div>
                  <div class="power-stacks">
                    <span class="power-stack-label">Or use a Power Stack:</span>
                    <div class="power-stack-buttons">
                      <button type="button" class="power-stack-btn" onclick="selectPowerStack('urgency')">Urgency</button>
                      <button type="button" class="power-stack-btn" onclick="selectPowerStack('trust')">Trust</button>
                      <button type="button" class="power-stack-btn" onclick="selectPowerStack('desire')">Desire</button>
                      <button type="button" class="power-stack-btn" onclick="selectPowerStack('comparison')">Comparison</button>
                      <button type="button" class="power-stack-btn" onclick="selectPowerStack('identity')">Identity</button>
                    </div>
                  </div>
                </div>

                <div class="form-group">
                  <label>Ad Styles (Select 1-5)</label>
                  <div class="style-grid" id="styleGrid">
                    <!-- Will be populated dynamically -->
                  </div>
                </div>

                <div class="form-row">
                  <div class="form-group">
                    <label for="adImageAspect">Aspect Ratio</label>
                    <select id="adImageAspect">
                      <option value="4:5" selected>4:5 Vertical (Best for Feed)</option>
                      <option value="1:1">1:1 Square</option>
                      <option value="9:16">9:16 Stories/Reels</option>
                      <option value="16:9">16:9 Landscape</option>
                      <option value="1.91:1">1.91:1 Link Preview</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label for="adImagePrompts">Number of Prompts</label>
                    <select id="adImagePrompts">
                      <option value="3">3 prompts</option>
                      <option value="5" selected>5 prompts</option>
                      <option value="10">10 prompts</option>
                    </select>
                  </div>
                </div>

                <div class="form-group">
                  <label for="adImageConcept">Custom Concept (Optional)</label>
                  <textarea id="adImageConcept" rows="2" placeholder="Describe a specific ad image you want..."></textarea>
                </div>
              </div>

              <!-- Generate Button -->
              <div class="ad-gen-actions" id="adGenActions" style="display: none;">
                <button type="button" class="btn btn-secondary" onclick="resetAdGenerator()">
                  <svg width="14" height="14" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M1 7a6 6 0 1 1 1 3.5"/>
                    <path d="M1 11V7h4"/>
                  </svg>
                  Reset
                </button>
                <button type="button" class="btn btn-primary" onclick="generateAds()" id="generateAdsBtn">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
                  </svg>
                  Generate
                </button>
              </div>

              <!-- Results Section -->
              <div class="ad-gen-results" id="adGenResults" style="display: none;">
                <div class="ad-results-header">
                  <h3>Generated Results</h3>
                  <div class="ad-results-actions">
                    <button class="btn btn-secondary btn-small" onclick="copyAllResults()">
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
                      </svg>
                      Copy All
                    </button>
                    <button class="btn btn-secondary btn-small" onclick="exportResults()">
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                        <polyline points="7 10 12 15 17 10"/>
                        <line x1="12" y1="15" x2="12" y2="3"/>
                      </svg>
                      Export
                    </button>
                  </div>
                </div>

                <!-- Copy Results -->
                <div id="adCopyResults" style="display: none;">
                  <h4 class="results-section-title">Ad Copy Variations</h4>
                  <div id="adCopyResultsList" class="ad-copy-results-list"></div>
                </div>

                <!-- Image Prompt Results -->
                <div id="adImageResults" style="display: none;">
                  <h4 class="results-section-title">Image Prompts for Nano Banana 2</h4>
                  <div id="adImageResultsList" class="ad-image-results-list"></div>
                </div>

                <!-- Generation Stats -->
                <div class="ad-gen-stats">
                  <span id="adGenTokens">Tokens: 0</span>
                  <span id="adGenCost">Est. Cost: $0.00</span>
                </div>
              </div>
            </div>
          </div>
        </div>
    </main>
  </div>

  <!-- Create/Edit Modal -->
  <div class="modal-overlay" id="createModal">
    <div class="modal">
      <div class="modal-header">
        <h2 id="modalTitle"> New Landing Page</h2>
        <button class="modal-close" onclick="closeCreateModal()">&times;</button>
      </div>
      <div class="modal-body">
        <div id="deployResult"></div>
        <form id="pageForm">
          <input type="hidden" id="pageId">
          <div class="form-row">
            <div class="form-group">
              <label for="pageName">Page Name <span>*</span></label>
              <input type="text" id="pageName" placeholder="e.g., Summer Sale Landing Page" required>
            </div>
            <div class="form-group">
              <label for="clientName">Client Name</label>
              <input type="text" id="clientName" placeholder="e.g., Acme Corp">
            </div>
          </div>
          <div class="form-group">
            <label for="pageSlug">URL Slug</label>
            <input type="text" id="pageSlug" placeholder="summer-sale">
            <div class="form-hint">Leave blank to auto-generate from name</div>
          </div>
          <div class="form-group">
            <label for="htmlContent">HTML Content <span>*</span></label>
            <textarea id="htmlContent" placeholder="Paste your landing page HTML here..." required></textarea>
            <div class="form-hint">Paste the full HTML. Tracking code will be auto-injected.</div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="metaTitle">Meta Title</label>
              <input type="text" id="metaTitle" placeholder="Page title for SEO">
            </div>
            <div class="form-group">
              <label for="metaDescription">Meta Description</label>
              <input type="text" id="metaDescription" placeholder="Page description for SEO">
            </div>
          </div>
          <div class="form-group">
            <label for="trackingPixel">Custom Tracking Code</label>
            <textarea id="trackingPixel" style="min-height: 80px;" placeholder="Facebook Pixel, Google Analytics, etc."></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" onclick="closeCreateModal()">Cancel</button>
        <button type="button" class="btn btn-secondary" onclick="saveDraft()" id="saveDraftBtn">Save Draft</button>
        <button type="button" class="btn btn-success" onclick="deployPage()" id="deployBtn"> Deploy Live</button>
      </div>
    </div>
  </div>

  <!-- Analytics Modal -->
  <div class="modal-overlay" id="analyticsModal">
    <div class="modal modal-large">
      <div class="modal-header">
        <h2 id="analyticsTitle"> Page Analytics</h2>
        <button class="modal-close" onclick="closeAnalyticsModal()">&times;</button>
      </div>
      <div class="modal-body">
        <div class="tabs">
          <button class="tab active" onclick="switchTab(event, 'overview')">Overview</button>
          <button class="tab" onclick="switchTab(event, 'leads')">Leads</button>
          <button class="tab" onclick="switchTab(event, 'abtest')">A/B Testing</button>
        </div>
        <div id="tabOverview" class="tab-content active">
          <div class="analytics-grid">
            <div class="analytics-card">
              <div class="label">Page Views</div>
              <div class="value" id="aViews">0</div>
            </div>
            <div class="analytics-card">
              <div class="label">Leads</div>
              <div class="value" id="aLeads">0</div>
            </div>
            <div class="analytics-card">
              <div class="label">Conversion Rate</div>
              <div class="value" id="aConversion">0%</div>
            </div>
          </div>
          <h4 style="margin-bottom: 1rem; font-weight: 600;">Traffic Sources</h4>
          <div id="trafficSources"></div>
        </div>
        <div id="tabLeads" class="tab-content">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
            <h4 style="font-weight: 600;">Captured Leads</h4>
            <button class="btn btn-small btn-secondary" onclick="exportLeads()">Export CSV</button>
          </div>
          <div id="leadsTable"></div>
        </div>
        <div id="tabAbtest" class="tab-content">
          <h4 style="margin-bottom: 1rem; font-weight: 600;">A/B Test Results</h4>
          <div id="abtestResults"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Domain Configuration Modal -->
  <div class="modal-overlay" id="domainModal">
    <div class="modal" style="max-width: 600px;">
      <div class="modal-header">
        <h2> Configure Domain</h2>
        <button class="modal-close" onclick="closeDomainModal()">&times;</button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="domainPageId">

        <div class="domain-current" id="domainCurrentUrl" style="margin-bottom: 1.25rem;">
          <div style="font-size: 0.75rem; color: var(--text-medium); margin-bottom: 0.25rem;">Current URL</div>
          <a href="#" target="_blank" id="domainCurrentLink" style="font-family: monospace; font-size: 0.9rem; color: var(--primary-blue);"></a>
        </div>

        <div class="domain-section-title">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <line x1="2" y1="12" x2="22" y2="12"/>
            <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>
          </svg>
          Choose Domain Type
        </div>

        <div class="domain-options">
          <!-- Option 1: Unicorn Subdomain -->
          <div class="domain-option selected" onclick="selectDomainType('subdomain')" id="domainOptionSubdomain">
            <div class="domain-option-header">
              <div class="domain-option-radio"></div>
              <span class="domain-option-title">Unicorn Subdomain</span>
              <span class="domain-option-badge">FREE</span>
            </div>
            <div class="domain-option-description">Use a branded subdomain on our platform. No DNS setup required.</div>
            <div class="domain-preview" id="subdomainPreview">your-page.pages.unicornmarketers.com</div>
          </div>

          <!-- Option 2: Custom Domain -->
          <div class="domain-option" onclick="selectDomainType('custom')" id="domainOptionCustom">
            <div class="domain-option-header">
              <div class="domain-option-radio"></div>
              <span class="domain-option-title">Custom Domain</span>
              <span class="domain-option-badge pro">PRO</span>
            </div>
            <div class="domain-option-description">Use your own domain or subdomain. Requires DNS configuration.</div>
            <div class="domain-input-group" id="customDomainInput" style="display: none;">
              <input type="text" id="customDomainValue" placeholder="landing.yourdomain.com">
            </div>
          </div>
        </div>

        <!-- DNS Instructions (shown for custom domains) -->
        <div class="dns-instructions" id="dnsInstructions" style="display: none;">
          <div class="dns-instructions-title">DNS Configuration Required</div>
          <div class="dns-record">
            <div class="dns-record-header">Type</div>
            <div class="dns-record-header">Name</div>
            <div class="dns-record-header">Value</div>
          </div>
          <div class="dns-record">
            <div class="dns-record-value">CNAME</div>
            <div class="dns-record-value" id="dnsRecordName">landing</div>
            <div class="dns-record-value">pages.unicornmarketers.com</div>
          </div>
          <div class="dns-status">
            <div class="dns-status-indicator pending" id="dnsStatusIndicator"></div>
            <span id="dnsStatusText">Pending verification - DNS changes can take up to 48 hours</span>
          </div>
        </div>

        <!-- Existing Domains -->
        <div id="existingDomainsSection" style="margin-top: 1.5rem; display: none;">
          <div class="domain-section-title">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/>
              <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/>
            </svg>
            Connected Domains
          </div>
          <div class="domain-list" id="existingDomainsList"></div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" onclick="closeDomainModal()">Cancel</button>
        <button type="button" class="btn btn-primary" onclick="saveDomainConfig()" id="saveDomainBtn">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 0.5rem;">
            <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/>
            <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/>
          </svg>
          Connect Domain
        </button>
      </div>
    </div>
  </div>

  <!-- Generate Page Modal -->
  <div class="modal-overlay" id="generateModal">
    <div class="modal" style="max-width: 1000px;">
      <div class="modal-header">
        <h2> Generate Landing Page</h2>
        <button class="modal-close" onclick="closeGenerateModal()">&times;</button>
      </div>
      <div class="modal-body">
        <!-- Step 1: Page Type Selection (shown by default) -->
        <div id="generateStep1">
          <p style="margin-bottom: 1.5rem; color: var(--text-medium);">Choose the type of page you want to create:</p>

          <div class="generate-options" style="grid-template-columns: repeat(5, 1fr);">
            <div class="generate-option" onclick="selectGenerateType('advertorial')" data-type="advertorial">
              <div class="generate-option-icon"></div>
              <h4>Advertorial</h4>
              <p>Editorial-style long-form sales page</p>
            </div>
            <div class="generate-option" onclick="selectGenerateType('listicle')" data-type="listicle">
              <div class="generate-option-icon"></div>
              <h4>Listicle</h4>
              <p>Native ad disguised as helpful tips article</p>
            </div>
            <div class="generate-option" onclick="selectGenerateType('quiz')" data-type="quiz">
              <div class="generate-option-icon"></div>
              <h4>Quiz Funnel</h4>
              <p>Interactive quiz with personalized results</p>
            </div>
            <div class="generate-option" onclick="selectGenerateType('vip')" data-type="vip">
              <div class="generate-option-icon"></div>
              <h4>VIP Signup</h4>
              <p>Exclusive waitlist or insider access page</p>
            </div>
            <div class="generate-option" onclick="selectGenerateType('calculator')" data-type="calculator">
              <div class="generate-option-icon"></div>
              <h4>Calculator</h4>
              <p>Interactive savings or ROI calculator</p>
            </div>
          </div>

          <div class="form-group">
            <label for="generateProduct">Product/Offer URL or Description <span>*</span></label>
            <input type="text" id="generateProduct" placeholder="https://example.com/product or describe your offer...">
          </div>

          <div class="form-group">
            <label for="generateAudience">Target Audience</label>
            <textarea id="generateAudience" style="min-height: 80px;" placeholder="Describe your ideal customer..."></textarea>
          </div>

          <div class="form-group">
            <label for="generateTone">Tone & Style</label>
            <select id="generateTone">
              <option value="professional">Professional & Trustworthy</option>
              <option value="urgent">Urgent & Exciting</option>
              <option value="friendly">Friendly & Conversational</option>
              <option value="authoritative">Authoritative & Expert</option>
            </select>
          </div>
        </div>

        <!-- Step 2: Pipeline Progress (shown during generation) -->
        <div id="generateStep2" style="display: none;">
          <div class="pipeline-progress">
            <h3 style="margin-bottom: 1.5rem; text-align: center;">Generating Your Landing Page</h3>

            <div class="pipeline-steps">
              <div class="pipeline-step" data-step="research">
                <div class="step-indicator">
                  <div class="step-icon"></div>
                  <div class="step-status"></div>
                </div>
                <div class="step-info">
                  <div class="step-name">Deep Research</div>
                  <div class="step-desc">Analyzing website and extracting business info</div>
                </div>
              </div>

              <div class="pipeline-step" data-step="brand">
                <div class="step-indicator">
                  <div class="step-icon"></div>
                  <div class="step-status"></div>
                </div>
                <div class="step-info">
                  <div class="step-name">Brand Extraction</div>
                  <div class="step-desc">Extracting colors, fonts, and style guide</div>
                </div>
              </div>

              <div class="pipeline-step" data-step="strategy">
                <div class="step-indicator">
                  <div class="step-icon"></div>
                  <div class="step-status"></div>
                </div>
                <div class="step-info">
                  <div class="step-name">Page Strategy</div>
                  <div class="step-desc">Creating page outline and messaging</div>
                </div>
              </div>

              <div class="pipeline-step" data-step="copy">
                <div class="step-indicator">
                  <div class="step-icon"></div>
                  <div class="step-status"></div>
                </div>
                <div class="step-info">
                  <div class="step-name">Copy Generation</div>
                  <div class="step-desc">Writing compelling, verified copy</div>
                </div>
              </div>

              <div class="pipeline-step" data-step="design">
                <div class="step-indicator">
                  <div class="step-icon"></div>
                  <div class="step-status"></div>
                </div>
                <div class="step-info">
                  <div class="step-name">Design Generation</div>
                  <div class="step-desc">Building beautiful, on-brand HTML</div>
                </div>
              </div>

              <div class="pipeline-step" data-step="factcheck">
                <div class="step-indicator">
                  <div class="step-icon"></div>
                  <div class="step-status"></div>
                </div>
                <div class="step-info">
                  <div class="step-name">Fact Checking</div>
                  <div class="step-desc">Verifying all claims and statistics</div>
                </div>
              </div>

              <div class="pipeline-step" data-step="assembly">
                <div class="step-indicator">
                  <div class="step-icon"></div>
                  <div class="step-status"></div>
                </div>
                <div class="step-info">
                  <div class="step-name">Final Assembly</div>
                  <div class="step-desc">QA checks and page finalization</div>
                </div>
              </div>
            </div>

            <div class="pipeline-summary" id="pipelineSummary" style="display: none;">
              <div class="summary-stats">
                <div class="summary-stat">
                  <span class="stat-label">Tokens Used:</span>
                  <span class="stat-value" id="summaryTokens">0</span>
                </div>
                <div class="summary-stat">
                  <span class="stat-label">Est. Cost:</span>
                  <span class="stat-value" id="summaryCost">$0.00</span>
                </div>
                <div class="summary-stat">
                  <span class="stat-label">Facts Verified:</span>
                  <span class="stat-value" id="summaryFacts">0</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" onclick="closeGenerateModal()" id="generateCancelBtn">Cancel</button>
        <button type="button" class="btn btn-primary" onclick="generatePageV2()" id="generateBtn">
           Generate Page
        </button>
      </div>
    </div>
  </div>

  <!-- Visual Editor Modal -->
  <div class="modal-overlay" id="editorModal">
    <div class="modal modal-large" style="max-width: 98vw; height: 95vh;">
      <div class="modal-header" style="padding: 0.75rem 1rem;">
        <h2 id="editorTitle" style="font-size: 1rem;"> Edit Page</h2>
        <div style="display: flex; align-items: center; gap: 0.75rem;">
          <div class="device-toggle">
            <button class="device-btn active" onclick="setDevicePreview('desktop')" title="Desktop">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg>
            </button>
            <button class="device-btn" onclick="setDevicePreview('tablet')" title="Tablet">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="4" y="2" width="16" height="20" rx="2"/><line x1="12" y1="18" x2="12" y2="18"/></svg>
            </button>
            <button class="device-btn" onclick="setDevicePreview('mobile')" title="Mobile">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="6" y="2" width="12" height="20" rx="2"/><line x1="12" y1="18" x2="12" y2="18"/></svg>
            </button>
          </div>
          <button class="modal-close" onclick="closeEditorModal()">&times;</button>
        </div>
      </div>
      <div class="modal-body" style="padding: 0; height: calc(100% - 110px); overflow: hidden;">
        <div class="editor-container">
          <!-- Toolbar -->
          <div class="editor-toolbar">
            <!-- Text Formatting -->
            <div class="toolbar-group">
              <span class="toolbar-label">Text</span>
              <button class="toolbar-btn" onclick="editorCommand('bold')" title="Bold">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M6 4h8a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z"/><path d="M6 12h9a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z"/></svg>
              </button>
              <button class="toolbar-btn" onclick="editorCommand('italic')" title="Italic">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="19" y1="4" x2="10" y2="4"/><line x1="14" y1="20" x2="5" y2="20"/><line x1="15" y1="4" x2="9" y2="20"/></svg>
              </button>
              <button class="toolbar-btn" onclick="editorCommand('underline')" title="Underline">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 4v6a6 6 0 0 0 12 0V4"/><line x1="4" y1="20" x2="20" y2="20"/></svg>
              </button>
            </div>

            <!-- Headings -->
            <div class="toolbar-group">
              <select class="toolbar-select" onchange="editorHeading(this.value)" id="headingSelect">
                <option value="">Heading</option>
                <option value="h1">Heading 1</option>
                <option value="h2">Heading 2</option>
                <option value="h3">Heading 3</option>
                <option value="p">Paragraph</option>
              </select>
            </div>

            <!-- Font -->
            <div class="toolbar-group">
              <select class="toolbar-select" onchange="editorFont(this.value)" id="fontSelect">
                <option value="">Font</option>
                <option value="Arial, sans-serif">Arial</option>
                <option value="Georgia, serif">Georgia</option>
                <option value="'Times New Roman', serif">Times New Roman</option>
                <option value="Verdana, sans-serif">Verdana</option>
                <option value="'Courier New', monospace">Courier</option>
                <option value="'Trebuchet MS', sans-serif">Trebuchet</option>
                <option value="Impact, sans-serif">Impact</option>
              </select>
              <select class="toolbar-select" onchange="editorFontSize(this.value)" id="fontSizeSelect" style="min-width: 70px;">
                <option value="">Size</option>
                <option value="12px">12px</option>
                <option value="14px">14px</option>
                <option value="16px">16px</option>
                <option value="18px">18px</option>
                <option value="20px">20px</option>
                <option value="24px">24px</option>
                <option value="28px">28px</option>
                <option value="32px">32px</option>
                <option value="36px">36px</option>
                <option value="48px">48px</option>
              </select>
            </div>

            <!-- Colors -->
            <div class="toolbar-group">
              <span class="toolbar-label">Color</span>
              <input type="color" class="toolbar-color" id="textColorPicker" value="#000000" onchange="editorTextColor(this.value)" title="Text Color">
              <input type="color" class="toolbar-color" id="bgColorPicker" value="#ffffff" onchange="editorBgColor(this.value)" title="Background Color">
            </div>

            <!-- Alignment -->
            <div class="toolbar-group">
              <button class="toolbar-btn" onclick="editorCommand('justifyLeft')" title="Align Left">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="15" y2="12"/><line x1="3" y1="18" x2="18" y2="18"/></svg>
              </button>
              <button class="toolbar-btn" onclick="editorCommand('justifyCenter')" title="Align Center">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="6" x2="21" y2="6"/><line x1="6" y1="12" x2="18" y2="12"/><line x1="4" y1="18" x2="20" y2="18"/></svg>
              </button>
              <button class="toolbar-btn" onclick="editorCommand('justifyRight')" title="Align Right">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="6" x2="21" y2="6"/><line x1="9" y1="12" x2="21" y2="12"/><line x1="6" y1="18" x2="21" y2="18"/></svg>
              </button>
            </div>

            <!-- Lists -->
            <div class="toolbar-group">
              <button class="toolbar-btn" onclick="editorCommand('insertUnorderedList')" title="Bullet List">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="9" y1="6" x2="20" y2="6"/><line x1="9" y1="12" x2="20" y2="12"/><line x1="9" y1="18" x2="20" y2="18"/><circle cx="4" cy="6" r="1.5" fill="currentColor"/><circle cx="4" cy="12" r="1.5" fill="currentColor"/><circle cx="4" cy="18" r="1.5" fill="currentColor"/></svg>
              </button>
              <button class="toolbar-btn" onclick="editorCommand('insertOrderedList')" title="Numbered List">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="10" y1="6" x2="21" y2="6"/><line x1="10" y1="12" x2="21" y2="12"/><line x1="10" y1="18" x2="21" y2="18"/><text x="4" y="8" font-size="6" fill="currentColor">1</text><text x="4" y="14" font-size="6" fill="currentColor">2</text><text x="4" y="20" font-size="6" fill="currentColor">3</text></svg>
              </button>
            </div>

            <!-- Link & Image -->
            <div class="toolbar-group">
              <button class="toolbar-btn" onclick="openLinkEditor()" title="Insert Link">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>
              </button>
              <button class="toolbar-btn" onclick="openImageUpload()" title="Insert Image">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><path d="M21 15l-5-5L5 21"/></svg>
              </button>
            </div>

            <!-- Undo/Redo -->
            <div class="toolbar-group">
              <button class="toolbar-btn" onclick="editorCommand('undo')" title="Undo">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 7v6h6"/><path d="M3 13a9 9 0 1 0 2.636-6.364L3 9"/></svg>
              </button>
              <button class="toolbar-btn" onclick="editorCommand('redo')" title="Redo">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 7v6h-6"/><path d="M21 13a9 9 0 1 1-2.636-6.364L21 9"/></svg>
              </button>
            </div>
          </div>

          <!-- Main Editor Area -->
          <div class="editor-main">
            <!-- Preview Panel -->
            <div class="editor-preview-wrapper">
              <div class="preview-header">
                <span class="preview-dot red"></span>
                <span class="preview-dot yellow"></span>
                <span class="preview-dot green"></span>
                <span class="preview-url" id="previewUrl">Preview</span>
              </div>
              <div class="editor-iframe-container" id="iframeContainer">
                <iframe id="editorPreview"></iframe>
              </div>
            </div>

            <!-- Sidebar -->
            <div class="editor-sidebar">
              <!-- AI Chat Panel -->
              <div class="sidebar-panel">
                <div class="panel-header" onclick="togglePanel(this)">
                  <h4> AI Assistant</h4>
                  <span class="panel-toggle"></span>
                </div>
                <div class="panel-content">
                  <div class="chat-messages" id="chatMessages">
                    <div class="chat-message assistant">
                      Describe changes you want to make, like "change headline color to blue" or "make the button bigger"
                    </div>
                  </div>
                  <div class="chat-input-wrapper">
                    <textarea class="chat-input" id="chatInput" placeholder="Describe changes..." rows="2"></textarea>
                    <button class="btn btn-primary btn-icon" onclick="sendChatMessage()" id="chatSendBtn">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="22" y1="2" x2="11" y2="13"/>
                        <polygon points="22,2 15,22 11,13 2,9"/>
                      </svg>
                    </button>
                  </div>
                </div>
              </div>

              <!-- Quick Insert Panel -->
              <div class="sidebar-panel">
                <div class="panel-header" onclick="togglePanel(this)">
                  <h4> Quick Insert</h4>
                  <span class="panel-toggle"></span>
                </div>
                <div class="panel-content">
                  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;">
                    <button class="btn btn-secondary btn-small" onclick="insertElement('button')">Button</button>
                    <button class="btn btn-secondary btn-small" onclick="insertElement('heading')">Heading</button>
                    <button class="btn btn-secondary btn-small" onclick="insertElement('paragraph')">Paragraph</button>
                    <button class="btn btn-secondary btn-small" onclick="insertElement('divider')">Divider</button>
                    <button class="btn btn-secondary btn-small" onclick="insertElement('testimonial')">Testimonial</button>
                    <button class="btn btn-secondary btn-small" onclick="insertElement('cta')">CTA Section</button>
                  </div>
                </div>
              </div>

              <!-- Image Upload Panel -->
              <div class="sidebar-panel">
                <div class="panel-header" onclick="togglePanel(this)">
                  <h4> Add Image</h4>
                  <span class="panel-toggle"></span>
                </div>
                <div class="panel-content">
                  <div class="upload-zone" onclick="document.getElementById('imageUploadInput').click()">
                    <div class="upload-zone-icon"></div>
                    <div class="upload-zone-text">Click to upload image</div>
                    <div class="upload-zone-hint">or paste URL below</div>
                  </div>
                  <input type="file" id="imageUploadInput" accept="image/*" style="display: none;" onchange="handleImageUpload(event)">
                  <div style="margin-top: 0.75rem;">
                    <input type="text" class="property-input" id="imageUrlInput" placeholder="https://example.com/image.jpg" style="width: 100%;">
                    <button class="btn btn-small btn-primary" style="width: 100%; margin-top: 0.5rem;" onclick="insertImageFromUrl()">Insert Image</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" onclick="closeEditorModal()">Cancel</button>
        <button type="button" class="btn btn-secondary" onclick="saveWithoutDeploy()" id="saveOnlyBtn"> Save Draft</button>
        <button type="button" class="btn btn-success" onclick="saveAndDeploy()" id="saveDeployBtn"> Save & Deploy</button>
      </div>
    </div>
  </div>

  <!-- Link Editor Popup -->
  <div class="link-editor-backdrop" id="linkEditorBackdrop" onclick="closeLinkEditor()"></div>
  <div class="link-editor-popup" id="linkEditorPopup">
    <h4 style="margin-bottom: 1rem; font-weight: 600;">Insert Link</h4>
    <div class="form-group" style="margin-bottom: 1rem;">
      <label style="font-size: 0.8rem; margin-bottom: 0.25rem; display: block;">Link Text</label>
      <input type="text" id="linkText" class="property-input" style="width: 100%;" placeholder="Click here">
    </div>
    <div class="form-group" style="margin-bottom: 1rem;">
      <label style="font-size: 0.8rem; margin-bottom: 0.25rem; display: block;">URL</label>
      <input type="text" id="linkUrl" class="property-input" style="width: 100%;" placeholder="https://example.com">
    </div>
    <div class="form-group" style="margin-bottom: 1rem;">
      <label style="font-size: 0.8rem; display: flex; align-items: center; gap: 0.5rem;">
        <input type="checkbox" id="linkNewTab" checked> Open in new tab
      </label>
    </div>
    <div style="display: flex; gap: 0.5rem; justify-content: flex-end;">
      <button class="btn btn-secondary btn-small" onclick="closeLinkEditor()">Cancel</button>
      <button class="btn btn-primary btn-small" onclick="insertLink()">Insert Link</button>
    </div>
  </div>

  <script>
    // ============================================
    // GLOBALS
    // ============================================
    let currentPageId = null;
    let pages = [];
    let clients = [];
    let selectedGenerateType = null;
    let currentEditingPage = null;

    // ============================================
    // TOAST NOTIFICATIONS
    // ============================================
    function showToast(message, type = 'info') {
      // Remove existing toast
      const existingToast = document.querySelector('.toast-notification');
      if (existingToast) existingToast.remove();

      // Create toast element
      const toast = document.createElement('div');
      toast.className = `toast-notification toast-${type}`;
      toast.innerHTML = `
        <span class="toast-icon">${type === 'success' ? '&#10003;' : type === 'error' ? '&#10007;' : type === 'warning' ? '&#9888;' : '&#8505;'}</span>
        <span class="toast-message">${message}</span>
      `;

      document.body.appendChild(toast);

      // Animate in
      setTimeout(() => toast.classList.add('show'), 10);

      // Auto remove after 4 seconds
      setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => toast.remove(), 300);
      }, 4000);
    }

    // ============================================
    // LOADING & INIT
    // ============================================
    window.addEventListener('load', () => {
      setTimeout(() => {
        document.getElementById('loadingScreen').classList.add('hidden');
      }, 1200);
      loadPages();
      loadClients();
      // Handle URL routing on load
      handleRouteChange();
    });

    // ============================================
    // URL-BASED ROUTING
    // ============================================
    function handleRouteChange() {
      const hash = window.location.hash.slice(1) || 'dashboard';
      const [page, ...params] = hash.split('/');

      switch (page) {
        case 'dashboard':
          showPage('dashboard');
          break;
        case 'pages':
          showPage('pages');
          break;
        case 'clients':
          if (params[0]) {
            openClientDetail(params[0]);
          } else {
            showPage('clients');
          }
          break;
        case 'ad-generator':
          showPage('adGenerator');
          break;
        case 'analytics':
          showPage('analytics');
          break;
        case 'leads':
          showPage('leads');
          break;
        case 'domains':
          showPage('domains');
          break;
        default:
          showPage('dashboard');
      }
    }

    // Listen for hash changes
    window.addEventListener('hashchange', handleRouteChange);

    // Update hash when navigating (without triggering hashchange)
    function navigateTo(page, subPath = '') {
      const newHash = subPath ? `#${page}/${subPath}` : `#${page}`;
      if (window.location.hash !== newHash) {
        history.pushState(null, '', newHash);
      }
    }

    // ============================================
    // CLIENT MANAGEMENT
    // ============================================
    let currentClientId = null;
    let currentClientData = null;
    let currentBrandGuide = null;

    async function loadClients() {
      try {
        const res = await fetch('/api/clients');
        const result = await res.json();
        if (result.success) {
          clients = result.clients || [];
          document.getElementById('navClientCount').textContent = clients.length;
        }
      } catch (error) {
        console.error('Failed to load clients:', error);
      }
    }

    async function loadClientsPage() {
      try {
        const res = await fetch('/api/clients');
        const result = await res.json();
        if (result.success) {
          clients = result.clients || [];
          renderClientsList();
        }
      } catch (error) {
        console.error('Failed to load clients:', error);
      }
    }

    function renderClientsList() {
      const container = document.getElementById('clientsListContainer');
      document.getElementById('clientsPageCount').textContent = clients.length;

      if (clients.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-illustration"></div>
            <h3>No clients yet</h3>
            <p>Add your first client to store their brand assets and research.</p>
            <button class="btn btn-primary" onclick="openAddClientModal()">Add Client</button>
          </div>
        `;
        return;
      }

      const getInitials = (name) => {
        return name.split(' ').map(w => w[0]).join('').substring(0, 2).toUpperCase();
      };

      container.innerHTML = `
        <table class="clients-table">
          <thead>
            <tr>
              <th>Client</th>
              <th>Industry</th>
              <th>Research Status</th>
              <th>Created</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            ${clients.map(c => `
              <tr onclick="openClientDetail('${c.id}')">
                <td>
                  <div class="client-name-cell">
                    <div class="client-avatar">${getInitials(c.name)}</div>
                    <div class="client-name-info">
                      <strong>${escapeHtml(c.name)}</strong>
                      <small>${c.website_url ? escapeHtml(c.website_url.replace('https://', '').replace('http://', '').split('/')[0]) : 'No website'}</small>
                    </div>
                  </div>
                </td>
                <td>${c.industry ? `<span class="industry-badge">${escapeHtml(c.industry)}</span>` : '<span class="text-muted"></span>'}</td>
                <td>
                  <span class="research-badge ${c.research_status === 'completed' ? 'completed' : 'pending'}">
                    <span class="dot"></span>
                    ${c.research_status === 'completed' ? 'Completed' : 'Pending'}
                  </span>
                </td>
                <td><span class="text-muted">${new Date(c.created_at).toLocaleDateString()}</span></td>
                <td>
                  <div class="actions">
                    <button class="btn btn-ghost btn-icon" onclick="event.stopPropagation(); deleteClient('${c.id}')" title="Delete">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="3 6 5 6 21 6"/>
                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                      </svg>
                    </button>
                  </div>
                </td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      `;
    }

    function openAddClientModal() {
      const name = prompt('Enter client name:');
      if (!name) return;

      const url = prompt('Enter client website URL (optional):');
      createClient(name, url);
    }

    async function createClient(name, websiteUrl) {
      try {
        const res = await fetch('/api/clients', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ name, website_url: websiteUrl || null })
        });
        const result = await res.json();
        if (result.success) {
          alert('Client created! You can now generate pages for this client.');
          loadClients();
          loadClientsPage();
        } else {
          throw new Error(result.error);
        }
      } catch (error) {
        alert('Error creating client: ' + error.message);
      }
    }

    async function deleteClient(id) {
      if (!confirm('Delete this client? This will also delete their brand guide and verified facts. This cannot be undone.')) return;

      try {
        const res = await fetch(`/api/clients/${id}`, { method: 'DELETE' });
        if (!res.ok) throw new Error((await res.json()).error);
        loadClients();
        loadClientsPage();
      } catch (error) {
        alert('Error: ' + error.message);
      }
    }

    // ============================================
    // PAGE NAVIGATION
    // ============================================
    function showPage(pageName, updateUrl = true) {
      // Update nav items
      document.querySelectorAll('.nav-item[data-page]').forEach(item => {
        item.classList.toggle('active', item.dataset.page === pageName);
      });

      // Update page title
      const titles = {
        dashboard: 'Dashboard',
        pages: 'Landing Pages',
        clients: 'Clients',
        analytics: 'Analytics',
        leads: 'Leads',
        adGenerator: 'Ad Generator',
        domains: 'Domains'
      };
      const pageTitle = document.getElementById('mainPageTitle') || document.querySelector('.page-title');
      if (pageTitle) pageTitle.textContent = titles[pageName] || 'Dashboard';

      // Get all sections
      const dashboardSection = document.getElementById('dashboardSection');
      const pagesSection = document.getElementById('pagesSection');
      const clientsSection = document.getElementById('clientsSection');
      const clientDetailSection = document.getElementById('clientDetailSection');
      const adGeneratorSection = document.getElementById('adGeneratorSection');
      const domainsSection = document.getElementById('domainsSection');

      // Hide all sections first
      if (dashboardSection) dashboardSection.style.display = 'none';
      if (pagesSection) pagesSection.style.display = 'none';
      if (clientsSection) clientsSection.style.display = 'none';
      if (clientDetailSection) clientDetailSection.style.display = 'none';
      if (adGeneratorSection) adGeneratorSection.style.display = 'none';
      if (domainsSection) domainsSection.style.display = 'none';

      // Map page names to URL hashes
      const urlMap = {
        dashboard: 'dashboard',
        pages: 'pages',
        clients: 'clients',
        adGenerator: 'ad-generator',
        analytics: 'analytics',
        leads: 'leads',
        domains: 'domains'
      };

      // Show relevant sections based on page
      if (pageName === 'dashboard') {
        if (dashboardSection) dashboardSection.style.display = 'block';
        loadRecentClients();
      } else if (pageName === 'pages') {
        if (pagesSection) pagesSection.style.display = 'block';
        loadAllPages();
      } else if (pageName === 'clients') {
        if (clientsSection) clientsSection.style.display = 'block';
        loadClientsPage();
      } else if (pageName === 'adGenerator') {
        if (adGeneratorSection) adGeneratorSection.style.display = 'block';
        initAdGenerator();
      } else if (pageName === 'domains') {
        if (domainsSection) domainsSection.style.display = 'block';
        loadAllDomains();
      }

      // Update URL hash (without triggering hashchange event)
      if (updateUrl && urlMap[pageName]) {
        const newHash = `#${urlMap[pageName]}`;
        if (window.location.hash !== newHash) {
          history.replaceState(null, '', newHash);
        }
      }

      closeSidebar();
    }

    // Load recent clients for dashboard
    async function loadRecentClients() {
      try {
        const res = await fetch('/api/clients');
        const result = await res.json();

        const container = document.getElementById('recentClientsContainer');
        if (!container) return;

        if (!result.success || !result.clients || result.clients.length === 0) {
          container.innerHTML = `
            <div class="empty-state" style="padding: 2rem;">
              <div class="empty-illustration"></div>
              <h3>No clients yet</h3>
              <p>Add your first client to get started.</p>
              <button class="btn btn-secondary" onclick="openAddClientModal()">Add Client</button>
            </div>
          `;
          return;
        }

        // Show up to 5 recent clients
        const recentClients = result.clients.slice(0, 5);
        container.innerHTML = recentClients.map(client => `
          <div class="activity-item" onclick="openClientDetail('${client.id}')">
            <div class="activity-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                <circle cx="9" cy="7" r="4"/>
              </svg>
            </div>
            <div class="activity-content">
              <div class="activity-title">${client.name}</div>
              <div class="activity-meta">${client.industry || 'No industry'}  ${client.page_count || 0} pages</div>
            </div>
            <div class="activity-status status-${client.research_status || 'pending'}">${client.research_status || 'pending'}</div>
          </div>
        `).join('');
      } catch (error) {
        console.error('Error loading recent clients:', error);
      }
    }

    // Load all pages for pages section
    async function loadAllPages() {
      try {
        const res = await fetch('/api/pages');
        const pages = await res.json();

        const container = document.getElementById('allPagesContainer');
        if (!container) return;

        if (!Array.isArray(pages) || pages.length === 0) {
          container.innerHTML = `
            <div class="empty-state">
              <div class="empty-illustration"></div>
              <h3>No landing pages yet</h3>
              <p>Create your first page by generating one with AI or importing HTML.</p>
              <button class="btn btn-primary" onclick="openGenerateModal()">Generate with AI</button>
            </div>
          `;
          return;
        }

        // Render pages table
        container.innerHTML = `
          <table class="pages-table">
            <thead>
              <tr>
                <th>Name</th>
                <th>Status</th>
                <th>Client</th>
                <th>Created</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              ${pages.map(page => `
                <tr>
                  <td><strong>${page.name}</strong></td>
                  <td><span class="status-badge status-${page.status}">${page.status}</span></td>
                  <td>${page.client_name || '-'}</td>
                  <td>${new Date(page.created_at).toLocaleDateString()}</td>
                  <td>
                    <div class="table-actions">
                      <button class="btn btn-icon" onclick="previewPage('${page.id}')" title="Preview">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                          <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                          <circle cx="12" cy="12" r="3"/>
                        </svg>
                      </button>
                      <button class="btn btn-icon" onclick="editPage('${page.id}')" title="Edit">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                          <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                          <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                        </svg>
                      </button>
                    </div>
                  </td>
                </tr>
              `).join('')}
            </tbody>
          </table>
        `;

        // Update page count
        const pageCount = document.getElementById('pageCount');
        if (pageCount) pageCount.textContent = pages.length;
      } catch (error) {
        console.error('Error loading pages:', error);
      }
    }

    function showClientsPage() {
      showPage('clients');
    }

    // ============================================
    // CLIENT DETAIL
    // ============================================
    async function openClientDetail(clientId, updateUrl = true) {
      currentClientId = clientId;

      try {
        const res = await fetch(`/api/clients/${clientId}`);
        const result = await res.json();

        if (!result.success) {
          throw new Error(result.error);
        }

        currentClientData = result.client;
        currentBrandGuide = result.brand_guide;

        // Hide other sections, show client detail
        const dashboardSection = document.getElementById('dashboardSection');
        const pagesSection = document.getElementById('pagesSection');
        if (dashboardSection) dashboardSection.style.display = 'none';
        if (pagesSection) pagesSection.style.display = 'none';
        document.getElementById('clientsSection').style.display = 'none';
        document.getElementById('adGeneratorSection').style.display = 'none';
        document.getElementById('clientDetailSection').style.display = 'block';

        // Update header
        document.getElementById('clientDetailName').textContent = currentClientData.name;
        document.getElementById('clientDetailIndustry').textContent = currentClientData.industry || 'Unknown Industry';

        // Populate all tabs
        populateOverviewTab(currentClientData, result);
        populateBrandGuideTab(currentBrandGuide);
        populateResearchTab(currentClientData);
        populateFactsTab(result.verified_claims, currentClientData);
        populatePagesTab(result.landing_pages);

        // Switch to overview tab
        switchClientTab('overview');

        // Update URL
        if (updateUrl) {
          history.replaceState(null, '', `#clients/${clientId}`);
        }

      } catch (error) {
        alert('Error loading client: ' + error.message);
        // Fall back to clients list
        showPage('clients');
      }
    }

    function switchClientTab(tabName) {
      // Update tab buttons
      document.querySelectorAll('.client-tab').forEach(tab => {
        tab.classList.toggle('active', tab.dataset.tab === tabName);
      });

      // Update tab content
      document.querySelectorAll('.client-tab-content').forEach(content => {
        content.classList.remove('active');
      });
      document.getElementById(`clientTab${tabName.charAt(0).toUpperCase() + tabName.slice(1)}`).classList.add('active');
    }

    function populateOverviewTab(client, fullData) {
      // Client info
      const websiteLink = document.getElementById('clientWebsiteLink');
      if (client.website_url) {
        websiteLink.href = client.website_url;
        websiteLink.textContent = client.website_url.replace('https://', '').replace('http://', '');
      } else {
        websiteLink.href = '#';
        websiteLink.textContent = '';
      }

      document.getElementById('clientIndustryInfo').textContent = client.industry || '';

      const statusEl = document.getElementById('clientResearchStatus');
      const status = client.research_status || 'pending';
      statusEl.innerHTML = `<span class="dot"></span>${status === 'completed' ? 'Completed' : 'Pending'}`;
      statusEl.className = `research-badge ${status === 'completed' ? 'completed' : 'pending'}`;

      document.getElementById('clientLastResearched').textContent = client.last_researched_at
        ? new Date(client.last_researched_at).toLocaleDateString()
        : 'Never';

      // Stats
      document.getElementById('clientPagesCount').textContent = fullData.landing_pages?.length || 0;
      document.getElementById('clientFactsCount').textContent = fullData.verified_claims?.length || 0;

      const research = client.business_research || {};
      document.getElementById('clientTestimonialsCount').textContent = research.testimonials?.length || 0;

      // Value props
      const valuePropsEl = document.getElementById('clientValueProps');
      const valueProps = research.value_propositions || [];
      if (valueProps.length > 0) {
        valuePropsEl.innerHTML = valueProps.map(vp => `<span class="value-prop-tag">${escapeHtml(vp)}</span>`).join('');
      } else {
        valuePropsEl.innerHTML = '<p class="text-muted">No value propositions found. Run research to extract them.</p>';
      }
    }

    function populateBrandGuideTab(brandGuide) {
      if (!brandGuide) {
        // Set defaults
        document.getElementById('brandPrimaryColor').value = '#3974ff';
        document.getElementById('brandPrimaryColorHex').value = '#3974ff';
        document.getElementById('brandSecondaryColor').value = '#00ACE9';
        document.getElementById('brandSecondaryColorHex').value = '#00ACE9';
        document.getElementById('brandAccentColor').value = '#3D916B';
        document.getElementById('brandAccentColorHex').value = '#3D916B';
        document.getElementById('brandBackgroundColor').value = '#ffffff';
        document.getElementById('brandBackgroundColorHex').value = '#ffffff';
        document.getElementById('brandTextColor').value = '#1f2937';
        document.getElementById('brandTextColorHex').value = '#1f2937';
        document.getElementById('brandHeadingFont').value = '';
        document.getElementById('brandBodyFont').value = '';
        document.getElementById('brandBorderRadius').value = '8px';
        document.getElementById('brandSpacingUnit').value = '4px';
        document.getElementById('brandMaxWidth').value = '1200px';
        document.getElementById('brandVoiceTone').value = '';
        document.getElementById('brandVoiceKeywords').value = '';
        return;
      }

      // Colors
      setColorInput('brandPrimaryColor', brandGuide.primary_color || '#3974ff');
      setColorInput('brandSecondaryColor', brandGuide.secondary_color || '#00ACE9');
      setColorInput('brandAccentColor', brandGuide.accent_color || '#3D916B');
      setColorInput('brandBackgroundColor', brandGuide.background_color || '#ffffff');
      setColorInput('brandTextColor', brandGuide.text_color || '#1f2937');

      // Typography
      document.getElementById('brandHeadingFont').value = brandGuide.heading_font || '';
      document.getElementById('brandBodyFont').value = brandGuide.body_font || '';

      // Spacing
      document.getElementById('brandBorderRadius').value = brandGuide.border_radius || '8px';
      document.getElementById('brandSpacingUnit').value = brandGuide.spacing_unit || '4px';
      document.getElementById('brandMaxWidth').value = brandGuide.max_width || '1200px';

      // Brand voice
      document.getElementById('brandVoiceTone').value = brandGuide.brand_voice || '';
      const keywords = brandGuide.tone_keywords || [];
      document.getElementById('brandVoiceKeywords').value = Array.isArray(keywords) ? keywords.join(', ') : '';

      // Update previews
      updateBrandPreviews();
    }

    function setColorInput(baseName, value) {
      const colorInput = document.getElementById(baseName);
      const hexInput = document.getElementById(baseName + 'Hex');
      if (colorInput) colorInput.value = value;
      if (hexInput) hexInput.value = value;
    }

    function updateBrandPreviews() {
      const primaryColor = document.getElementById('brandPrimaryColor').value;
      const textColor = document.getElementById('brandTextColor').value;
      const headingFont = document.getElementById('brandHeadingFont').value || 'system-ui, -apple-system, sans-serif';
      const bodyFont = document.getElementById('brandBodyFont').value || 'system-ui, -apple-system, sans-serif';
      const borderRadius = document.getElementById('brandBorderRadius').value || '8px';

      // Font preview
      document.getElementById('fontPreviewHeading').style.fontFamily = headingFont;
      document.getElementById('fontPreviewBody').style.fontFamily = bodyFont;

      // Button previews
      const primaryBtn = document.getElementById('brandPrimaryBtnPreview');
      primaryBtn.style.background = primaryColor;
      primaryBtn.style.color = '#ffffff';
      primaryBtn.style.borderRadius = borderRadius;

      const secondaryBtn = document.getElementById('brandSecondaryBtnPreview');
      secondaryBtn.style.borderColor = primaryColor;
      secondaryBtn.style.color = primaryColor;
      secondaryBtn.style.borderRadius = borderRadius;
    }

    // Sync color inputs
    document.addEventListener('DOMContentLoaded', () => {
      const colorFields = ['brandPrimaryColor', 'brandSecondaryColor', 'brandAccentColor', 'brandBackgroundColor', 'brandTextColor'];

      colorFields.forEach(field => {
        const colorInput = document.getElementById(field);
        const hexInput = document.getElementById(field + 'Hex');

        if (colorInput && hexInput) {
          colorInput.addEventListener('input', () => {
            hexInput.value = colorInput.value;
            updateBrandPreviews();
          });

          hexInput.addEventListener('input', () => {
            if (/^#[0-9A-Fa-f]{6}$/.test(hexInput.value)) {
              colorInput.value = hexInput.value;
              updateBrandPreviews();
            }
          });
        }
      });

      // Font and spacing changes
      ['brandHeadingFont', 'brandBodyFont', 'brandBorderRadius'].forEach(field => {
        const input = document.getElementById(field);
        if (input) {
          input.addEventListener('input', updateBrandPreviews);
        }
      });

      // Set up nav click handlers
      document.querySelectorAll('.nav-item[data-page]').forEach(item => {
        item.addEventListener('click', () => {
          showPage(item.dataset.page);
        });
      });
    });

    async function saveBrandGuide() {
      if (!currentClientId) return;

      const brandData = {
        primary_color: document.getElementById('brandPrimaryColor').value,
        secondary_color: document.getElementById('brandSecondaryColor').value,
        accent_color: document.getElementById('brandAccentColor').value,
        background_color: document.getElementById('brandBackgroundColor').value,
        text_color: document.getElementById('brandTextColor').value,
        heading_font: document.getElementById('brandHeadingFont').value,
        body_font: document.getElementById('brandBodyFont').value,
        border_radius: document.getElementById('brandBorderRadius').value,
        spacing_unit: document.getElementById('brandSpacingUnit').value,
        max_width: document.getElementById('brandMaxWidth').value,
        brand_voice: document.getElementById('brandVoiceTone').value,
        tone_keywords: document.getElementById('brandVoiceKeywords').value.split(',').map(k => k.trim()).filter(k => k)
      };

      try {
        const res = await fetch(`/api/clients/${currentClientId}/brand`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(brandData)
        });

        const result = await res.json();
        if (result.success) {
          alert('Brand guide saved successfully!');
          currentBrandGuide = result.brand_guide;
        } else {
          throw new Error(result.error);
        }
      } catch (error) {
        alert('Error saving brand guide: ' + error.message);
      }
    }

    function populateResearchTab(client) {
      const research = client.business_research || {};

      document.getElementById('researchCompanyName').value = research.company_name || '';
      document.getElementById('researchIndustry').value = research.industry || '';
      document.getElementById('researchTagline').value = research.tagline || '';
      document.getElementById('researchValueProps').value = (research.value_propositions || []).join('\n');
      document.getElementById('researchBrandVoice').value = research.brand_voice || '';
      document.getElementById('researchDifferentiators').value = (research.unique_differentiators || []).join('\n');

      // Products
      const productsList = document.getElementById('researchProductsList');
      const products = research.products || [];
      if (products.length > 0) {
        productsList.innerHTML = products.map((p, i) => `
          <div class="product-card" data-index="${i}">
            <h4>${escapeHtml(p.name || 'Product ' + (i + 1))}</h4>
            <p>${escapeHtml(p.description || 'No description')}</p>
            ${p.price ? `<p><strong>Price:</strong> ${escapeHtml(p.price)}</p>` : ''}
            ${p.key_features?.length ? `<p><strong>Features:</strong> ${p.key_features.map(f => escapeHtml(f)).join(', ')}</p>` : ''}
          </div>
        `).join('');
      } else {
        productsList.innerHTML = '<p class="text-muted">No products found. Run research or add manually.</p>';
      }

      // Audiences
      const audiencesList = document.getElementById('researchAudiencesList');
      const audiences = research.target_audiences || [];
      if (audiences.length > 0) {
        audiencesList.innerHTML = audiences.map((a, i) => `
          <div class="audience-card" data-index="${i}">
            <h4>${escapeHtml(a.segment || 'Audience ' + (i + 1))}</h4>
            ${a.pain_points?.length ? `<p><strong>Pain Points:</strong> ${a.pain_points.map(p => escapeHtml(p)).join(', ')}</p>` : ''}
            ${a.desires?.length ? `<p><strong>Desires:</strong> ${a.desires.map(d => escapeHtml(d)).join(', ')}</p>` : ''}
          </div>
        `).join('');
      } else {
        audiencesList.innerHTML = '<p class="text-muted">No target audiences found.</p>';
      }
    }

    async function saveResearchData() {
      if (!currentClientId || !currentClientData) return;

      const research = {
        ...currentClientData.business_research,
        company_name: document.getElementById('researchCompanyName').value,
        industry: document.getElementById('researchIndustry').value,
        tagline: document.getElementById('researchTagline').value,
        value_propositions: document.getElementById('researchValueProps').value.split('\n').filter(v => v.trim()),
        brand_voice: document.getElementById('researchBrandVoice').value,
        unique_differentiators: document.getElementById('researchDifferentiators').value.split('\n').filter(v => v.trim())
      };

      try {
        const res = await fetch(`/api/clients/${currentClientId}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            industry: research.industry,
            business_research: research
          })
        });

        const result = await res.json();
        if (result.success) {
          alert('Research data saved successfully!');
          currentClientData = result.client;
        } else {
          throw new Error(result.error);
        }
      } catch (error) {
        alert('Error saving research data: ' + error.message);
      }
    }

    function populateFactsTab(claims, client) {
      const research = client.business_research || {};

      // Verified claims
      const factsList = document.getElementById('verifiedFactsList');
      if (claims && claims.length > 0) {
        factsList.innerHTML = claims.map(c => `
          <div class="fact-item">
            <span class="fact-type ${c.claim_type || 'feature'}">${c.claim_type || 'claim'}</span>
            <div class="fact-content">
              <div class="fact-text">${escapeHtml(c.claim_text)}</div>
              ${c.source_url ? `<div class="fact-source">Source: ${escapeHtml(c.source_url)}</div>` : ''}
            </div>
          </div>
        `).join('');
      } else {
        factsList.innerHTML = '<p class="text-muted">No verified facts yet. These are extracted during research.</p>';
      }

      // Testimonials
      const testimonialsList = document.getElementById('testimonialsList');
      const testimonials = research.testimonials || [];
      if (testimonials.length > 0) {
        testimonialsList.innerHTML = testimonials.map(t => `
          <div class="testimonial-card">
            <div class="testimonial-quote">"${escapeHtml(t.quote)}"</div>
            <div class="testimonial-author">${escapeHtml(t.author || 'Anonymous')}</div>
            ${t.role_or_context ? `<div class="testimonial-role">${escapeHtml(t.role_or_context)}</div>` : ''}
          </div>
        `).join('');
      } else {
        testimonialsList.innerHTML = '<p class="text-muted">No testimonials found.</p>';
      }

      // Statistics
      const statisticsList = document.getElementById('statisticsList');
      const statistics = research.statistics || [];
      if (statistics.length > 0) {
        statisticsList.innerHTML = statistics.map(s => `
          <div class="fact-item">
            <span class="fact-type statistic">stat</span>
            <div class="fact-content">
              <div class="fact-text"><strong>${escapeHtml(s.claim)}</strong> - ${escapeHtml(s.context || '')}</div>
              ${s.source_url ? `<div class="fact-source">Source: ${escapeHtml(s.source_url)}</div>` : ''}
            </div>
          </div>
        `).join('');
      } else {
        statisticsList.innerHTML = '<p class="text-muted">No statistics found.</p>';
      }
    }

    function populatePagesTab(pages) {
      const pagesList = document.getElementById('clientPagesList');

      if (pages && pages.length > 0) {
        pagesList.innerHTML = pages.map(p => `
          <div class="client-page-item">
            <span class="page-name">${escapeHtml(p.name)}</span>
            <span class="page-status ${p.status}">${p.status}</span>
            <span style="color: var(--text-light); font-size: 12px;">${new Date(p.created_at).toLocaleDateString()}</span>
            <button class="btn btn-secondary btn-small" onclick="openEditor('${p.id}')">Edit</button>
          </div>
        `).join('');
      } else {
        pagesList.innerHTML = '<p class="text-muted">No pages generated for this client yet.</p>';
      }
    }

    async function triggerClientResearch() {
      if (!currentClientId || !currentClientData?.website_url) {
        alert('Client needs a website URL to run research.');
        return;
      }

      if (!confirm('Run deep research on this client\'s website? This may take 30-60 seconds.')) return;

      try {
        const res = await fetch(`/api/clients/${currentClientId}/research`, {
          method: 'POST'
        });

        const result = await res.json();
        if (result.success) {
          alert('Research completed! Refreshing data...');
          openClientDetail(currentClientId);
        } else {
          throw new Error(result.error);
        }
      } catch (error) {
        alert('Research failed: ' + error.message);
      }
    }

    function generatePageForClient() {
      if (!currentClientId) return;
      // Open generate modal with client pre-selected
      // For now, just open the modal
      openGenerateModal();
      // TODO: Pre-fill client in generate modal
    }

    function addNewFact() {
      const text = prompt('Enter the fact or claim:');
      if (!text) return;

      const type = prompt('Type (statistic, testimonial, feature):') || 'feature';
      // TODO: Add API call to save new fact
      alert('Adding facts manually coming soon. Run research to extract facts automatically.');
    }

    function addProductField() {
      alert('Adding products manually coming soon. Run research to extract products automatically.');
    }

    // ============================================
    // CURSOR EFFECT
    // ============================================
    const cursorGlow = document.getElementById('cursorGlow');
    const orbs = document.querySelectorAll('.bg-gradient-orb');

    document.addEventListener('mousemove', (e) => {
      cursorGlow.style.left = e.clientX + 'px';
      cursorGlow.style.top = e.clientY + 'px';
      cursorGlow.classList.add('active');

      const centerX = window.innerWidth / 2;
      const centerY = window.innerHeight / 2;
      const deltaX = (e.clientX - centerX) / centerX;
      const deltaY = (e.clientY - centerY) / centerY;

      if (orbs[0]) orbs[0].style.transform = `translate(${deltaX * 20}px, ${deltaY * 20}px)`;
      if (orbs[1]) orbs[1].style.transform = `translate(${-deltaX * 15}px, ${-deltaY * 15}px)`;
    });

    document.addEventListener('mouseleave', () => {
      cursorGlow.classList.remove('active');
    });

    // ============================================
    // SIDEBAR
    // ============================================
    function toggleSidebar() {
      document.getElementById('sidebar').classList.toggle('open');
      document.getElementById('sidebarOverlay').classList.toggle('active');
    }

    function closeSidebar() {
      document.getElementById('sidebar').classList.remove('open');
      document.getElementById('sidebarOverlay').classList.remove('active');
    }

    // ============================================
    // DATA LOADING
    // ============================================
    async function loadPages() {
      try {
        const res = await fetch('/api/pages');
        pages = await res.json();
        renderPages();
        updateStats();
      } catch (error) {
        console.error('Failed to load pages:', error);
      }
    }

    function updateStats() {
      document.getElementById('statPages').textContent = pages.length;
      document.getElementById('statLive').textContent = pages.filter(p => p.status === 'live').length;

      // Fix: Ensure view_count is parsed as integer
      const totalViews = pages.reduce((sum, p) => sum + (parseInt(p.view_count) || 0), 0);
      document.getElementById('statViews').textContent = formatNumber(totalViews);

      const totalLeads = pages.reduce((sum, p) => sum + (parseInt(p.lead_count) || 0), 0);
      document.getElementById('statLeads').textContent = formatNumber(totalLeads);

      document.getElementById('pageCount').textContent = pages.length;
      document.getElementById('navPageCount').textContent = pages.length;
    }

    function formatNumber(num) {
      if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
      if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
      return num.toString();
    }

    function renderPages() {
      const container = document.getElementById('pagesContainer');

      if (pages.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-illustration"></div>
            <h3>No landing pages yet</h3>
            <p>Create your first page by generating one with AI or importing HTML.</p>
            <button class="btn btn-primary" onclick="openGenerateModal()">Generate with AI</button>
          </div>
        `;
        return;
      }

      container.innerHTML = `
        <div class="pages-table-wrapper">
          <table class="pages-table">
            <thead>
              <tr>
                <th>Name</th>
                <th class="hide-mobile">Client</th>
                <th>Status</th>
                <th>Views</th>
                <th>Leads</th>
                <th class="hide-mobile">Conv.</th>
                <th class="hide-mobile">URL</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              ${pages.map(page => {
                const views = parseInt(page.view_count) || 0;
                const leads = parseInt(page.lead_count) || 0;
                const convRate = views > 0 ? ((leads / views) * 100).toFixed(1) + '%' : '';
                const liveUrl = page.status === 'live' ? `${getBaseUrl()}/${page.slug}` : null;

                return `
                  <tr>
                    <td>
                      <div class="page-name">
                        <strong>${escapeHtml(page.name)}</strong>
                        <small>${page.slug}</small>
                      </div>
                    </td>
                    <td class="hide-mobile">${escapeHtml(page.client_name || '')}</td>
                    <td>
                      <span class="status-badge status-${page.status}">
                        <span class="dot"></span>
                        ${page.status === 'live' ? 'Live' : 'Draft'}
                      </span>
                    </td>
                    <td class="metric">${formatNumber(views)}</td>
                    <td class="metric">${formatNumber(leads)}</td>
                    <td class="hide-mobile metric">${convRate}</td>
                    <td class="hide-mobile">
                      ${liveUrl ? `<a href="${liveUrl}" target="_blank" class="page-link">${page.slug}</a>` : '<span class="metric-secondary"></span>'}
                    </td>
                    <td>
                      <div class="actions">
                        <button class="btn btn-icon btn-ghost" onclick="openEditor('${page.id}')" title="Visual Edit"></button>
                        <button class="btn btn-icon btn-ghost" onclick="openAnalytics('${page.id}')" title="Analytics"></button>
                        <button class="btn btn-icon btn-ghost" onclick="editPage('${page.id}')" title="Edit HTML"></button>
                        ${page.status === 'live' ? `<button class="btn btn-icon btn-ghost" onclick="openDomainModal('${page.id}', '${page.slug}', '${liveUrl}')" title="Configure Domain" style="color: var(--primary-blue)"></button>` : `<button class="btn btn-icon btn-ghost" onclick="quickDeploy('${page.id}')" title="Deploy" style="color: var(--success)"></button>`}
                        <button class="btn btn-icon btn-ghost" onclick="deletePage('${page.id}')" title="Delete" style="color: var(--error)"></button>
                      </div>
                    </td>
                  </tr>
                `;
              }).join('')}
            </tbody>
          </table>
        </div>
      `;
    }

    function getBaseUrl() {
      return 'https://unicornmarketers.com/p';
    }

    // ============================================
    // CREATE/EDIT MODAL
    // ============================================
    function openCreateModal() {
      document.getElementById('modalTitle').textContent = ' New Landing Page';
      document.getElementById('pageForm').reset();
      document.getElementById('pageId').value = '';
      document.getElementById('deployResult').innerHTML = '';
      document.getElementById('saveDraftBtn').style.display = 'inline-flex';
      document.getElementById('createModal').classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    function closeCreateModal() {
      document.getElementById('createModal').classList.remove('active');
      document.body.style.overflow = '';
    }

    // ============================================
    // DOMAIN MANAGEMENT
    // ============================================
    let currentDomainPageId = null;
    let currentDomainSlug = null;
    let currentDomainType = 'subdomain';

    function openDomainModal(pageId, slug, currentUrl) {
      currentDomainPageId = pageId;
      currentDomainSlug = slug;
      currentDomainType = 'subdomain';

      document.getElementById('domainPageId').value = pageId;
      document.getElementById('domainCurrentLink').href = currentUrl;
      document.getElementById('domainCurrentLink').textContent = currentUrl;

      // Update subdomain preview
      document.getElementById('subdomainPreview').textContent = `${slug}.pages.unicornmarketers.com`;

      // Reset selection
      selectDomainType('subdomain');

      // Load existing domains for this page
      loadPageDomains(pageId);

      document.getElementById('domainModal').classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    function closeDomainModal() {
      document.getElementById('domainModal').classList.remove('active');
      document.body.style.overflow = '';
      currentDomainPageId = null;
      currentDomainSlug = null;
    }

    function selectDomainType(type) {
      currentDomainType = type;

      // Update option styles
      document.getElementById('domainOptionSubdomain').classList.toggle('selected', type === 'subdomain');
      document.getElementById('domainOptionCustom').classList.toggle('selected', type === 'custom');

      // Show/hide custom domain input and DNS instructions
      document.getElementById('customDomainInput').style.display = type === 'custom' ? 'flex' : 'none';
      document.getElementById('dnsInstructions').style.display = type === 'custom' ? 'block' : 'none';

      // Update DNS record name based on input
      if (type === 'custom') {
        document.getElementById('customDomainValue').focus();
        updateDnsRecordName();
      }
    }

    function updateDnsRecordName() {
      const domain = document.getElementById('customDomainValue').value.trim();
      const parts = domain.split('.');
      if (parts.length >= 2) {
        // Extract subdomain part (e.g., "landing" from "landing.example.com")
        const subdomain = parts.length > 2 ? parts.slice(0, -2).join('.') : '@';
        document.getElementById('dnsRecordName').textContent = subdomain || '@';
      } else {
        document.getElementById('dnsRecordName').textContent = '@';
      }
    }

    // Add input listener for custom domain
    document.addEventListener('DOMContentLoaded', () => {
      const customDomainInput = document.getElementById('customDomainValue');
      if (customDomainInput) {
        customDomainInput.addEventListener('input', updateDnsRecordName);
      }
    });

    async function loadPageDomains(pageId) {
      try {
        const res = await fetch('/api/domains');
        const domains = await res.json();

        const pageDomains = domains.filter(d => d.page_id === pageId);
        const section = document.getElementById('existingDomainsSection');
        const list = document.getElementById('existingDomainsList');

        if (pageDomains.length > 0) {
          section.style.display = 'block';
          list.innerHTML = pageDomains.map(d => `
            <div class="domain-list-item">
              <div class="domain-list-item-info">
                <div class="domain-list-item-domain">${d.domain}</div>
                <div class="domain-list-item-page">${d.domain_type === 'subdomain' ? 'Unicorn Subdomain' : 'Custom Domain'}</div>
              </div>
              <div class="domain-list-item-actions">
                <span class="domain-list-item-status ${d.dns_configured ? 'active' : 'pending'}">
                  ${d.dns_configured ? 'Active' : 'Pending DNS'}
                </span>
                <button class="btn btn-icon btn-small" onclick="removeDomain('${d.domain}')" title="Remove">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 6h18"/>
                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"/>
                    <path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                  </svg>
                </button>
              </div>
            </div>
          `).join('');
        } else {
          section.style.display = 'none';
          list.innerHTML = '';
        }
      } catch (error) {
        console.error('Failed to load domains:', error);
      }
    }

    async function saveDomainConfig() {
      const btn = document.getElementById('saveDomainBtn');
      const originalText = btn.innerHTML;
      btn.innerHTML = '<span class="loading-spinner"></span> Connecting...';
      btn.disabled = true;

      try {
        let domain;
        let domainType;

        if (currentDomainType === 'subdomain') {
          domain = `${currentDomainSlug}.pages.unicornmarketers.com`;
          domainType = 'subdomain';
        } else {
          domain = document.getElementById('customDomainValue').value.trim();
          domainType = 'custom';

          if (!domain) {
            throw new Error('Please enter a domain');
          }

          // Basic domain validation
          if (!/^[a-zA-Z0-9][a-zA-Z0-9-_.]+\.[a-zA-Z]{2,}$/.test(domain)) {
            throw new Error('Please enter a valid domain (e.g., landing.yourdomain.com)');
          }
        }

        const res = await fetch(`/api/pages/${currentDomainPageId}/domain`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ domain, domain_type: domainType })
        });

        const result = await res.json();
        if (!res.ok) throw new Error(result.error);

        showToast(`Domain ${domain} connected successfully!`, 'success');

        // Reload domains list
        await loadPageDomains(currentDomainPageId);

        // For custom domains, keep modal open to show DNS instructions
        if (domainType === 'custom') {
          document.getElementById('dnsStatusText').textContent = 'Domain added! Configure DNS as shown above.';
        } else {
          // For subdomains, show success and close
          setTimeout(() => closeDomainModal(), 1500);
        }

      } catch (error) {
        showToast('Error: ' + error.message, 'error');
      } finally {
        btn.innerHTML = originalText;
        btn.disabled = false;
      }
    }

    async function removeDomain(domain) {
      if (!confirm(`Remove domain ${domain}?`)) return;

      try {
        const res = await fetch(`/api/domains/${encodeURIComponent(domain)}`, {
          method: 'DELETE'
        });

        if (!res.ok) {
          const result = await res.json();
          throw new Error(result.error);
        }

        showToast('Domain removed', 'success');
        await loadPageDomains(currentDomainPageId);
        // Also refresh all domains page if visible
        if (document.getElementById('domainsSection')?.style.display !== 'none') {
          await loadAllDomains();
        }
      } catch (error) {
        showToast('Error: ' + error.message, 'error');
      }
    }

    // Load all domains for the domains management page
    async function loadAllDomains() {
      try {
        const res = await fetch('/api/domains');
        const data = await res.json();
        const domains = data.domains || [];

        const container = document.getElementById('allDomainsContainer');
        const countEl = document.getElementById('domainCount');
        const customCountEl = document.getElementById('customDomainCount');

        if (!container) return;

        if (countEl) countEl.textContent = domains.length;
        if (customCountEl) customCountEl.textContent = domains.length;

        if (domains.length === 0) {
          container.innerHTML = `
            <div class="empty-state" style="padding: 3rem 2rem;">
              <div class="empty-illustration"></div>
              <h3>No custom domains configured</h3>
              <p>Your pages are live at unicornmarketers.com/p/slug. Add a custom domain for branded URLs.</p>
              <button class="btn btn-primary" onclick="openAddDomainFlow()">Add Custom Domain</button>
            </div>
          `;
          return;
        }

        container.innerHTML = `
          <div class="pages-table-wrapper">
            <table class="pages-table">
              <thead>
                <tr>
                  <th>Custom Domain</th>
                  <th>Landing Page</th>
                  <th>Default URL</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                ${domains.map(d => `
                  <tr>
                    <td>
                      <div class="page-name">
                        <strong style="font-family: 'SF Mono', Monaco, monospace; font-size: 0.85rem;">${escapeHtml(d.domain)}</strong>
                        <small><a href="https://${d.domain}" target="_blank" style="color: var(--primary-blue);">Visit </a></small>
                      </div>
                    </td>
                    <td>
                      <a href="#" onclick="editPage('${d.page_id}'); return false;" style="color: var(--text-dark); font-weight: 500;">
                        ${escapeHtml(d.page_name || 'Unknown')}
                      </a>
                    </td>
                    <td>
                      <code style="font-size: 0.75rem; background: var(--bg-light); padding: 0.25rem 0.5rem; border-radius: 4px;">
                        /p/${escapeHtml(d.page_slug || '')}
                      </code>
                    </td>
                    <td>
                      <span class="status-badge ${d.dns_configured ? 'status-live' : 'status-draft'}">
                        <span class="dot"></span>
                        ${d.dns_configured ? 'Active' : 'Pending DNS'}
                      </span>
                    </td>
                    <td>
                      <div class="actions">
                        <button class="btn btn-icon btn-ghost" onclick="copyDomain('${d.domain}')" title="Copy URL">
                          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
                          </svg>
                        </button>
                        <button class="btn btn-icon btn-ghost" onclick="removeDomainFromList('${d.domain}')" title="Remove" style="color: var(--error);">
                          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 6h18"/>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"/>
                            <path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                          </svg>
                        </button>
                      </div>
                    </td>
                  </tr>
                `).join('')}
              </tbody>
            </table>
          </div>
        `;
      } catch (error) {
        console.error('Failed to load domains:', error);
      }
    }

    function copyDomain(domain) {
      navigator.clipboard.writeText(`https://${domain}`);
      showToast('URL copied to clipboard', 'success');
    }

    async function removeDomainFromList(domain) {
      if (!confirm(`Remove domain ${domain}?`)) return;

      try {
        const res = await fetch(`/api/domains/${encodeURIComponent(domain)}`, {
          method: 'DELETE'
        });

        if (!res.ok) {
          const result = await res.json();
          throw new Error(result.error);
        }

        showToast('Domain removed', 'success');
        await loadAllDomains();
      } catch (error) {
        showToast('Error: ' + error.message, 'error');
      }
    }

    // ============================================
    // ADD DOMAIN FLOW (Domains Management Page)
    // ============================================
    let addDomainSelectedPage = null;

    async function openAddDomainFlow() {
      const form = document.getElementById('addDomainForm');
      const select = document.getElementById('domainPageSelect');
      const noPagesMsg = document.getElementById('noPagesMessage');
      const typeSelection = document.getElementById('domainTypeSelection');

      // Show the form
      form.style.display = 'block';

      // Reset state
      addDomainSelectedPage = null;
      typeSelection.style.display = 'none';
      select.innerHTML = '<option value="">-- Select a live page --</option>';
      document.getElementById('addCustomDomainInput').value = '';

      // Load live pages
      try {
        const livePages = pages.filter(p => p.status === 'live');

        if (livePages.length === 0) {
          noPagesMsg.style.display = 'block';
          select.style.display = 'none';
        } else {
          noPagesMsg.style.display = 'none';
          select.style.display = 'block';

          livePages.forEach(page => {
            const option = document.createElement('option');
            option.value = page.id;
            option.textContent = `${page.name} (${page.slug})`;
            option.dataset.slug = page.slug;
            select.appendChild(option);
          });
        }
      } catch (error) {
        console.error('Failed to load pages:', error);
        showToast('Failed to load pages', 'error');
      }
    }

    function closeAddDomainForm() {
      const form = document.getElementById('addDomainForm');
      form.style.display = 'none';
      addDomainSelectedPage = null;
    }

    function updateDomainPageSelection() {
      const select = document.getElementById('domainPageSelect');
      const typeSelection = document.getElementById('domainTypeSelection');
      const currentUrlPreview = document.getElementById('currentPageUrl');

      const selectedOption = select.options[select.selectedIndex];

      if (!select.value) {
        typeSelection.style.display = 'none';
        addDomainSelectedPage = null;
        return;
      }

      addDomainSelectedPage = {
        id: select.value,
        slug: selectedOption.dataset.slug
      };

      // Show domain input section
      typeSelection.style.display = 'block';

      // Update current URL preview
      currentUrlPreview.textContent = `unicornmarketers.com/p/${addDomainSelectedPage.slug}`;
    }

    async function submitAddDomain() {
      if (!addDomainSelectedPage) {
        showToast('Please select a landing page', 'error');
        return;
      }

      const btn = document.getElementById('submitDomainBtn');
      const originalText = btn.innerHTML;
      btn.innerHTML = '<span class="loading-spinner"></span> Connecting...';
      btn.disabled = true;

      try {
        const domain = document.getElementById('addCustomDomainInput').value.trim();
        if (!domain) {
          throw new Error('Please enter a domain');
        }
        // Basic domain validation
        if (!/^[a-zA-Z0-9][a-zA-Z0-9-_.]+\.[a-zA-Z]{2,}$/.test(domain)) {
          throw new Error('Please enter a valid domain (e.g., promo.yourbrand.com)');
        }

        const res = await fetch(`/api/pages/${addDomainSelectedPage.id}/domain`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            domain: domain,
            type: 'custom'
          })
        });

        const result = await res.json();

        if (!res.ok) {
          throw new Error(result.error || 'Failed to connect domain');
        }

        showToast(`Domain ${domain} connected successfully!`, 'success');
        closeAddDomainForm();
        await loadAllDomains();

      } catch (error) {
        showToast('Error: ' + error.message, 'error');
      } finally {
        btn.innerHTML = originalText;
        btn.disabled = false;
      }
    }

    async function editPage(id) {
      const page = pages.find(p => p.id === id);
      if (!page) return;

      document.getElementById('modalTitle').textContent = ' Edit Landing Page';
      document.getElementById('pageId').value = page.id;
      document.getElementById('pageName').value = page.name;
      document.getElementById('clientName').value = page.client_name || '';
      document.getElementById('pageSlug').value = page.slug;
      document.getElementById('htmlContent').value = page.html_content;
      document.getElementById('metaTitle').value = page.meta_title || '';
      document.getElementById('metaDescription').value = page.meta_description || '';
      document.getElementById('trackingPixel').value = page.tracking_pixel || '';
      document.getElementById('deployResult').innerHTML = '';
      document.getElementById('saveDraftBtn').style.display = page.status === 'live' ? 'none' : 'inline-flex';

      document.getElementById('createModal').classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    async function saveDraft() {
      const id = document.getElementById('pageId').value;
      const data = getFormData();

      try {
        const url = id ? `/api/pages/${id}` : '/api/pages';
        const method = id ? 'PUT' : 'POST';

        const res = await fetch(url, { method, headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(data) });
        if (!res.ok) throw new Error((await res.json()).error);

        await loadPages();
        closeCreateModal();
      } catch (error) {
        alert('Error: ' + error.message);
      }
    }

    async function deployPage() {
      const btn = document.getElementById('deployBtn');
      const originalText = btn.innerHTML;
      btn.innerHTML = '<span class="loading-spinner"></span> Deploying...';
      btn.disabled = true;

      try {
        const data = getFormData();
        const id = document.getElementById('pageId').value;

        let res;
        if (id) {
          await fetch(`/api/pages/${id}`, { method: 'PUT', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(data) });
          res = await fetch(`/api/pages/${id}/deploy`, { method: 'POST' });
        } else {
          res = await fetch('/api/deploy', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(data) });
        }

        const result = await res.json();
        if (!res.ok) throw new Error(result.error);

        document.getElementById('deployResult').innerHTML = `
          <div class="deploy-result">
            <h4> Successfully Deployed!</h4>
            <p>Live at: <a href="${result.liveUrl}" target="_blank">${result.liveUrl}</a></p>
            <div class="domain-section">
              <div class="domain-section-title">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"/>
                  <line x1="2" y1="12" x2="22" y2="12"/>
                  <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>
                </svg>
                Custom Domain
              </div>
              <p style="font-size: 0.8rem; color: var(--text-medium); margin-bottom: 0.75rem;">
                Want a branded URL? Connect your own domain or use a Unicorn subdomain.
              </p>
              <button class="btn btn-secondary btn-small" onclick="openDomainModal('${result.page.id}', '${result.page.slug}', '${result.liveUrl}')">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"/>
                  <line x1="2" y1="12" x2="22" y2="12"/>
                  <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>
                </svg>
                Configure Domain
              </button>
            </div>
          </div>
        `;

        document.getElementById('pageId').value = result.page.id;
        document.getElementById('saveDraftBtn').style.display = 'none';

        await loadPages();

        // Auto-close after 2 seconds
        setTimeout(() => {
          closeCreateModal();
        }, 2000);

      } catch (error) {
        alert('Deployment failed: ' + error.message);
      } finally {
        btn.innerHTML = originalText;
        btn.disabled = false;
      }
    }

    // ============================================
    // PIPELINE GENERATION (V2)
    // ============================================
    let currentJobId = null;

    async function generatePageV2() {
      if (!selectedGenerateType) {
        alert('Please select a page type');
        return;
      }

      const product = document.getElementById('generateProduct').value.trim();
      if (!product) {
        alert('Please enter a product URL or description');
        return;
      }

      // Show pipeline progress
      document.getElementById('generateStep1').style.display = 'none';
      document.getElementById('generateStep2').style.display = 'block';
      document.getElementById('generateBtn').style.display = 'none';
      document.getElementById('generateCancelBtn').textContent = 'Running...';
      document.getElementById('generateCancelBtn').disabled = true;

      // Reset all steps to pending
      document.querySelectorAll('.pipeline-step').forEach(step => {
        step.classList.remove('running', 'completed', 'failed');
        step.classList.add('pending');
      });

      const pipelineSteps = ['research', 'brand', 'strategy', 'copy', 'design', 'factcheck', 'assembly'];

      try {
        // Step 1: Start the job
        const startRes = await fetch('/api/generate/start', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            page_type: selectedGenerateType,
            target_audience: document.getElementById('generateAudience').value.trim() || null,
            offer_details: `Tone: ${document.getElementById('generateTone').value}`,
            website_url: product.startsWith('http') ? product : null
          })
        });

        const startResult = await startRes.json();
        if (!startRes.ok) throw new Error(startResult.error);

        currentJobId = startResult.job.id;
        let totalTokens = 0;
        let verifiedFacts = 0;

        // Step 2: Run each step in sequence
        for (const stepName of pipelineSteps) {
          // Update UI to show this step is running
          const stepEl = document.querySelector(`.pipeline-step[data-step="${stepName}"]`);
          stepEl.classList.remove('pending');
          stepEl.classList.add('running');

          // Run the step
          const stepRes = await fetch(`/api/generate/${currentJobId}/step/${stepName}`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              url: product.startsWith('http') ? product : null,
              productName: !product.startsWith('http') ? product : null
            })
          });

          const stepResult = await stepRes.json();

          if (!stepRes.ok) {
            stepEl.classList.remove('running');
            stepEl.classList.add('failed');
            throw new Error(`${stepName} failed: ${stepResult.error}`);
          }

          // Mark step as completed
          stepEl.classList.remove('running');
          stepEl.classList.add('completed');

          // Update stats
          totalTokens += stepResult.tokens_used || 0;
          if (stepName === 'factcheck' && stepResult.result?.verified_count) {
            verifiedFacts = stepResult.result.verified_count;
          }

          // Update summary
          document.getElementById('summaryTokens').textContent = totalTokens.toLocaleString();
          document.getElementById('summaryCost').textContent = '$' + ((totalTokens / 1000000) * 9).toFixed(3);
          document.getElementById('summaryFacts').textContent = verifiedFacts;
          document.getElementById('pipelineSummary').style.display = 'block';
        }

        // Generation complete - get the final page
        const statusRes = await fetch(`/api/generate/${currentJobId}/status`);
        const statusResult = await statusRes.json();

        if (statusResult.job.page_id) {
          // Fetch the generated page
          const pageRes = await fetch(`/api/pages/${statusResult.job.page_id}`);
          const pageResult = await pageRes.json();

          if (pageResult.success) {
            // Close generate modal and open create modal with generated content
            closeGenerateModal();

            document.getElementById('modalTitle').textContent = ' New Landing Page (AI Generated)';
            document.getElementById('pageForm').reset();
            document.getElementById('pageId').value = pageResult.page.id;
            document.getElementById('pageName').value = pageResult.page.name;
            document.getElementById('pageSlug').value = pageResult.page.slug;
            document.getElementById('htmlContent').value = pageResult.page.html_content;
            document.getElementById('deployResult').innerHTML = `
              <div style="padding: 1rem; background: rgba(0, 184, 148, 0.1); border-radius: 8px; margin-bottom: 1rem; border: 1px solid var(--success);">
                <strong style="color: var(--success);"> Page Generated Successfully!</strong><br>
                <small style="color: var(--text-medium);">Tokens used: ${totalTokens.toLocaleString()} | Estimated cost: $${((totalTokens / 1000000) * 9).toFixed(3)} | Facts verified: ${verifiedFacts}</small>
              </div>
            `;
            document.getElementById('saveDraftBtn').style.display = 'inline-flex';
            document.getElementById('createModal').classList.add('active');
            document.body.style.overflow = 'hidden';

            await loadPages();
          }
        }

      } catch (error) {
        alert('Generation failed: ' + error.message);
        resetGenerateModal();
      }
    }

    function resetGenerateModal() {
      document.getElementById('generateStep1').style.display = 'block';
      document.getElementById('generateStep2').style.display = 'none';
      document.getElementById('generateBtn').style.display = 'inline-flex';
      document.getElementById('generateBtn').innerHTML = ' Generate Page';
      document.getElementById('generateCancelBtn').textContent = 'Cancel';
      document.getElementById('generateCancelBtn').disabled = false;
      document.getElementById('pipelineSummary').style.display = 'none';
      currentJobId = null;
    }

    // Keep the old function for backwards compatibility
    async function generatePage() {
      return generatePageV2();
    }

    async function quickDeploy(id) {
      if (!confirm('Deploy this page live?')) return;

      try {
        const res = await fetch(`/api/pages/${id}/deploy`, { method: 'POST' });
        const result = await res.json();
        if (!res.ok) throw new Error(result.error);

        alert('Deployed! Live at: ' + result.liveUrl);
        await loadPages();
      } catch (error) {
        alert('Deployment failed: ' + error.message);
      }
    }

    async function deletePage(id) {
      if (!confirm('Delete this page? This cannot be undone.')) return;

      try {
        const res = await fetch(`/api/pages/${id}`, { method: 'DELETE' });
        if (!res.ok) throw new Error((await res.json()).error);
        await loadPages();
      } catch (error) {
        alert('Error: ' + error.message);
      }
    }

    function getFormData() {
      return {
        name: document.getElementById('pageName').value,
        client_name: document.getElementById('clientName').value || null,
        slug: document.getElementById('pageSlug').value || null,
        html_content: document.getElementById('htmlContent').value,
        meta_title: document.getElementById('metaTitle').value || null,
        meta_description: document.getElementById('metaDescription').value || null,
        tracking_pixel: document.getElementById('trackingPixel').value || null
      };
    }

    // ============================================
    // ANALYTICS MODAL
    // ============================================
    async function openAnalytics(id) {
      currentPageId = id;
      const page = pages.find(p => p.id === id);
      document.getElementById('analyticsTitle').textContent = ` Analytics: ${page?.name || 'Page'}`;
      document.getElementById('analyticsModal').classList.add('active');
      document.body.style.overflow = 'hidden';

      document.querySelectorAll('#analyticsModal .tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('#analyticsModal .tab-content').forEach(c => c.classList.remove('active'));
      document.querySelector('#analyticsModal .tab').classList.add('active');
      document.getElementById('tabOverview').classList.add('active');

      await loadAnalytics(id);
      await loadLeads(id);
      await loadABResults(id);
    }

    function closeAnalyticsModal() {
      document.getElementById('analyticsModal').classList.remove('active');
      document.body.style.overflow = '';
      currentPageId = null;
    }

    function switchTab(event, tab) {
      const modal = event.target.closest('.modal');
      modal.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      modal.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
      event.target.classList.add('active');
      document.getElementById(`tab${tab.charAt(0).toUpperCase() + tab.slice(1)}`).classList.add('active');
    }

    async function loadAnalytics(id) {
      try {
        const res = await fetch(`/api/pages/${id}/analytics`);
        const data = await res.json();

        document.getElementById('aViews').textContent = formatNumber(data.summary.total_views);
        document.getElementById('aLeads').textContent = formatNumber(data.summary.total_leads);
        document.getElementById('aConversion').textContent = data.summary.conversion_rate + '%';

        const sources = data.views_by_source || [];
        document.getElementById('trafficSources').innerHTML = sources.length > 0
          ? `<table class="leads-table"><thead><tr><th>Source</th><th>Views</th></tr></thead><tbody>${sources.map(s => `<tr><td>${escapeHtml(s.source)}</td><td class="metric">${formatNumber(s.views)}</td></tr>`).join('')}</tbody></table>`
          : '<p style="color: var(--text-light); text-align: center; padding: 2rem;">No traffic data yet</p>';
      } catch (error) {
        console.error('Failed to load analytics:', error);
      }
    }

    async function loadLeads(id) {
      try {
        const res = await fetch(`/api/pages/${id}/leads`);
        const leads = await res.json();

        document.getElementById('leadsTable').innerHTML = leads.length > 0
          ? `<table class="leads-table"><thead><tr><th>Date</th><th>Email</th><th>Name</th><th>Phone</th><th>Source</th></tr></thead><tbody>${leads.map(l => `<tr><td>${new Date(l.created_at).toLocaleDateString()}</td><td>${escapeHtml(l.email || '')}</td><td>${escapeHtml(l.name || '')}</td><td>${escapeHtml(l.phone || '')}</td><td>${escapeHtml(l.utm_source || 'direct')}</td></tr>`).join('')}</tbody></table>`
          : '<p style="color: var(--text-light); text-align: center; padding: 2rem;">No leads yet</p>';
      } catch (error) {
        console.error('Failed to load leads:', error);
      }
    }

    async function loadABResults(id) {
      try {
        const res = await fetch(`/api/pages/${id}/ab-results`);
        const data = await res.json();
        const allVariants = [data.control, ...(data.variants || [])];

        document.getElementById('abtestResults').innerHTML = `<table class="leads-table"><thead><tr><th>Variant</th><th>Views</th><th>Conversions</th><th>Rate</th></tr></thead><tbody>${allVariants.map(v => `<tr><td>${escapeHtml(v.name || v.variant_name)}</td><td class="metric">${formatNumber(v.views)}</td><td class="metric">${formatNumber(v.conversions)}</td><td class="metric">${v.conversion_rate}%</td></tr>`).join('')}</tbody></table>`;
      } catch (error) {
        console.error('Failed to load A/B results:', error);
      }
    }

    function exportLeads() {
      if (currentPageId) window.open(`/api/pages/${currentPageId}/leads/export`, '_blank');
    }

    // ============================================
    // GENERATE PAGE MODAL
    // ============================================
    function openGenerateModal() {
      selectedGenerateType = null;
      document.querySelectorAll('.generate-option').forEach(el => el.classList.remove('selected'));
      document.getElementById('generateProduct').value = '';
      document.getElementById('generateAudience').value = '';
      document.getElementById('generateTone').value = 'professional';
      document.getElementById('generateModal').classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    function closeGenerateModal() {
      document.getElementById('generateModal').classList.remove('active');
      document.body.style.overflow = '';
      resetGenerateModal();
    }

    function selectGenerateType(type) {
      selectedGenerateType = type;
      document.querySelectorAll('.generate-option').forEach(el => {
        el.classList.toggle('selected', el.dataset.type === type);
      });
    }

    // ============================================
    // VISUAL EDITOR MODAL
    // ============================================
    let currentDeviceMode = 'desktop';

    function openEditor(id) {
      const page = pages.find(p => p.id === id);
      if (!page) return;

      currentEditingPage = { ...page }; // Clone to track changes
      document.getElementById('editorTitle').textContent = ` Edit: ${page.name}`;
      document.getElementById('previewUrl').textContent = page.slug ? `/${page.slug}` : 'Preview';

      // Load page into iframe with contenteditable enabled
      const iframe = document.getElementById('editorPreview');
      const editableHtml = enableContentEditable(page.html_content);
      iframe.srcdoc = editableHtml;

      // Wait for iframe to load, then set up editing
      iframe.onload = () => {
        setupIframeEditing(iframe);
      };

      // Clear chat
      document.getElementById('chatMessages').innerHTML = `
        <div class="chat-message assistant">
          Click on any text in the preview to edit it directly. Use the toolbar or ask me to make changes!
        </div>
      `;

      document.getElementById('chatInput').value = '';
      document.getElementById('editorModal').classList.add('active');
      document.body.style.overflow = 'hidden';

      // Reset device preview
      setDevicePreview('desktop');
    }

    function enableContentEditable(html) {
      // Add script to enable contenteditable on text elements
      const editScript = `
        <script>
          document.addEventListener('DOMContentLoaded', function() {
            // Make text elements editable
            const editables = document.querySelectorAll('h1, h2, h3, h4, h5, h6, p, span, a, li, td, th, label, button');
            editables.forEach(el => {
              el.contentEditable = 'true';
              el.style.outline = 'none';
              el.addEventListener('focus', function() {
                this.style.outline = '2px solid #3B9FD8';
                this.style.outlineOffset = '2px';
              });
              el.addEventListener('blur', function() {
                this.style.outline = 'none';
                // Notify parent of changes
                window.parent.postMessage({ type: 'contentChanged' }, '*');
              });
            });

            // Track selection for toolbar
            document.addEventListener('selectionchange', function() {
              const selection = window.getSelection();
              if (selection.rangeCount > 0) {
                window.parent.postMessage({ type: 'selectionChanged' }, '*');
              }
            });
          });
        <\/script>
        <style>
          [contenteditable]:hover { outline: 1px dashed #3B9FD8 !important; cursor: text; }
          [contenteditable]:focus { outline: 2px solid #3B9FD8 !important; outline-offset: 2px; }
        </style>
      `;

      // Insert before closing </head> or </body>
      if (html.includes('</head>')) {
        return html.replace('</head>', editScript + '</head>');
      } else if (html.includes('</body>')) {
        return html.replace('</body>', editScript + '</body>');
      } else {
        return html + editScript;
      }
    }

    function setupIframeEditing(iframe) {
      // Listen for messages from iframe
      window.addEventListener('message', (event) => {
        if (event.data.type === 'contentChanged') {
          updateCurrentPageHtml();
        }
      });
    }

    function updateCurrentPageHtml() {
      if (!currentEditingPage) return;
      const iframe = document.getElementById('editorPreview');
      try {
        const doc = iframe.contentDocument || iframe.contentWindow.document;
        // Get the HTML and remove our editing scripts/styles
        let html = doc.documentElement.outerHTML;
        html = html.replace(/<script>[\s\S]*?document\.addEventListener\('DOMContentLoaded'[\s\S]*?<\/script>/gi, '');
        html = html.replace(/<style>\s*\[contenteditable\][\s\S]*?<\/style>/gi, '');
        // Remove contenteditable attributes
        html = html.replace(/\s*contenteditable="true"/gi, '');
        currentEditingPage.html_content = '<!DOCTYPE html>\n' + html;
      } catch (e) {
        console.error('Could not access iframe content:', e);
      }
    }

    function closeEditorModal() {
      document.getElementById('editorModal').classList.remove('active');
      document.body.style.overflow = '';
      currentEditingPage = null;
    }

    // Device Preview Toggle
    function setDevicePreview(device) {
      currentDeviceMode = device;
      const container = document.getElementById('iframeContainer');
      const iframe = document.getElementById('editorPreview');

      // Update button states
      document.querySelectorAll('.device-btn').forEach(btn => btn.classList.remove('active'));
      event.target.closest('.device-btn').classList.add('active');

      // Reset styles
      container.style.display = 'flex';
      container.style.justifyContent = 'center';
      container.style.background = device !== 'desktop' ? '#f0f0f0' : 'transparent';
      iframe.style.transition = 'width 0.3s ease';

      switch(device) {
        case 'mobile':
          iframe.style.width = '375px';
          iframe.style.maxWidth = '100%';
          iframe.style.boxShadow = '0 0 20px rgba(0,0,0,0.1)';
          break;
        case 'tablet':
          iframe.style.width = '768px';
          iframe.style.maxWidth = '100%';
          iframe.style.boxShadow = '0 0 20px rgba(0,0,0,0.1)';
          break;
        default:
          iframe.style.width = '100%';
          iframe.style.boxShadow = 'none';
      }
    }

    // Toolbar Panel Toggle
    function togglePanel(header) {
      header.classList.toggle('collapsed');
      const content = header.nextElementSibling;
      content.classList.toggle('collapsed');
    }

    // Editor Commands
    function editorCommand(command) {
      const iframe = document.getElementById('editorPreview');
      try {
        iframe.contentDocument.execCommand(command, false, null);
        updateCurrentPageHtml();
      } catch (e) {
        console.error('Editor command failed:', e);
      }
    }

    function editorHeading(tag) {
      if (!tag) return;
      const iframe = document.getElementById('editorPreview');
      try {
        iframe.contentDocument.execCommand('formatBlock', false, tag);
        updateCurrentPageHtml();
      } catch (e) {
        console.error('Heading command failed:', e);
      }
      document.getElementById('headingSelect').value = '';
    }

    function editorFont(font) {
      if (!font) return;
      const iframe = document.getElementById('editorPreview');
      try {
        const selection = iframe.contentWindow.getSelection();
        if (selection.rangeCount > 0) {
          const range = selection.getRangeAt(0);
          const span = iframe.contentDocument.createElement('span');
          span.style.fontFamily = font;
          range.surroundContents(span);
          updateCurrentPageHtml();
        }
      } catch (e) {
        console.error('Font command failed:', e);
      }
      document.getElementById('fontSelect').value = '';
    }

    function editorFontSize(size) {
      if (!size) return;
      const iframe = document.getElementById('editorPreview');
      try {
        const selection = iframe.contentWindow.getSelection();
        if (selection.rangeCount > 0) {
          const range = selection.getRangeAt(0);
          const span = iframe.contentDocument.createElement('span');
          span.style.fontSize = size;
          range.surroundContents(span);
          updateCurrentPageHtml();
        }
      } catch (e) {
        console.error('Font size command failed:', e);
      }
      document.getElementById('fontSizeSelect').value = '';
    }

    function editorTextColor(color) {
      const iframe = document.getElementById('editorPreview');
      try {
        iframe.contentDocument.execCommand('foreColor', false, color);
        updateCurrentPageHtml();
      } catch (e) {
        console.error('Text color command failed:', e);
      }
    }

    function editorBgColor(color) {
      const iframe = document.getElementById('editorPreview');
      try {
        iframe.contentDocument.execCommand('hiliteColor', false, color);
        updateCurrentPageHtml();
      } catch (e) {
        console.error('Background color command failed:', e);
      }
    }

    // Link Editor
    function openLinkEditor() {
      const iframe = document.getElementById('editorPreview');
      const selection = iframe.contentWindow.getSelection();
      if (selection.rangeCount > 0) {
        document.getElementById('linkText').value = selection.toString() || '';
      }
      document.getElementById('linkUrl').value = '';
      document.getElementById('linkNewTab').checked = true;
      document.getElementById('linkEditorBackdrop').classList.add('active');
      document.getElementById('linkEditorPopup').classList.add('active');
    }

    function closeLinkEditor() {
      document.getElementById('linkEditorBackdrop').classList.remove('active');
      document.getElementById('linkEditorPopup').classList.remove('active');
    }

    function insertLink() {
      const text = document.getElementById('linkText').value;
      const url = document.getElementById('linkUrl').value;
      const newTab = document.getElementById('linkNewTab').checked;

      if (!url) {
        alert('Please enter a URL');
        return;
      }

      const iframe = document.getElementById('editorPreview');
      try {
        const selection = iframe.contentWindow.getSelection();
        if (selection.rangeCount > 0) {
          const range = selection.getRangeAt(0);
          range.deleteContents();

          const link = iframe.contentDocument.createElement('a');
          link.href = url;
          link.textContent = text || url;
          if (newTab) {
            link.target = '_blank';
            link.rel = 'noopener noreferrer';
          }
          link.contentEditable = 'true';
          range.insertNode(link);
          updateCurrentPageHtml();
        }
      } catch (e) {
        console.error('Insert link failed:', e);
      }

      closeLinkEditor();
    }

    // Image Upload
    function openImageUpload() {
      document.getElementById('imageUploadInput').click();
    }

    function handleImageUpload(event) {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = (e) => {
        insertImageToEditor(e.target.result);
      };
      reader.readAsDataURL(file);
    }

    function insertImageFromUrl() {
      const url = document.getElementById('imageUrlInput').value.trim();
      if (!url) {
        alert('Please enter an image URL');
        return;
      }
      insertImageToEditor(url);
      document.getElementById('imageUrlInput').value = '';
    }

    function insertImageToEditor(src) {
      const iframe = document.getElementById('editorPreview');
      try {
        const selection = iframe.contentWindow.getSelection();
        if (selection.rangeCount > 0) {
          const range = selection.getRangeAt(0);
          const img = iframe.contentDocument.createElement('img');
          img.src = src;
          img.style.maxWidth = '100%';
          img.style.height = 'auto';
          range.insertNode(img);
          updateCurrentPageHtml();
        } else {
          // Insert at end of body if no selection
          const body = iframe.contentDocument.body;
          const img = iframe.contentDocument.createElement('img');
          img.src = src;
          img.style.maxWidth = '100%';
          img.style.height = 'auto';
          body.appendChild(img);
          updateCurrentPageHtml();
        }
      } catch (e) {
        console.error('Insert image failed:', e);
      }
    }

    // Quick Insert Elements
    function insertElement(type) {
      const iframe = document.getElementById('editorPreview');
      let html = '';

      switch(type) {
        case 'button':
          html = '<a href="#" style="display: inline-block; padding: 12px 24px; background: #3B9FD8; color: white; text-decoration: none; border-radius: 6px; font-weight: 600;">Click Here</a>';
          break;
        case 'heading':
          html = '<h2 style="font-size: 2rem; font-weight: 700; margin: 1rem 0;">New Heading</h2>';
          break;
        case 'paragraph':
          html = '<p style="font-size: 1rem; line-height: 1.6; margin: 1rem 0;">Add your paragraph text here. Click to edit.</p>';
          break;
        case 'divider':
          html = '<hr style="border: none; height: 1px; background: #e0e0e0; margin: 2rem 0;">';
          break;
        case 'testimonial':
          html = `<blockquote style="padding: 1.5rem; background: #f9f9f9; border-left: 4px solid #3B9FD8; margin: 1.5rem 0; border-radius: 0 8px 8px 0;">
            <p style="font-style: italic; margin-bottom: 0.5rem;">"This product changed my life! Highly recommended."</p>
            <footer style="font-weight: 600; color: #666;"> Happy Customer</footer>
          </blockquote>`;
          break;
        case 'cta':
          html = `<div style="text-align: center; padding: 3rem 2rem; background: linear-gradient(135deg, #3B9FD8 0%, #2d7fb0 100%); border-radius: 12px; margin: 2rem 0;">
            <h3 style="color: white; font-size: 1.75rem; margin-bottom: 0.5rem;">Ready to Get Started?</h3>
            <p style="color: rgba(255,255,255,0.9); margin-bottom: 1.5rem;">Join thousands of satisfied customers today.</p>
            <a href="#" style="display: inline-block; padding: 14px 32px; background: white; color: #3B9FD8; text-decoration: none; border-radius: 8px; font-weight: 700;">Get Started Now</a>
          </div>`;
          break;
      }

      try {
        const body = iframe.contentDocument.body;
        const div = iframe.contentDocument.createElement('div');
        div.innerHTML = html;
        body.appendChild(div.firstElementChild || div);
        updateCurrentPageHtml();
      } catch (e) {
        console.error('Insert element failed:', e);
      }
    }

    // Save Draft Only
    async function saveWithoutDeploy() {
      if (!currentEditingPage) return;

      updateCurrentPageHtml();
      const btn = document.getElementById('saveOnlyBtn');
      btn.innerHTML = '<span class="loading-spinner"></span> Saving...';
      btn.disabled = true;

      try {
        await fetch(`/api/pages/${currentEditingPage.id}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            name: currentEditingPage.name,
            html_content: currentEditingPage.html_content,
            client_name: currentEditingPage.client_name,
            slug: currentEditingPage.slug,
            meta_title: currentEditingPage.meta_title,
            meta_description: currentEditingPage.meta_description,
            tracking_pixel: currentEditingPage.tracking_pixel
          })
        });

        await loadPages();
        alert('Draft saved successfully!');
      } catch (error) {
        alert('Save failed: ' + error.message);
      } finally {
        btn.innerHTML = ' Save Draft';
        btn.disabled = false;
      }
    }

    async function sendChatMessage() {
      const input = document.getElementById('chatInput');
      const message = input.value.trim();
      if (!message || !currentEditingPage) return;

      const chatMessages = document.getElementById('chatMessages');
      const sendBtn = document.getElementById('chatSendBtn');

      // Add user message
      chatMessages.innerHTML += `<div class="chat-message user">${escapeHtml(message)}</div>`;
      input.value = '';

      // Add loading message
      chatMessages.innerHTML += `<div class="chat-message assistant" id="chatLoading"><span class="loading-spinner" style="border-color: rgba(59,159,216,0.3); border-top-color: var(--primary-blue);"></span> Making changes...</div>`;
      chatMessages.scrollTop = chatMessages.scrollHeight;

      // Disable input
      sendBtn.disabled = true;
      input.disabled = true;

      try {
        // Get current HTML from iframe
        const iframe = document.getElementById('editorPreview');
        const currentHtml = iframe.srcdoc;

        const res = await fetch('/api/chat', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            message: message,
            currentHtml: currentHtml,
            pageContext: {
              name: currentEditingPage.name,
              client_name: currentEditingPage.client_name
            }
          })
        });

        const result = await res.json();

        // Remove loading message
        document.getElementById('chatLoading')?.remove();

        if (!res.ok) throw new Error(result.error);

        // Update iframe with new HTML
        iframe.srcdoc = result.html;

        // Update the stored page HTML
        currentEditingPage.html_content = result.html;

        // Add success message
        chatMessages.innerHTML += `
          <div class="chat-message assistant">
            ${escapeHtml(result.message)}
          </div>
        `;

      } catch (error) {
        // Remove loading message
        document.getElementById('chatLoading')?.remove();

        chatMessages.innerHTML += `
          <div class="chat-message assistant" style="border-color: var(--error); background: rgba(225,112,85,0.05);">
            Sorry, I encountered an error: ${escapeHtml(error.message)}
          </div>
        `;
      } finally {
        sendBtn.disabled = false;
        input.disabled = false;
        input.focus();
        chatMessages.scrollTop = chatMessages.scrollHeight;
      }
    }

    // Handle Enter key in chat
    document.addEventListener('DOMContentLoaded', () => {
      const chatInput = document.getElementById('chatInput');
      if (chatInput) {
        chatInput.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            sendChatMessage();
          }
        });
      }
    });

    async function saveAndDeploy() {
      if (!currentEditingPage) return;

      // Get latest changes from iframe
      updateCurrentPageHtml();

      const btn = document.getElementById('saveDeployBtn');
      btn.innerHTML = '<span class="loading-spinner"></span> Saving & Deploying...';
      btn.disabled = true;

      try {
        // First save the updated HTML
        await fetch(`/api/pages/${currentEditingPage.id}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            name: currentEditingPage.name,
            html_content: currentEditingPage.html_content,
            client_name: currentEditingPage.client_name,
            slug: currentEditingPage.slug,
            meta_title: currentEditingPage.meta_title,
            meta_description: currentEditingPage.meta_description,
            tracking_pixel: currentEditingPage.tracking_pixel
          })
        });

        // Then deploy
        const res = await fetch(`/api/pages/${currentEditingPage.id}/deploy`, { method: 'POST' });
        const result = await res.json();
        if (!res.ok) throw new Error(result.error);

        await loadPages();

        alert('Page saved and deployed! Live at: ' + result.liveUrl);
        closeEditorModal();
      } catch (error) {
        alert('Deployment failed: ' + error.message);
      } finally {
        btn.innerHTML = ' Save & Deploy';
        btn.disabled = false;
      }
    }

    // ============================================
    // UTILITIES
    // ============================================
    function escapeHtml(text) {
      if (!text) return '';
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // Close modals on escape
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        closeLinkEditor();
        closeCreateModal();
        closeAnalyticsModal();
        closeGenerateModal();
        closeEditorModal();
      }
    });

    // Close modals on overlay click
    document.querySelectorAll('.modal-overlay').forEach(overlay => {
      overlay.addEventListener('click', (e) => {
        if (e.target === overlay) {
          closeCreateModal();
          closeAnalyticsModal();
          closeGenerateModal();
          closeEditorModal();
        }
      });
    });

    // ============================================
    // AD GENERATOR
    // ============================================
    let adGenClientId = null;
    let adGenClientData = null;
    let adGenMode = null;
    let adGenOptions = null;
    let selectedBiases = [];
    let selectedStyles = [];
    let selectedPowerStack = null;

    async function initAdGenerator() {
      // Load clients into dropdown
      try {
        const res = await fetch('/api/clients');
        const result = await res.json();

        const select = document.getElementById('adClientSelect');
        select.innerHTML = '<option value="">-- Select a client --</option>';

        if (result.success && result.clients) {
          result.clients.forEach(client => {
            const option = document.createElement('option');
            option.value = client.id;
            option.textContent = client.name;
            select.appendChild(option);
          });
        }

        // Load bias and style options
        await loadAdGenOptions();
      } catch (error) {
        console.error('Error initializing ad generator:', error);
      }
    }

    async function loadAdGenOptions() {
      try {
        const res = await fetch('/api/ads/generate-image-prompt');
        const result = await res.json();

        if (result.success) {
          adGenOptions = result;
          populateBiasGrid(result.cognitive_biases);
          populateStyleGrid(result.ad_styles);
        }
      } catch (error) {
        console.error('Error loading ad gen options:', error);
      }
    }

    function populateBiasGrid(biases) {
      const grid = document.getElementById('biasGrid');
      if (!grid) return;

      grid.innerHTML = biases.map(bias => `
        <div class="bias-item" data-key="${bias.key}" onclick="toggleBias('${bias.key}')">
          <span>${bias.id}. ${bias.name}</span>
        </div>
      `).join('');
    }

    function populateStyleGrid(styles) {
      const grid = document.getElementById('styleGrid');
      if (!grid) return;

      grid.innerHTML = styles.map(style => `
        <div class="style-item" data-key="${style.key}" onclick="toggleStyle('${style.key}')">
          <span>${style.id}. ${style.name}</span>
        </div>
      `).join('');
    }

    function toggleBias(key) {
      selectedPowerStack = null;
      document.querySelectorAll('.power-stack-btn').forEach(btn => btn.classList.remove('selected'));

      const item = document.querySelector(`.bias-item[data-key="${key}"]`);
      if (item.classList.contains('selected')) {
        item.classList.remove('selected');
        selectedBiases = selectedBiases.filter(b => b !== key);
      } else if (selectedBiases.length < 5) {
        item.classList.add('selected');
        selectedBiases.push(key);
      }
    }

    function toggleStyle(key) {
      const item = document.querySelector(`.style-item[data-key="${key}"]`);
      if (item.classList.contains('selected')) {
        item.classList.remove('selected');
        selectedStyles = selectedStyles.filter(s => s !== key);
      } else if (selectedStyles.length < 5) {
        item.classList.add('selected');
        selectedStyles.push(key);
      }
    }

    function selectPowerStack(stack) {
      selectedBiases = [];
      document.querySelectorAll('.bias-item').forEach(item => item.classList.remove('selected'));

      document.querySelectorAll('.power-stack-btn').forEach(btn => {
        btn.classList.toggle('selected', btn.textContent.toLowerCase() === stack);
      });

      selectedPowerStack = stack;
    }

    async function loadClientForAdGen() {
      const clientId = document.getElementById('adClientSelect').value;
      if (!clientId) {
        document.getElementById('adClientInfo').style.display = 'none';
        document.getElementById('adGenStep2').style.display = 'none';
        return;
      }

      try {
        const res = await fetch(`/api/clients/${clientId}`);
        const result = await res.json();

        if (result.success) {
          adGenClientId = clientId;
          adGenClientData = result.client;

          const research = result.client.business_research || {};

          document.getElementById('adClientName').textContent = result.client.name;
          document.getElementById('adClientIndustry').textContent = result.client.industry || 'Unknown';
          document.getElementById('adClientProducts').textContent = research.products?.length || 0;
          document.getElementById('adClientClaims').textContent = result.verified_claims?.length || 0;
          document.getElementById('adClientBrand').textContent = result.brand_guide ? 'Complete' : 'Not Set';

          document.getElementById('adClientInfo').style.display = 'block';
          document.getElementById('adGenStep2').style.display = 'block';
        }
      } catch (error) {
        console.error('Error loading client:', error);
      }
    }

    function selectAdGenMode(mode) {
      adGenMode = mode;

      document.querySelectorAll('.ad-gen-mode-card').forEach(card => {
        card.classList.toggle('selected', card.dataset.mode === mode);
      });

      // Show appropriate options
      document.getElementById('adGenCopyOptions').style.display = (mode === 'copy' || mode === 'full') ? 'block' : 'none';
      document.getElementById('adGenImageOptions').style.display = (mode === 'image' || mode === 'full') ? 'block' : 'none';
      document.getElementById('adGenActions').style.display = 'flex';
    }

    function resetAdGenerator() {
      adGenClientId = null;
      adGenClientData = null;
      adGenMode = null;
      selectedBiases = [];
      selectedStyles = [];
      selectedPowerStack = null;

      document.getElementById('adClientSelect').value = '';
      document.getElementById('adClientInfo').style.display = 'none';
      document.getElementById('adGenStep2').style.display = 'none';
      document.getElementById('adGenCopyOptions').style.display = 'none';
      document.getElementById('adGenImageOptions').style.display = 'none';
      document.getElementById('adGenActions').style.display = 'none';
      document.getElementById('adGenResults').style.display = 'none';

      document.querySelectorAll('.ad-gen-mode-card').forEach(card => card.classList.remove('selected'));
      document.querySelectorAll('.bias-item').forEach(item => item.classList.remove('selected'));
      document.querySelectorAll('.style-item').forEach(item => item.classList.remove('selected'));
      document.querySelectorAll('.power-stack-btn').forEach(btn => btn.classList.remove('selected'));
    }

    async function generateAds() {
      if (!adGenClientId) {
        showToast('Please select a client first', 'warning');
        return;
      }

      if (!adGenMode) {
        showToast('Please select a generation mode', 'warning');
        return;
      }

      const btn = document.getElementById('generateAdsBtn');
      const originalText = btn.innerHTML;
      btn.innerHTML = '<span class="loading-spinner"></span> Generating...';
      btn.disabled = true;

      // Show progress indicator
      const resultsSection = document.getElementById('adGenResults');
      resultsSection.innerHTML = '<div class="generating-message"><span class="loading-spinner"></span><p>Generating your ad content with AI...</p><p class="generating-submessage">This may take 15-30 seconds</p></div>';
      resultsSection.style.display = 'block';

      try {
        let copyResults = null;
        let imageResults = null;
        let totalTokens = 0;
        let hasErrors = false;

        // Generate copy if needed
        if (adGenMode === 'copy' || adGenMode === 'full') {
          resultsSection.querySelector('.generating-message p').textContent = 'Generating ad copy...';

          const copyRes = await fetch('/api/ads/generate-copy', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              client_id: adGenClientId,
              ad_type: document.getElementById('adCopyAdType').value,
              tone: document.getElementById('adCopyTone').value,
              hook_angle: document.getElementById('adCopyHook').value,
              target_audience: document.getElementById('adCopyAudience').value,
              offer_details: document.getElementById('adCopyOffer').value,
              num_variations: parseInt(document.getElementById('adCopyVariations').value)
            })
          });

          copyResults = await copyRes.json();

          if (!copyResults.success) {
            console.error('Copy generation error:', copyResults.error);
            showToast('Copy generation failed: ' + (copyResults.error || 'Unknown error'), 'error');
            hasErrors = true;
          } else if (copyResults.tokens_used) {
            totalTokens += copyResults.tokens_used;
          }
        }

        // Generate image prompts if needed
        if (adGenMode === 'image' || adGenMode === 'full') {
          resultsSection.querySelector('.generating-message p').textContent = 'Generating image prompts...';

          const imageRes = await fetch('/api/ads/generate-image-prompt', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              client_id: adGenClientId,
              awareness_level: document.getElementById('adImageAwareness').value,
              biases: selectedBiases.length > 0 ? selectedBiases : undefined,
              power_stack: selectedPowerStack,
              styles: selectedStyles.length > 0 ? selectedStyles : ['ugc_raw', 'before_after'],
              aspect_ratio: document.getElementById('adImageAspect').value,
              num_prompts: parseInt(document.getElementById('adImagePrompts').value),
              custom_concept: document.getElementById('adImageConcept').value,
              ad_copy_id: copyResults?.variations?.[0]?.id || copyResults?.ad_copies?.[0]?.id
            })
          });

          imageResults = await imageRes.json();

          if (!imageResults.success) {
            console.error('Image generation error:', imageResults.error);
            showToast('Image prompt generation failed: ' + (imageResults.error || 'Unknown error'), 'error');
            hasErrors = true;
          } else if (imageResults.tokens_used) {
            totalTokens += imageResults.tokens_used;
          }
        }

        // Display results (even if there were partial errors)
        displayAdResults(copyResults, imageResults, totalTokens);

        if (!hasErrors) {
          showToast('Generation complete!', 'success');
        }

      } catch (error) {
        console.error('Error generating ads:', error);
        showToast('Error: ' + error.message, 'error');
        resultsSection.innerHTML = `<div class="error-message"><p>Generation failed</p><p class="error-details">${error.message}</p><button class="btn btn-secondary" onclick="resetAdGenerator()">Try Again</button></div>`;
      } finally {
        btn.innerHTML = originalText;
        btn.disabled = false;
      }
    }

    function displayAdResults(copyResults, imageResults, totalTokens) {
      const resultsSection = document.getElementById('adGenResults');

      // Restore the proper results structure (it may have been replaced with generating message)
      if (!document.getElementById('adCopyResults')) {
        resultsSection.innerHTML = `
          <h3>Generation Results</h3>
          <div id="adCopyResults" style="display: none;">
            <h4>Ad Copy Variations</h4>
            <div id="adCopyResultsList" class="ad-results-list"></div>
          </div>
          <div id="adImageResults" style="display: none;">
            <h4>Image Prompts</h4>
            <div id="adImageResultsList" class="ad-results-list"></div>
          </div>
          <div class="ad-gen-stats">
            <span id="adGenTokens">Tokens: 0</span>
            <span id="adGenCost">Est. Cost: $0.00</span>
          </div>
          <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
            <button class="btn btn-secondary" onclick="copyAllResults()">Copy All</button>
            <button class="btn btn-secondary" onclick="exportResults()">Export JSON</button>
          </div>
        `;
      }

      const copySection = document.getElementById('adCopyResults');
      const imageSection = document.getElementById('adImageResults');
      const copyList = document.getElementById('adCopyResultsList');
      const imageList = document.getElementById('adImageResultsList');

      // Clear previous results
      copyList.innerHTML = '';
      imageList.innerHTML = '';

      // Display copy results (API returns 'variations' not 'ad_copies')
      const copies = copyResults?.variations || copyResults?.ad_copies || [];
      if (copyResults?.success && copies.length > 0) {
        copySection.style.display = 'block';
        copyList.innerHTML = copies.map((copy, i) => `
          <div class="ad-result-card">
            <div class="ad-result-card-header">
              <h4>Variation ${i + 1} - ${copy.hook_angle || 'Hook'}</h4>
              <button class="copy-btn" onclick="copyToClipboard('${escapeHtml(copy.primary_text)}')">Copy</button>
            </div>
            <div class="ad-copy-content">
              <div class="ad-copy-field">
                <div class="ad-copy-field-label">Primary Text</div>
                <div class="ad-copy-field-value">${escapeHtml(copy.primary_text)}</div>
              </div>
              <div class="ad-copy-field">
                <div class="ad-copy-field-label">Headline</div>
                <div class="ad-copy-field-value">${escapeHtml(copy.headline)}</div>
              </div>
              <div class="ad-copy-field">
                <div class="ad-copy-field-label">Description</div>
                <div class="ad-copy-field-value">${escapeHtml(copy.description || '')}</div>
              </div>
              <div class="ad-copy-field">
                <div class="ad-copy-field-label">CTA</div>
                <div class="ad-copy-field-value">${escapeHtml(copy.cta || 'Learn More')}</div>
              </div>
            </div>
          </div>
        `).join('');
      } else {
        copySection.style.display = 'none';
      }

      // Display image prompt results
      if (imageResults?.success && imageResults.prompts) {
        imageSection.style.display = 'block';
        imageList.innerHTML = imageResults.prompts.map((prompt, i) => `
          <div class="ad-result-card">
            <div class="ad-result-card-header">
              <h4>Prompt ${i + 1} - ${prompt.ad_style || 'Custom'}</h4>
              <button class="copy-btn" onclick="copyToClipboard(\`${escapeHtml(prompt.prompt)}\`)">Copy</button>
            </div>
            <div class="ad-prompt-content">${escapeHtml(prompt.prompt)}</div>
            ${prompt.negative_prompt ? `<div class="ad-prompt-content" style="margin-top: 0.5rem; opacity: 0.7;"><strong>Negative:</strong> ${escapeHtml(prompt.negative_prompt)}</div>` : ''}
            ${prompt.strategic_notes ? `
              <div class="ad-prompt-meta">
                <span class="ad-prompt-tag">${prompt.strategic_notes.awareness_level || ''}</span>
                ${(prompt.strategic_notes.biases_applied || []).map(b => `<span class="ad-prompt-tag">${b}</span>`).join('')}
              </div>
            ` : ''}
          </div>
        `).join('');
      } else {
        imageSection.style.display = 'none';
      }

      // Display stats
      const estCost = (totalTokens / 1000) * 0.003; // Rough estimate
      document.getElementById('adGenTokens').textContent = `Tokens: ${totalTokens.toLocaleString()}`;
      document.getElementById('adGenCost').textContent = `Est. Cost: $${estCost.toFixed(4)}`;

      resultsSection.style.display = 'block';
    }

    function escapeHtml(text) {
      if (!text) return '';
      return text
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#039;')
        .replace(/`/g, '&#96;');
    }

    function copyToClipboard(text) {
      navigator.clipboard.writeText(text).then(() => {
        // Could add a toast notification here
      });
    }

    function copyAllResults() {
      const copyList = document.getElementById('adCopyResultsList');
      const imageList = document.getElementById('adImageResultsList');

      let allText = '';

      if (copyList.children.length > 0) {
        allText += '=== AD COPY ===\n\n';
        document.querySelectorAll('#adCopyResultsList .ad-copy-field-value').forEach((el, i) => {
          allText += el.textContent + '\n\n';
        });
      }

      if (imageList.children.length > 0) {
        allText += '=== IMAGE PROMPTS ===\n\n';
        document.querySelectorAll('#adImageResultsList .ad-prompt-content').forEach((el, i) => {
          allText += el.textContent + '\n\n---\n\n';
        });
      }

      navigator.clipboard.writeText(allText);
    }

    function exportResults() {
      const copyResults = [];
      document.querySelectorAll('#adCopyResultsList .ad-result-card').forEach(card => {
        const fields = card.querySelectorAll('.ad-copy-field-value');
        copyResults.push({
          primary_text: fields[0]?.textContent || '',
          headline: fields[1]?.textContent || '',
          description: fields[2]?.textContent || '',
          cta: fields[3]?.textContent || ''
        });
      });

      const imagePrompts = [];
      document.querySelectorAll('#adImageResultsList .ad-prompt-content').forEach(el => {
        imagePrompts.push(el.textContent);
      });

      const data = {
        client: adGenClientData?.name || 'Unknown',
        generated_at: new Date().toISOString(),
        ad_copies: copyResults,
        image_prompts: imagePrompts
      };

      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `ad-generator-${Date.now()}.json`;
      a.click();
      URL.revokeObjectURL(url);
    }
  </script>
</body>
</html>
