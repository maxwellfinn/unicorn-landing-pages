<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Landing Pages | Unicorn Marketers</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --primary-blue: #3B9FD8;
      --primary-blue-dark: #2d7fb0;
      --primary-blue-light: #5bb5e8;
      --dark-gray: #3D4246;
      --text-dark: #2D3436;
      --text-medium: #636E72;
      --text-light: #B2BEC3;
      --bg-white: #FFFFFF;
      --bg-light: #F8FAFB;
      --bg-sidebar: #1a1d21;
      --bg-sidebar-hover: #2a2d32;
      --border-light: #E8EDEF;
      --success: #00B894;
      --warning: #FDCB6E;
      --error: #E17055;
      --shadow-sm: 0 2px 8px rgba(59, 159, 216, 0.08);
      --shadow-md: 0 8px 30px rgba(59, 159, 216, 0.12);
      --shadow-lg: 0 20px 60px rgba(59, 159, 216, 0.15);
      --sidebar-width: 260px;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg-light);
      color: var(--text-dark);
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* ============================================
       LOADING SCREEN
    ============================================ */
    .loading-screen {
      position: fixed;
      inset: 0;
      background: linear-gradient(135deg, #f8fafb 0%, #e8f4f8 100%);
      z-index: 9999;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      transition: opacity 0.5s ease, visibility 0.5s ease;
    }

    .loading-screen.hidden {
      opacity: 0;
      visibility: hidden;
      pointer-events: none;
    }

    .unicorn-loader {
      width: 200px;
      height: 200px;
      position: relative;
    }

    .unicorn-character {
      position: absolute;
      width: 120px;
      height: 100px;
      left: 50%;
      transform: translateX(-50%);
      top: 20px;
    }

    .unicorn-body {
      position: absolute;
      width: 60px;
      height: 45px;
      background: linear-gradient(135deg, #fff 0%, #f0f0f0 100%);
      border-radius: 30px 30px 25px 25px;
      top: 35px;
      left: 30px;
      box-shadow: inset -5px -5px 10px rgba(0,0,0,0.05);
    }

    .unicorn-head {
      position: absolute;
      width: 35px;
      height: 32px;
      background: linear-gradient(135deg, #fff 0%, #f5f5f5 100%);
      border-radius: 50% 50% 45% 45%;
      top: 20px;
      left: 65px;
    }

    .unicorn-horn {
      position: absolute;
      width: 0;
      height: 0;
      border-left: 6px solid transparent;
      border-right: 6px solid transparent;
      border-bottom: 25px solid var(--primary-blue);
      top: -2px;
      left: 75px;
      transform: rotate(15deg);
      animation: hornGlow 1.5s ease-in-out infinite;
    }

    @keyframes hornGlow {
      0%, 100% { filter: drop-shadow(0 0 3px var(--primary-blue)); }
      50% { filter: drop-shadow(0 0 8px var(--primary-blue-light)); }
    }

    .unicorn-ear {
      position: absolute;
      width: 12px;
      height: 16px;
      background: #fff;
      border-radius: 50% 50% 0 0;
      top: 12px;
      left: 68px;
      transform: rotate(-15deg);
    }

    .unicorn-mane {
      position: absolute;
      top: 25px;
      left: 55px;
    }

    .mane-strand {
      position: absolute;
      width: 8px;
      height: 20px;
      border-radius: 4px;
      animation: maneWave 1s ease-in-out infinite;
    }

    .mane-strand:nth-child(1) { background: var(--primary-blue); left: 0; }
    .mane-strand:nth-child(2) { background: #5bb5e8; left: 6px; animation-delay: 0.1s; height: 25px; top: -3px; }
    .mane-strand:nth-child(3) { background: #00B894; left: 12px; animation-delay: 0.2s; height: 22px; top: -1px; }

    @keyframes maneWave {
      0%, 100% { transform: rotate(-5deg); }
      50% { transform: rotate(5deg); }
    }

    .unicorn-eye {
      position: absolute;
      width: 6px;
      height: 6px;
      background: var(--dark-gray);
      border-radius: 50%;
      top: 32px;
      left: 85px;
      animation: blink 3s ease-in-out infinite;
    }

    @keyframes blink {
      0%, 90%, 100% { transform: scaleY(1); }
      95% { transform: scaleY(0.1); }
    }

    .unicorn-snout {
      position: absolute;
      width: 4px;
      height: 3px;
      background: #ffb6c1;
      border-radius: 50%;
      top: 42px;
      left: 92px;
    }

    .unicorn-leg-front {
      position: absolute;
      width: 10px;
      height: 20px;
      background: #fff;
      border-radius: 5px;
      top: 70px;
    }

    .unicorn-leg-front.left {
      left: 45px;
      animation: typeLeft 0.3s ease-in-out infinite;
    }

    .unicorn-leg-front.right {
      left: 58px;
      animation: typeRight 0.3s ease-in-out infinite 0.15s;
    }

    @keyframes typeLeft {
      0%, 100% { transform: translateY(0) rotate(-5deg); }
      50% { transform: translateY(-8px) rotate(-15deg); }
    }

    @keyframes typeRight {
      0%, 100% { transform: translateY(0) rotate(5deg); }
      50% { transform: translateY(-8px) rotate(15deg); }
    }

    .unicorn-leg-back {
      position: absolute;
      width: 10px;
      height: 18px;
      background: #f5f5f5;
      border-radius: 5px;
      top: 72px;
    }

    .unicorn-leg-back.left { left: 32px; }
    .unicorn-leg-back.right { left: 75px; }

    .unicorn-tail {
      position: absolute;
      top: 50px;
      left: 15px;
    }

    .tail-strand {
      position: absolute;
      width: 6px;
      height: 25px;
      border-radius: 3px;
      animation: tailWag 1.2s ease-in-out infinite;
      transform-origin: top;
    }

    .tail-strand:nth-child(1) { background: var(--primary-blue); left: 0; }
    .tail-strand:nth-child(2) { background: #5bb5e8; left: 5px; animation-delay: 0.1s; }
    .tail-strand:nth-child(3) { background: #00B894; left: 10px; animation-delay: 0.2s; }

    @keyframes tailWag {
      0%, 100% { transform: rotate(-15deg); }
      50% { transform: rotate(15deg); }
    }

    .laptop {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
    }

    .laptop-screen {
      width: 80px;
      height: 50px;
      background: linear-gradient(135deg, #2d3436 0%, #3d4246 100%);
      border-radius: 4px 4px 0 0;
      border: 3px solid #636e72;
      position: relative;
      overflow: hidden;
    }

    .laptop-screen::before {
      content: '';
      position: absolute;
      inset: 4px;
      background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
      border-radius: 2px;
    }

    .code-line {
      position: absolute;
      height: 3px;
      border-radius: 1px;
      animation: codePulse 0.8s ease-in-out infinite;
    }

    .code-line:nth-child(1) { width: 25px; background: var(--primary-blue); top: 10px; left: 8px; }
    .code-line:nth-child(2) { width: 35px; background: #00B894; top: 17px; left: 8px; animation-delay: 0.2s; }
    .code-line:nth-child(3) { width: 20px; background: #FDCB6E; top: 24px; left: 8px; animation-delay: 0.4s; }
    .code-line:nth-child(4) { width: 30px; background: var(--primary-blue-light); top: 31px; left: 8px; animation-delay: 0.6s; }

    @keyframes codePulse {
      0%, 100% { opacity: 0.6; }
      50% { opacity: 1; }
    }

    .laptop-base {
      width: 90px;
      height: 6px;
      background: linear-gradient(to bottom, #b2bec3, #636e72);
      border-radius: 0 0 4px 4px;
      margin-left: -5px;
    }

    .loading-text {
      margin-top: 30px;
      font-size: 1rem;
      font-weight: 600;
      color: var(--text-medium);
    }

    .loading-dots::after {
      content: '';
      animation: dots 1.5s steps(4, end) infinite;
    }

    @keyframes dots {
      0% { content: ''; }
      25% { content: '.'; }
      50% { content: '..'; }
      75% { content: '...'; }
    }

    /* ============================================
       INTERACTIVE BACKGROUND
    ============================================ */
    .bg-interactive {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 0;
      overflow: hidden;
    }

    .bg-gradient-orb {
      position: absolute;
      border-radius: 50%;
      filter: blur(80px);
      opacity: 0.4;
      transition: transform 0.3s ease-out;
    }

    .orb-1 {
      width: 500px;
      height: 500px;
      background: linear-gradient(135deg, rgba(59, 159, 216, 0.25) 0%, rgba(0, 184, 148, 0.15) 100%);
      top: -150px;
      right: -100px;
    }

    .orb-2 {
      width: 400px;
      height: 400px;
      background: linear-gradient(135deg, rgba(0, 184, 148, 0.2) 0%, rgba(59, 159, 216, 0.1) 100%);
      bottom: -100px;
      left: 200px;
    }

    .cursor-glow {
      position: fixed;
      width: 350px;
      height: 350px;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(59, 159, 216, 0.12) 0%, transparent 70%);
      pointer-events: none;
      z-index: 1;
      transform: translate(-50%, -50%);
      transition: opacity 0.3s ease;
      opacity: 0;
    }

    .cursor-glow.active {
      opacity: 1;
    }

    /* ============================================
       LAYOUT - SIDEBAR + MAIN
    ============================================ */
    .app-layout {
      display: flex;
      min-height: 100vh;
      position: relative;
      z-index: 2;
    }

    /* ============================================
       SIDEBAR
    ============================================ */
    .sidebar {
      width: var(--sidebar-width);
      background: var(--bg-sidebar);
      color: #fff;
      display: flex;
      flex-direction: column;
      position: fixed;
      left: 0;
      top: 0;
      bottom: 0;
      z-index: 100;
      transition: transform 0.3s ease;
    }

    .sidebar-header {
      padding: 1.5rem;
      border-bottom: 1px solid rgba(255,255,255,0.08);
    }

    .sidebar-logo {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .sidebar-logo img {
      height: 38px;
      width: auto;
      filter: brightness(0) invert(1);
    }

    .sidebar-nav {
      flex: 1;
      padding: 1rem 0;
      overflow-y: auto;
    }

    .nav-section {
      padding: 0 0.75rem;
      margin-bottom: 1.5rem;
    }

    .nav-section-title {
      font-size: 0.65rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: rgba(255,255,255,0.4);
      padding: 0.5rem 0.75rem;
      margin-bottom: 0.25rem;
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem 1rem;
      border-radius: 10px;
      color: rgba(255,255,255,0.7);
      text-decoration: none;
      font-size: 0.875rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      margin-bottom: 0.25rem;
    }

    .nav-item:hover {
      background: var(--bg-sidebar-hover);
      color: #fff;
    }

    .nav-item.active {
      background: linear-gradient(135deg, var(--primary-blue) 0%, var(--primary-blue-dark) 100%);
      color: #fff;
    }

    .nav-item svg {
      width: 20px;
      height: 20px;
      flex-shrink: 0;
    }

    .nav-item .badge {
      margin-left: auto;
      background: rgba(255,255,255,0.15);
      color: rgba(255,255,255,0.8);
      font-size: 0.7rem;
      font-weight: 600;
      padding: 0.2rem 0.5rem;
      border-radius: 10px;
    }

    .nav-item.active .badge {
      background: rgba(255,255,255,0.25);
      color: #fff;
    }

    .sidebar-footer {
      padding: 1rem 1.5rem;
      border-top: 1px solid rgba(255,255,255,0.08);
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .user-avatar {
      width: 36px;
      height: 36px;
      border-radius: 10px;
      background: linear-gradient(135deg, var(--primary-blue) 0%, var(--success) 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 0.875rem;
    }

    .user-details {
      flex: 1;
      min-width: 0;
    }

    .user-name {
      font-size: 0.875rem;
      font-weight: 600;
      color: #fff;
    }

    .user-role {
      font-size: 0.7rem;
      color: rgba(255,255,255,0.5);
    }

    /* ============================================
       MAIN CONTENT
    ============================================ */
    .main-content {
      flex: 1;
      margin-left: var(--sidebar-width);
      min-height: 100vh;
    }

    .main-header {
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--border-light);
      padding: 1rem 2rem;
      position: sticky;
      top: 0;
      z-index: 50;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .page-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--text-dark);
    }

    .main-body {
      padding: 2rem;
    }

    /* ============================================
       BUTTONS
    ============================================ */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      padding: 0.75rem 1.5rem;
      border-radius: 12px;
      font-size: 0.875rem;
      font-weight: 600;
      cursor: pointer;
      border: none;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--primary-blue) 0%, var(--primary-blue-dark) 100%);
      color: white;
      box-shadow: 0 4px 15px rgba(59, 159, 216, 0.3);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(59, 159, 216, 0.4);
    }

    .btn-secondary {
      background: var(--bg-white);
      color: var(--text-dark);
      border: 1px solid var(--border-light);
    }

    .btn-secondary:hover {
      background: var(--bg-light);
      border-color: var(--primary-blue);
      color: var(--primary-blue);
    }

    .btn-ghost {
      background: transparent;
      color: var(--text-medium);
      padding: 0.5rem;
    }

    .btn-ghost:hover {
      background: var(--bg-light);
      color: var(--primary-blue);
    }

    .btn-success {
      background: linear-gradient(135deg, var(--success) 0%, #00a884 100%);
      color: white;
      box-shadow: 0 4px 15px rgba(0, 184, 148, 0.3);
    }

    .btn-success:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0, 184, 148, 0.4);
    }

    .btn-small {
      padding: 0.5rem 1rem;
      font-size: 0.75rem;
      border-radius: 8px;
    }

    .btn-icon {
      width: 36px;
      height: 36px;
      padding: 0;
      border-radius: 10px;
    }

    /* ============================================
       STATS CARDS
    ============================================ */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    @media (max-width: 1200px) {
      .stats-grid { grid-template-columns: repeat(2, 1fr); }
    }

    @media (max-width: 768px) {
      .stats-grid { grid-template-columns: 1fr; }
    }

    .stat-card {
      background: var(--bg-white);
      border-radius: 16px;
      padding: 1.5rem;
      border: 1px solid var(--border-light);
      transition: all 0.3s ease;
    }

    .stat-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-md);
    }

    .stat-icon {
      width: 44px;
      height: 44px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.25rem;
      margin-bottom: 1rem;
    }

    .stat-icon.blue { background: rgba(59, 159, 216, 0.1); }
    .stat-icon.green { background: rgba(0, 184, 148, 0.1); }
    .stat-icon.orange { background: rgba(253, 203, 110, 0.15); }
    .stat-icon.purple { background: rgba(162, 155, 254, 0.15); }

    .stat-label {
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-medium);
      margin-bottom: 0.5rem;
    }

    .stat-value {
      font-size: 2rem;
      font-weight: 800;
      color: var(--text-dark);
    }

    /* ============================================
       PAGES SECTION
    ============================================ */
    .section-card {
      background: var(--bg-white);
      border-radius: 20px;
      border: 1px solid var(--border-light);
      overflow: hidden;
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1.25rem 1.5rem;
      border-bottom: 1px solid var(--border-light);
      background: var(--bg-light);
    }

    .section-title {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .section-title h2 {
      font-size: 1.125rem;
      font-weight: 700;
      color: var(--text-dark);
    }

    .section-title .badge {
      background: var(--primary-blue);
      color: white;
      font-size: 0.7rem;
      font-weight: 700;
      padding: 0.2rem 0.5rem;
      border-radius: 10px;
    }

    /* Pages Table */
    .pages-table-wrapper {
      overflow-x: auto;
    }

    .pages-table {
      width: 100%;
      border-collapse: collapse;
    }

    .pages-table th {
      padding: 1rem 1.25rem;
      text-align: left;
      font-size: 0.7rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-medium);
      background: var(--bg-light);
      border-bottom: 1px solid var(--border-light);
    }

    .pages-table td {
      padding: 1rem 1.25rem;
      border-bottom: 1px solid var(--border-light);
      vertical-align: middle;
    }

    .pages-table tbody tr {
      transition: background 0.2s ease;
    }

    .pages-table tbody tr:hover {
      background: rgba(59, 159, 216, 0.03);
    }

    .pages-table tbody tr:last-child td {
      border-bottom: none;
    }

    .page-name {
      display: flex;
      flex-direction: column;
      gap: 0.2rem;
    }

    .page-name strong {
      font-weight: 600;
      color: var(--text-dark);
    }

    .page-name small {
      font-size: 0.75rem;
      color: var(--text-light);
    }

    .status-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.375rem;
      padding: 0.35rem 0.75rem;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 600;
    }

    .status-badge .dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
    }

    .status-live {
      background: rgba(0, 184, 148, 0.1);
      color: var(--success);
    }

    .status-live .dot {
      background: var(--success);
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .status-draft {
      background: rgba(253, 203, 110, 0.15);
      color: #d4a017;
    }

    .status-draft .dot {
      background: var(--warning);
    }

    .page-link {
      color: var(--primary-blue);
      text-decoration: none;
      font-size: 0.875rem;
      font-weight: 500;
    }

    .page-link:hover {
      text-decoration: underline;
    }

    .actions {
      display: flex;
      gap: 0.375rem;
    }

    .metric {
      font-weight: 600;
      color: var(--text-dark);
    }

    .metric-secondary {
      color: var(--text-light);
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 4rem 2rem;
    }

    .empty-illustration {
      width: 140px;
      height: 140px;
      margin: 0 auto 1.5rem;
      background: linear-gradient(135deg, var(--bg-light) 0%, #e8f4f8 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 3.5rem;
    }

    .empty-state h3 {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--text-dark);
      margin-bottom: 0.5rem;
    }

    .empty-state p {
      color: var(--text-medium);
      max-width: 350px;
      margin: 0 auto 1.5rem;
      line-height: 1.5;
    }

    /* ============================================
       MODALS
    ============================================ */
    .modal-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(45, 52, 54, 0.6);
      backdrop-filter: blur(8px);
      z-index: 1000;
      justify-content: center;
      align-items: center;
      padding: 1rem;
    }

    .modal-overlay.active {
      display: flex;
    }

    .modal {
      background: var(--bg-white);
      border-radius: 20px;
      width: 100%;
      max-width: 900px;
      max-height: 90vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      box-shadow: var(--shadow-lg);
    }

    .modal.modal-large {
      max-width: 1200px;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1.25rem 1.5rem;
      border-bottom: 1px solid var(--border-light);
      background: var(--bg-light);
    }

    .modal-header h2 {
      font-size: 1.125rem;
      font-weight: 700;
      color: var(--text-dark);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .modal-close {
      width: 32px;
      height: 32px;
      border-radius: 8px;
      background: transparent;
      border: none;
      color: var(--text-medium);
      font-size: 1.25rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }

    .modal-close:hover {
      background: var(--bg-white);
      color: var(--error);
    }

    .modal-body {
      padding: 1.5rem;
      overflow-y: auto;
      flex: 1;
    }

    .modal-footer {
      display: flex;
      justify-content: flex-end;
      gap: 0.75rem;
      padding: 1.25rem 1.5rem;
      border-top: 1px solid var(--border-light);
      background: var(--bg-light);
    }

    /* Form Styles */
    .form-group {
      margin-bottom: 1.25rem;
    }

    .form-group label {
      display: block;
      font-size: 0.875rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: var(--text-dark);
    }

    .form-group label span {
      color: var(--error);
    }

    .form-group input,
    .form-group textarea,
    .form-group select {
      width: 100%;
      padding: 0.75rem 1rem;
      background: var(--bg-light);
      border: 2px solid var(--border-light);
      border-radius: 10px;
      color: var(--text-dark);
      font-size: 0.875rem;
      font-family: inherit;
      transition: all 0.2s ease;
    }

    .form-group input:focus,
    .form-group textarea:focus,
    .form-group select:focus {
      outline: none;
      border-color: var(--primary-blue);
      background: var(--bg-white);
    }

    .form-group textarea {
      min-height: 200px;
      font-family: 'SF Mono', Monaco, monospace;
      font-size: 0.8125rem;
      line-height: 1.5;
      resize: vertical;
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    }

    @media (max-width: 640px) {
      .form-row { grid-template-columns: 1fr; }
    }

    .form-hint {
      font-size: 0.75rem;
      color: var(--text-light);
      margin-top: 0.375rem;
    }

    /* Deploy Result */
    .deploy-result {
      background: rgba(0, 184, 148, 0.08);
      border: 2px solid var(--success);
      border-radius: 12px;
      padding: 1.25rem;
      margin-bottom: 1.25rem;
    }

    .deploy-result h4 {
      color: var(--success);
      font-size: 0.95rem;
      font-weight: 700;
      margin-bottom: 0.375rem;
    }

    .deploy-result p {
      color: var(--text-medium);
      font-size: 0.875rem;
    }

    .deploy-result a {
      color: var(--success);
      font-weight: 600;
    }

    /* ============================================
       ANALYTICS MODAL
    ============================================ */
    .analytics-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    @media (max-width: 640px) {
      .analytics-grid { grid-template-columns: 1fr; }
    }

    .analytics-card {
      background: var(--bg-light);
      border: 1px solid var(--border-light);
      border-radius: 12px;
      padding: 1.25rem;
      text-align: center;
    }

    .analytics-card .label {
      font-size: 0.7rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-medium);
      margin-bottom: 0.375rem;
    }

    .analytics-card .value {
      font-size: 1.75rem;
      font-weight: 800;
      color: var(--text-dark);
    }

    /* Tabs */
    .tabs {
      display: flex;
      gap: 0.25rem;
      margin-bottom: 1.5rem;
      border-bottom: 2px solid var(--border-light);
    }

    .tab {
      padding: 0.75rem 1.25rem;
      background: none;
      border: none;
      color: var(--text-medium);
      font-size: 0.875rem;
      font-weight: 600;
      cursor: pointer;
      position: relative;
      transition: all 0.2s ease;
    }

    .tab::after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 0;
      right: 0;
      height: 2px;
      background: var(--primary-blue);
      transform: scaleX(0);
      transition: transform 0.2s ease;
    }

    .tab:hover {
      color: var(--text-dark);
    }

    .tab.active {
      color: var(--primary-blue);
    }

    .tab.active::after {
      transform: scaleX(1);
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    /* Leads Table */
    .leads-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.875rem;
    }

    .leads-table th,
    .leads-table td {
      padding: 0.875rem;
      text-align: left;
      border-bottom: 1px solid var(--border-light);
    }

    .leads-table th {
      font-size: 0.7rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-medium);
      background: var(--bg-light);
    }

    /* ============================================
       GENERATE PAGE MODAL
    ============================================ */
    .generate-options {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    @media (max-width: 1024px) {
      .generate-options { grid-template-columns: repeat(3, 1fr); }
    }

    @media (max-width: 768px) {
      .generate-options { grid-template-columns: repeat(2, 1fr); }
    }

    @media (max-width: 480px) {
      .generate-options { grid-template-columns: 1fr; }
    }

    .generate-option {
      background: var(--bg-light);
      border: 2px solid var(--border-light);
      border-radius: 14px;
      padding: 1rem;
      cursor: pointer;
      transition: all 0.2s ease;
      text-align: center;
    }

    .generate-option:hover {
      border-color: var(--primary-blue);
      background: var(--bg-white);
    }

    .generate-option.selected {
      border-color: var(--primary-blue);
      background: rgba(59, 159, 216, 0.05);
    }

    .generate-option-icon {
      width: 48px;
      height: 48px;
      border-radius: 12px;
      background: linear-gradient(135deg, var(--primary-blue) 0%, var(--primary-blue-dark) 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 0.75rem;
      font-size: 1.35rem;
    }

    .generate-option h4 {
      font-size: 1rem;
      font-weight: 700;
      color: var(--text-dark);
      margin-bottom: 0.375rem;
    }

    .generate-option p {
      font-size: 0.8rem;
      color: var(--text-medium);
      line-height: 1.4;
    }

    /* ============================================
       PIPELINE PROGRESS
    ============================================ */
    .pipeline-progress {
      padding: 1rem;
    }

    .pipeline-steps {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .pipeline-step {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1rem;
      background: var(--bg-light);
      border-radius: 12px;
      border: 2px solid var(--border-light);
      transition: all 0.3s ease;
    }

    .pipeline-step.pending {
      opacity: 0.5;
    }

    .pipeline-step.running {
      border-color: var(--primary-blue);
      background: rgba(59, 159, 216, 0.05);
      animation: pulseBorder 1.5s ease-in-out infinite;
    }

    .pipeline-step.completed {
      border-color: var(--success);
      background: rgba(0, 184, 148, 0.05);
    }

    .pipeline-step.failed {
      border-color: var(--error);
      background: rgba(225, 112, 85, 0.05);
    }

    @keyframes pulseBorder {
      0%, 100% { box-shadow: 0 0 0 0 rgba(59, 159, 216, 0.4); }
      50% { box-shadow: 0 0 0 8px rgba(59, 159, 216, 0); }
    }

    .step-indicator {
      position: relative;
      width: 48px;
      height: 48px;
      flex-shrink: 0;
    }

    .step-icon {
      width: 48px;
      height: 48px;
      border-radius: 12px;
      background: var(--bg-white);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      border: 2px solid var(--border-light);
    }

    .pipeline-step.running .step-icon {
      border-color: var(--primary-blue);
    }

    .pipeline-step.completed .step-icon {
      border-color: var(--success);
      background: var(--success);
    }

    .pipeline-step.completed .step-icon::after {
      content: '‚úì';
      position: absolute;
      color: white;
      font-size: 1.5rem;
      font-weight: bold;
    }

    .step-status {
      position: absolute;
      bottom: -4px;
      right: -4px;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: var(--bg-white);
      border: 2px solid var(--border-light);
      display: none;
    }

    .pipeline-step.running .step-status {
      display: block;
      background: var(--primary-blue);
      border-color: var(--primary-blue);
      animation: spin 1s linear infinite;
    }

    .pipeline-step.running .step-status::after {
      content: '';
      position: absolute;
      inset: 2px;
      border: 2px solid transparent;
      border-top-color: white;
      border-radius: 50%;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .step-info {
      flex: 1;
    }

    .step-name {
      font-weight: 600;
      font-size: 0.95rem;
      color: var(--text-dark);
      margin-bottom: 0.25rem;
    }

    .step-desc {
      font-size: 0.8rem;
      color: var(--text-medium);
    }

    .pipeline-step.running .step-desc::after {
      content: '...';
      animation: dots 1.5s steps(4, end) infinite;
    }

    .pipeline-summary {
      margin-top: 1.5rem;
      padding: 1rem;
      background: var(--bg-light);
      border-radius: 12px;
      border: 1px solid var(--border-light);
    }

    .summary-stats {
      display: flex;
      justify-content: space-around;
      gap: 1rem;
    }

    .summary-stat {
      text-align: center;
    }

    .summary-stat .stat-label {
      font-size: 0.75rem;
      color: var(--text-medium);
      display: block;
      margin-bottom: 0.25rem;
    }

    .summary-stat .stat-value {
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--text-dark);
    }

    /* ============================================
       VISUAL EDITOR MODAL
    ============================================ */
    .editor-container {
      display: flex;
      flex-direction: column;
      height: 100%;
    }

    .editor-toolbar {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      padding: 0.75rem;
      background: var(--bg-light);
      border-bottom: 1px solid var(--border-light);
      align-items: center;
    }

    .toolbar-group {
      display: flex;
      align-items: center;
      gap: 0.25rem;
      padding-right: 0.75rem;
      border-right: 1px solid var(--border-light);
    }

    .toolbar-group:last-child {
      border-right: none;
    }

    .toolbar-btn {
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--bg-white);
      border: 1px solid var(--border-light);
      border-radius: 6px;
      cursor: pointer;
      color: var(--text-dark);
      font-size: 0.875rem;
      transition: all 0.15s ease;
    }

    .toolbar-btn:hover {
      background: var(--primary-blue);
      color: white;
      border-color: var(--primary-blue);
    }

    .toolbar-btn.active {
      background: var(--primary-blue);
      color: white;
      border-color: var(--primary-blue);
    }

    .toolbar-btn svg {
      width: 16px;
      height: 16px;
    }

    .toolbar-select {
      padding: 0.4rem 0.75rem;
      border: 1px solid var(--border-light);
      border-radius: 6px;
      font-size: 0.8rem;
      background: var(--bg-white);
      color: var(--text-dark);
      cursor: pointer;
      min-width: 100px;
    }

    .toolbar-select:focus {
      outline: none;
      border-color: var(--primary-blue);
    }

    .toolbar-color {
      width: 32px;
      height: 32px;
      padding: 2px;
      border: 1px solid var(--border-light);
      border-radius: 6px;
      cursor: pointer;
      background: var(--bg-white);
    }

    .toolbar-color::-webkit-color-swatch-wrapper {
      padding: 0;
    }

    .toolbar-color::-webkit-color-swatch {
      border: none;
      border-radius: 4px;
    }

    .toolbar-label {
      font-size: 0.7rem;
      color: var(--text-medium);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.03em;
    }

    .editor-main {
      display: grid;
      grid-template-columns: 1fr 320px;
      gap: 1rem;
      flex: 1;
      min-height: 0;
      padding: 1rem;
    }

    @media (max-width: 1200px) {
      .editor-main {
        grid-template-columns: 1fr;
      }
      .editor-sidebar {
        display: none;
      }
    }

    .editor-preview-wrapper {
      display: flex;
      flex-direction: column;
      border: 1px solid var(--border-light);
      border-radius: 12px;
      overflow: hidden;
      background: #fff;
    }

    .preview-header {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 0.75rem;
      background: var(--bg-light);
      border-bottom: 1px solid var(--border-light);
    }

    .preview-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
    }

    .preview-dot.red { background: #ff5f57; }
    .preview-dot.yellow { background: #ffbd2e; }
    .preview-dot.green { background: #28c840; }

    .preview-url {
      flex: 1;
      text-align: center;
      font-size: 0.75rem;
      color: var(--text-light);
      background: var(--bg-white);
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      margin: 0 0.5rem;
    }

    .editor-iframe-container {
      flex: 1;
      position: relative;
      overflow: hidden;
    }

    .editor-preview-wrapper iframe {
      width: 100%;
      height: 100%;
      border: none;
    }

    .editor-sidebar {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      overflow-y: auto;
    }

    .sidebar-panel {
      background: var(--bg-white);
      border: 1px solid var(--border-light);
      border-radius: 12px;
      overflow: hidden;
    }

    .panel-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.75rem 1rem;
      background: var(--bg-light);
      border-bottom: 1px solid var(--border-light);
      cursor: pointer;
    }

    .panel-header h4 {
      font-size: 0.8rem;
      font-weight: 600;
      color: var(--text-dark);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .panel-toggle {
      font-size: 0.75rem;
      color: var(--text-light);
      transition: transform 0.2s ease;
    }

    .panel-header.collapsed .panel-toggle {
      transform: rotate(-90deg);
    }

    .panel-content {
      padding: 1rem;
    }

    .panel-content.collapsed {
      display: none;
    }

    /* Chat Panel */
    .chat-messages {
      max-height: 200px;
      overflow-y: auto;
      padding: 0.75rem;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      background: var(--bg-light);
      border-radius: 8px;
      margin-bottom: 0.75rem;
    }

    .chat-message {
      padding: 0.5rem 0.75rem;
      border-radius: 8px;
      font-size: 0.8rem;
      line-height: 1.4;
    }

    .chat-message.user {
      background: var(--primary-blue);
      color: white;
      align-self: flex-end;
      max-width: 85%;
    }

    .chat-message.assistant {
      background: var(--bg-white);
      color: var(--text-dark);
      align-self: flex-start;
      border: 1px solid var(--border-light);
      max-width: 85%;
    }

    .chat-input-wrapper {
      display: flex;
      gap: 0.5rem;
    }

    .chat-input {
      flex: 1;
      padding: 0.5rem 0.75rem;
      border: 1px solid var(--border-light);
      border-radius: 8px;
      font-size: 0.8rem;
      font-family: inherit;
      resize: none;
    }

    .chat-input:focus {
      outline: none;
      border-color: var(--primary-blue);
    }

    /* Element Properties Panel */
    .property-row {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.75rem;
    }

    .property-row:last-child {
      margin-bottom: 0;
    }

    .property-label {
      font-size: 0.75rem;
      color: var(--text-medium);
      min-width: 70px;
    }

    .property-input {
      flex: 1;
      padding: 0.4rem 0.6rem;
      border: 1px solid var(--border-light);
      border-radius: 6px;
      font-size: 0.8rem;
      font-family: inherit;
    }

    .property-input:focus {
      outline: none;
      border-color: var(--primary-blue);
    }

    .property-color {
      width: 32px;
      height: 28px;
      padding: 2px;
      border: 1px solid var(--border-light);
      border-radius: 6px;
      cursor: pointer;
    }

    /* Media Upload */
    .upload-zone {
      border: 2px dashed var(--border-light);
      border-radius: 8px;
      padding: 1.5rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .upload-zone:hover {
      border-color: var(--primary-blue);
      background: rgba(59, 159, 216, 0.03);
    }

    .upload-zone-icon {
      font-size: 1.5rem;
      margin-bottom: 0.5rem;
    }

    .upload-zone-text {
      font-size: 0.8rem;
      color: var(--text-medium);
    }

    .upload-zone-hint {
      font-size: 0.7rem;
      color: var(--text-light);
      margin-top: 0.25rem;
    }

    /* Device Preview Toggle */
    .device-toggle {
      display: flex;
      gap: 0.25rem;
      background: var(--bg-light);
      padding: 0.25rem;
      border-radius: 8px;
    }

    .device-btn {
      padding: 0.4rem 0.6rem;
      border: none;
      background: transparent;
      border-radius: 6px;
      cursor: pointer;
      color: var(--text-medium);
      font-size: 0.75rem;
      transition: all 0.15s ease;
    }

    .device-btn.active {
      background: var(--bg-white);
      color: var(--text-dark);
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    .device-btn svg {
      width: 16px;
      height: 16px;
    }

    /* Link Editor Modal */
    .link-editor-popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: var(--bg-white);
      border-radius: 12px;
      box-shadow: var(--shadow-lg);
      padding: 1.5rem;
      z-index: 2000;
      min-width: 350px;
      display: none;
    }

    .link-editor-popup.active {
      display: block;
    }

    .link-editor-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.3);
      z-index: 1999;
      display: none;
    }

    .link-editor-backdrop.active {
      display: block;
    }

    /* ============================================
       LOADING SPINNER
    ============================================ */
    .loading-spinner {
      display: inline-block;
      width: 18px;
      height: 18px;
      border: 2px solid rgba(255,255,255,0.3);
      border-top-color: white;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* ============================================
       MOBILE RESPONSIVE
    ============================================ */
    .mobile-menu-toggle {
      display: none;
      background: none;
      border: none;
      padding: 0.5rem;
      cursor: pointer;
      color: var(--text-dark);
    }

    @media (max-width: 1024px) {
      .sidebar {
        transform: translateX(-100%);
      }

      .sidebar.open {
        transform: translateX(0);
      }

      .main-content {
        margin-left: 0;
      }

      .mobile-menu-toggle {
        display: block;
      }

      .sidebar-overlay {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,0.5);
        z-index: 99;
      }

      .sidebar-overlay.active {
        display: block;
      }
    }

    @media (max-width: 768px) {
      .main-body {
        padding: 1rem;
      }

      .main-header {
        padding: 1rem;
      }

      .page-title {
        font-size: 1.25rem;
      }

      .pages-table .hide-mobile {
        display: none;
      }
    }

    /* ============================================
       SCROLLBAR
    ============================================ */
    ::-webkit-scrollbar {
      width: 6px;
      height: 6px;
    }

    ::-webkit-scrollbar-track {
      background: var(--bg-light);
    }

    ::-webkit-scrollbar-thumb {
      background: var(--border-light);
      border-radius: 3px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--text-light);
    }
  </style>
</head>
<body>
  <!-- Loading Screen -->
  <div class="loading-screen" id="loadingScreen">
    <div class="unicorn-loader">
      <div class="unicorn-character">
        <div class="unicorn-tail">
          <div class="tail-strand"></div>
          <div class="tail-strand"></div>
          <div class="tail-strand"></div>
        </div>
        <div class="unicorn-leg-back left"></div>
        <div class="unicorn-leg-back right"></div>
        <div class="unicorn-body"></div>
        <div class="unicorn-leg-front left"></div>
        <div class="unicorn-leg-front right"></div>
        <div class="unicorn-mane">
          <div class="mane-strand"></div>
          <div class="mane-strand"></div>
          <div class="mane-strand"></div>
        </div>
        <div class="unicorn-head"></div>
        <div class="unicorn-ear"></div>
        <div class="unicorn-horn"></div>
        <div class="unicorn-eye"></div>
        <div class="unicorn-snout"></div>
      </div>
      <div class="laptop">
        <div class="laptop-screen">
          <div class="code-line"></div>
          <div class="code-line"></div>
          <div class="code-line"></div>
          <div class="code-line"></div>
        </div>
        <div class="laptop-base"></div>
      </div>
    </div>
    <div class="loading-text">Building magic<span class="loading-dots"></span></div>
  </div>

  <!-- Interactive Background -->
  <div class="bg-interactive">
    <div class="bg-gradient-orb orb-1"></div>
    <div class="bg-gradient-orb orb-2"></div>
  </div>
  <div class="cursor-glow" id="cursorGlow"></div>

  <!-- Mobile Sidebar Overlay -->
  <div class="sidebar-overlay" id="sidebarOverlay" onclick="closeSidebar()"></div>

  <!-- Main Layout -->
  <div class="app-layout">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-logo">
          <img src="/logo.png" alt="Unicorn Marketers">
        </div>
      </div>

      <nav class="sidebar-nav">
        <div class="nav-section">
          <div class="nav-section-title">Main</div>
          <a class="nav-item active" data-page="dashboard">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="3" width="7" height="7" rx="1"/>
              <rect x="14" y="3" width="7" height="7" rx="1"/>
              <rect x="3" y="14" width="7" height="7" rx="1"/>
              <rect x="14" y="14" width="7" height="7" rx="1"/>
            </svg>
            Dashboard
          </a>
          <a class="nav-item" data-page="pages">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
              <polyline points="14,2 14,8 20,8"/>
            </svg>
            Landing Pages
            <span class="badge" id="navPageCount">0</span>
          </a>
        </div>

        <div class="nav-section">
          <div class="nav-section-title">Clients</div>
          <a class="nav-item" data-page="clients">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
              <circle cx="9" cy="7" r="4"/>
              <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
              <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
            </svg>
            All Clients
            <span class="badge" id="navClientCount">0</span>
          </a>
          <a class="nav-item" onclick="openAddClientModal()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
              <circle cx="8.5" cy="7" r="4"/>
              <line x1="20" y1="8" x2="20" y2="14"/>
              <line x1="17" y1="11" x2="23" y2="11"/>
            </svg>
            Add Client
          </a>
        </div>

        <div class="nav-section">
          <div class="nav-section-title">Create</div>
          <a class="nav-item" onclick="openGenerateModal()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 2L2 7l10 5 10-5-10-5z"/>
              <path d="M2 17l10 5 10-5"/>
              <path d="M2 12l10 5 10-5"/>
            </svg>
            Generate Page
          </a>
          <a class="nav-item" onclick="openCreateModal()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="12" y1="5" x2="12" y2="19"/>
              <line x1="5" y1="12" x2="19" y2="12"/>
            </svg>
            Import HTML
          </a>
        </div>

        <div class="nav-section">
          <div class="nav-section-title">Analytics</div>
          <a class="nav-item" data-page="analytics">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M18 20V10"/>
              <path d="M12 20V4"/>
              <path d="M6 20v-6"/>
            </svg>
            Reports
          </a>
          <a class="nav-item" data-page="leads">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
              <circle cx="9" cy="7" r="4"/>
              <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
              <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
            </svg>
            Leads
          </a>
        </div>
      </nav>

      <div class="sidebar-footer">
        <div class="user-info">
          <div class="user-avatar">UM</div>
          <div class="user-details">
            <div class="user-name">Unicorn Team</div>
            <div class="user-role">Administrator</div>
          </div>
        </div>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <header class="main-header">
        <button class="mobile-menu-toggle" onclick="toggleSidebar()">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="3" y1="6" x2="21" y2="6"/>
            <line x1="3" y1="12" x2="21" y2="12"/>
            <line x1="3" y1="18" x2="21" y2="18"/>
          </svg>
        </button>
        <h1 class="page-title">Dashboard</h1>
        <button class="btn btn-primary" onclick="openCreateModal()">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="8" y1="2" x2="8" y2="14"/>
            <line x1="2" y1="8" x2="14" y2="8"/>
          </svg>
          New Page
        </button>
      </header>

      <div class="main-body">
        <!-- Stats Grid -->
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-icon blue">üìÑ</div>
            <div class="stat-label">Total Pages</div>
            <div class="stat-value" id="statPages">0</div>
          </div>
          <div class="stat-card">
            <div class="stat-icon green">üü¢</div>
            <div class="stat-label">Live Pages</div>
            <div class="stat-value" id="statLive">0</div>
          </div>
          <div class="stat-card">
            <div class="stat-icon orange">üëÅÔ∏è</div>
            <div class="stat-label">Total Views</div>
            <div class="stat-value" id="statViews">0</div>
          </div>
          <div class="stat-card">
            <div class="stat-icon purple">üéØ</div>
            <div class="stat-label">Total Leads</div>
            <div class="stat-value" id="statLeads">0</div>
          </div>
        </div>

        <!-- Pages Table -->
        <div class="section-card">
          <div class="section-header">
            <div class="section-title">
              <h2>Landing Pages</h2>
              <span class="badge" id="pageCount">0</span>
            </div>
            <button class="btn btn-secondary btn-small" onclick="loadPages()">
              <svg width="14" height="14" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M1 7a6 6 0 1 1 1 3.5"/>
                <path d="M1 11V7h4"/>
              </svg>
              Refresh
            </button>
          </div>
          <div id="pagesContainer">
            <div class="empty-state">
              <div class="empty-illustration">ü¶Ñ</div>
              <h3>No landing pages yet</h3>
              <p>Create your first page by generating one with AI or importing HTML.</p>
              <button class="btn btn-primary" onclick="openGenerateModal()">Generate with AI</button>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Create/Edit Modal -->
  <div class="modal-overlay" id="createModal">
    <div class="modal">
      <div class="modal-header">
        <h2 id="modalTitle">‚ú® New Landing Page</h2>
        <button class="modal-close" onclick="closeCreateModal()">&times;</button>
      </div>
      <div class="modal-body">
        <div id="deployResult"></div>
        <form id="pageForm">
          <input type="hidden" id="pageId">
          <div class="form-row">
            <div class="form-group">
              <label for="pageName">Page Name <span>*</span></label>
              <input type="text" id="pageName" placeholder="e.g., Summer Sale Landing Page" required>
            </div>
            <div class="form-group">
              <label for="clientName">Client Name</label>
              <input type="text" id="clientName" placeholder="e.g., Acme Corp">
            </div>
          </div>
          <div class="form-group">
            <label for="pageSlug">URL Slug</label>
            <input type="text" id="pageSlug" placeholder="summer-sale">
            <div class="form-hint">Leave blank to auto-generate from name</div>
          </div>
          <div class="form-group">
            <label for="htmlContent">HTML Content <span>*</span></label>
            <textarea id="htmlContent" placeholder="Paste your landing page HTML here..." required></textarea>
            <div class="form-hint">Paste the full HTML. Tracking code will be auto-injected.</div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="metaTitle">Meta Title</label>
              <input type="text" id="metaTitle" placeholder="Page title for SEO">
            </div>
            <div class="form-group">
              <label for="metaDescription">Meta Description</label>
              <input type="text" id="metaDescription" placeholder="Page description for SEO">
            </div>
          </div>
          <div class="form-group">
            <label for="trackingPixel">Custom Tracking Code</label>
            <textarea id="trackingPixel" style="min-height: 80px;" placeholder="Facebook Pixel, Google Analytics, etc."></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" onclick="closeCreateModal()">Cancel</button>
        <button type="button" class="btn btn-secondary" onclick="saveDraft()" id="saveDraftBtn">Save Draft</button>
        <button type="button" class="btn btn-success" onclick="deployPage()" id="deployBtn">üöÄ Deploy Live</button>
      </div>
    </div>
  </div>

  <!-- Analytics Modal -->
  <div class="modal-overlay" id="analyticsModal">
    <div class="modal modal-large">
      <div class="modal-header">
        <h2 id="analyticsTitle">üìä Page Analytics</h2>
        <button class="modal-close" onclick="closeAnalyticsModal()">&times;</button>
      </div>
      <div class="modal-body">
        <div class="tabs">
          <button class="tab active" onclick="switchTab(event, 'overview')">Overview</button>
          <button class="tab" onclick="switchTab(event, 'leads')">Leads</button>
          <button class="tab" onclick="switchTab(event, 'abtest')">A/B Testing</button>
        </div>
        <div id="tabOverview" class="tab-content active">
          <div class="analytics-grid">
            <div class="analytics-card">
              <div class="label">Page Views</div>
              <div class="value" id="aViews">0</div>
            </div>
            <div class="analytics-card">
              <div class="label">Leads</div>
              <div class="value" id="aLeads">0</div>
            </div>
            <div class="analytics-card">
              <div class="label">Conversion Rate</div>
              <div class="value" id="aConversion">0%</div>
            </div>
          </div>
          <h4 style="margin-bottom: 1rem; font-weight: 600;">Traffic Sources</h4>
          <div id="trafficSources"></div>
        </div>
        <div id="tabLeads" class="tab-content">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
            <h4 style="font-weight: 600;">Captured Leads</h4>
            <button class="btn btn-small btn-secondary" onclick="exportLeads()">Export CSV</button>
          </div>
          <div id="leadsTable"></div>
        </div>
        <div id="tabAbtest" class="tab-content">
          <h4 style="margin-bottom: 1rem; font-weight: 600;">A/B Test Results</h4>
          <div id="abtestResults"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Generate Page Modal -->
  <div class="modal-overlay" id="generateModal">
    <div class="modal" style="max-width: 1000px;">
      <div class="modal-header">
        <h2>üöÄ Generate Landing Page</h2>
        <button class="modal-close" onclick="closeGenerateModal()">&times;</button>
      </div>
      <div class="modal-body">
        <!-- Step 1: Page Type Selection (shown by default) -->
        <div id="generateStep1">
          <p style="margin-bottom: 1.5rem; color: var(--text-medium);">Choose the type of page you want to create:</p>

          <div class="generate-options" style="grid-template-columns: repeat(5, 1fr);">
            <div class="generate-option" onclick="selectGenerateType('advertorial')" data-type="advertorial">
              <div class="generate-option-icon">üì∞</div>
              <h4>Advertorial</h4>
              <p>Editorial-style long-form sales page</p>
            </div>
            <div class="generate-option" onclick="selectGenerateType('listicle')" data-type="listicle">
              <div class="generate-option-icon">üìù</div>
              <h4>Listicle</h4>
              <p>Native ad disguised as helpful tips article</p>
            </div>
            <div class="generate-option" onclick="selectGenerateType('quiz')" data-type="quiz">
              <div class="generate-option-icon">‚ùì</div>
              <h4>Quiz Funnel</h4>
              <p>Interactive quiz with personalized results</p>
            </div>
            <div class="generate-option" onclick="selectGenerateType('vip')" data-type="vip">
              <div class="generate-option-icon">‚≠ê</div>
              <h4>VIP Signup</h4>
              <p>Exclusive waitlist or insider access page</p>
            </div>
            <div class="generate-option" onclick="selectGenerateType('calculator')" data-type="calculator">
              <div class="generate-option-icon">üßÆ</div>
              <h4>Calculator</h4>
              <p>Interactive savings or ROI calculator</p>
            </div>
          </div>

          <div class="form-group">
            <label for="generateProduct">Product/Offer URL or Description <span>*</span></label>
            <input type="text" id="generateProduct" placeholder="https://example.com/product or describe your offer...">
          </div>

          <div class="form-group">
            <label for="generateAudience">Target Audience</label>
            <textarea id="generateAudience" style="min-height: 80px;" placeholder="Describe your ideal customer..."></textarea>
          </div>

          <div class="form-group">
            <label for="generateTone">Tone & Style</label>
            <select id="generateTone">
              <option value="professional">Professional & Trustworthy</option>
              <option value="urgent">Urgent & Exciting</option>
              <option value="friendly">Friendly & Conversational</option>
              <option value="authoritative">Authoritative & Expert</option>
            </select>
          </div>
        </div>

        <!-- Step 2: Pipeline Progress (shown during generation) -->
        <div id="generateStep2" style="display: none;">
          <div class="pipeline-progress">
            <h3 style="margin-bottom: 1.5rem; text-align: center;">Generating Your Landing Page</h3>

            <div class="pipeline-steps">
              <div class="pipeline-step" data-step="research">
                <div class="step-indicator">
                  <div class="step-icon">üîç</div>
                  <div class="step-status"></div>
                </div>
                <div class="step-info">
                  <div class="step-name">Deep Research</div>
                  <div class="step-desc">Analyzing website and extracting business info</div>
                </div>
              </div>

              <div class="pipeline-step" data-step="brand">
                <div class="step-indicator">
                  <div class="step-icon">üé®</div>
                  <div class="step-status"></div>
                </div>
                <div class="step-info">
                  <div class="step-name">Brand Extraction</div>
                  <div class="step-desc">Extracting colors, fonts, and style guide</div>
                </div>
              </div>

              <div class="pipeline-step" data-step="strategy">
                <div class="step-indicator">
                  <div class="step-icon">üìã</div>
                  <div class="step-status"></div>
                </div>
                <div class="step-info">
                  <div class="step-name">Page Strategy</div>
                  <div class="step-desc">Creating page outline and messaging</div>
                </div>
              </div>

              <div class="pipeline-step" data-step="copy">
                <div class="step-indicator">
                  <div class="step-icon">‚úçÔ∏è</div>
                  <div class="step-status"></div>
                </div>
                <div class="step-info">
                  <div class="step-name">Copy Generation</div>
                  <div class="step-desc">Writing compelling, verified copy</div>
                </div>
              </div>

              <div class="pipeline-step" data-step="design">
                <div class="step-indicator">
                  <div class="step-icon">üñºÔ∏è</div>
                  <div class="step-status"></div>
                </div>
                <div class="step-info">
                  <div class="step-name">Design Generation</div>
                  <div class="step-desc">Building beautiful, on-brand HTML</div>
                </div>
              </div>

              <div class="pipeline-step" data-step="factcheck">
                <div class="step-indicator">
                  <div class="step-icon">‚úÖ</div>
                  <div class="step-status"></div>
                </div>
                <div class="step-info">
                  <div class="step-name">Fact Checking</div>
                  <div class="step-desc">Verifying all claims and statistics</div>
                </div>
              </div>

              <div class="pipeline-step" data-step="assembly">
                <div class="step-indicator">
                  <div class="step-icon">üèóÔ∏è</div>
                  <div class="step-status"></div>
                </div>
                <div class="step-info">
                  <div class="step-name">Final Assembly</div>
                  <div class="step-desc">QA checks and page finalization</div>
                </div>
              </div>
            </div>

            <div class="pipeline-summary" id="pipelineSummary" style="display: none;">
              <div class="summary-stats">
                <div class="summary-stat">
                  <span class="stat-label">Tokens Used:</span>
                  <span class="stat-value" id="summaryTokens">0</span>
                </div>
                <div class="summary-stat">
                  <span class="stat-label">Est. Cost:</span>
                  <span class="stat-value" id="summaryCost">$0.00</span>
                </div>
                <div class="summary-stat">
                  <span class="stat-label">Facts Verified:</span>
                  <span class="stat-value" id="summaryFacts">0</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" onclick="closeGenerateModal()" id="generateCancelBtn">Cancel</button>
        <button type="button" class="btn btn-primary" onclick="generatePageV2()" id="generateBtn">
          ‚ú® Generate Page
        </button>
      </div>
    </div>
  </div>

  <!-- Visual Editor Modal -->
  <div class="modal-overlay" id="editorModal">
    <div class="modal modal-large" style="max-width: 98vw; height: 95vh;">
      <div class="modal-header" style="padding: 0.75rem 1rem;">
        <h2 id="editorTitle" style="font-size: 1rem;">‚úèÔ∏è Edit Page</h2>
        <div style="display: flex; align-items: center; gap: 0.75rem;">
          <div class="device-toggle">
            <button class="device-btn active" onclick="setDevicePreview('desktop')" title="Desktop">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg>
            </button>
            <button class="device-btn" onclick="setDevicePreview('tablet')" title="Tablet">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="4" y="2" width="16" height="20" rx="2"/><line x1="12" y1="18" x2="12" y2="18"/></svg>
            </button>
            <button class="device-btn" onclick="setDevicePreview('mobile')" title="Mobile">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="6" y="2" width="12" height="20" rx="2"/><line x1="12" y1="18" x2="12" y2="18"/></svg>
            </button>
          </div>
          <button class="modal-close" onclick="closeEditorModal()">&times;</button>
        </div>
      </div>
      <div class="modal-body" style="padding: 0; height: calc(100% - 110px); overflow: hidden;">
        <div class="editor-container">
          <!-- Toolbar -->
          <div class="editor-toolbar">
            <!-- Text Formatting -->
            <div class="toolbar-group">
              <span class="toolbar-label">Text</span>
              <button class="toolbar-btn" onclick="editorCommand('bold')" title="Bold">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M6 4h8a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z"/><path d="M6 12h9a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z"/></svg>
              </button>
              <button class="toolbar-btn" onclick="editorCommand('italic')" title="Italic">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="19" y1="4" x2="10" y2="4"/><line x1="14" y1="20" x2="5" y2="20"/><line x1="15" y1="4" x2="9" y2="20"/></svg>
              </button>
              <button class="toolbar-btn" onclick="editorCommand('underline')" title="Underline">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 4v6a6 6 0 0 0 12 0V4"/><line x1="4" y1="20" x2="20" y2="20"/></svg>
              </button>
            </div>

            <!-- Headings -->
            <div class="toolbar-group">
              <select class="toolbar-select" onchange="editorHeading(this.value)" id="headingSelect">
                <option value="">Heading</option>
                <option value="h1">Heading 1</option>
                <option value="h2">Heading 2</option>
                <option value="h3">Heading 3</option>
                <option value="p">Paragraph</option>
              </select>
            </div>

            <!-- Font -->
            <div class="toolbar-group">
              <select class="toolbar-select" onchange="editorFont(this.value)" id="fontSelect">
                <option value="">Font</option>
                <option value="Arial, sans-serif">Arial</option>
                <option value="Georgia, serif">Georgia</option>
                <option value="'Times New Roman', serif">Times New Roman</option>
                <option value="Verdana, sans-serif">Verdana</option>
                <option value="'Courier New', monospace">Courier</option>
                <option value="'Trebuchet MS', sans-serif">Trebuchet</option>
                <option value="Impact, sans-serif">Impact</option>
              </select>
              <select class="toolbar-select" onchange="editorFontSize(this.value)" id="fontSizeSelect" style="min-width: 70px;">
                <option value="">Size</option>
                <option value="12px">12px</option>
                <option value="14px">14px</option>
                <option value="16px">16px</option>
                <option value="18px">18px</option>
                <option value="20px">20px</option>
                <option value="24px">24px</option>
                <option value="28px">28px</option>
                <option value="32px">32px</option>
                <option value="36px">36px</option>
                <option value="48px">48px</option>
              </select>
            </div>

            <!-- Colors -->
            <div class="toolbar-group">
              <span class="toolbar-label">Color</span>
              <input type="color" class="toolbar-color" id="textColorPicker" value="#000000" onchange="editorTextColor(this.value)" title="Text Color">
              <input type="color" class="toolbar-color" id="bgColorPicker" value="#ffffff" onchange="editorBgColor(this.value)" title="Background Color">
            </div>

            <!-- Alignment -->
            <div class="toolbar-group">
              <button class="toolbar-btn" onclick="editorCommand('justifyLeft')" title="Align Left">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="15" y2="12"/><line x1="3" y1="18" x2="18" y2="18"/></svg>
              </button>
              <button class="toolbar-btn" onclick="editorCommand('justifyCenter')" title="Align Center">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="6" x2="21" y2="6"/><line x1="6" y1="12" x2="18" y2="12"/><line x1="4" y1="18" x2="20" y2="18"/></svg>
              </button>
              <button class="toolbar-btn" onclick="editorCommand('justifyRight')" title="Align Right">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="6" x2="21" y2="6"/><line x1="9" y1="12" x2="21" y2="12"/><line x1="6" y1="18" x2="21" y2="18"/></svg>
              </button>
            </div>

            <!-- Lists -->
            <div class="toolbar-group">
              <button class="toolbar-btn" onclick="editorCommand('insertUnorderedList')" title="Bullet List">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="9" y1="6" x2="20" y2="6"/><line x1="9" y1="12" x2="20" y2="12"/><line x1="9" y1="18" x2="20" y2="18"/><circle cx="4" cy="6" r="1.5" fill="currentColor"/><circle cx="4" cy="12" r="1.5" fill="currentColor"/><circle cx="4" cy="18" r="1.5" fill="currentColor"/></svg>
              </button>
              <button class="toolbar-btn" onclick="editorCommand('insertOrderedList')" title="Numbered List">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="10" y1="6" x2="21" y2="6"/><line x1="10" y1="12" x2="21" y2="12"/><line x1="10" y1="18" x2="21" y2="18"/><text x="4" y="8" font-size="6" fill="currentColor">1</text><text x="4" y="14" font-size="6" fill="currentColor">2</text><text x="4" y="20" font-size="6" fill="currentColor">3</text></svg>
              </button>
            </div>

            <!-- Link & Image -->
            <div class="toolbar-group">
              <button class="toolbar-btn" onclick="openLinkEditor()" title="Insert Link">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>
              </button>
              <button class="toolbar-btn" onclick="openImageUpload()" title="Insert Image">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><path d="M21 15l-5-5L5 21"/></svg>
              </button>
            </div>

            <!-- Undo/Redo -->
            <div class="toolbar-group">
              <button class="toolbar-btn" onclick="editorCommand('undo')" title="Undo">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 7v6h6"/><path d="M3 13a9 9 0 1 0 2.636-6.364L3 9"/></svg>
              </button>
              <button class="toolbar-btn" onclick="editorCommand('redo')" title="Redo">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 7v6h-6"/><path d="M21 13a9 9 0 1 1-2.636-6.364L21 9"/></svg>
              </button>
            </div>
          </div>

          <!-- Main Editor Area -->
          <div class="editor-main">
            <!-- Preview Panel -->
            <div class="editor-preview-wrapper">
              <div class="preview-header">
                <span class="preview-dot red"></span>
                <span class="preview-dot yellow"></span>
                <span class="preview-dot green"></span>
                <span class="preview-url" id="previewUrl">Preview</span>
              </div>
              <div class="editor-iframe-container" id="iframeContainer">
                <iframe id="editorPreview"></iframe>
              </div>
            </div>

            <!-- Sidebar -->
            <div class="editor-sidebar">
              <!-- AI Chat Panel -->
              <div class="sidebar-panel">
                <div class="panel-header" onclick="togglePanel(this)">
                  <h4>üí¨ AI Assistant</h4>
                  <span class="panel-toggle">‚ñº</span>
                </div>
                <div class="panel-content">
                  <div class="chat-messages" id="chatMessages">
                    <div class="chat-message assistant">
                      Describe changes you want to make, like "change headline color to blue" or "make the button bigger"
                    </div>
                  </div>
                  <div class="chat-input-wrapper">
                    <textarea class="chat-input" id="chatInput" placeholder="Describe changes..." rows="2"></textarea>
                    <button class="btn btn-primary btn-icon" onclick="sendChatMessage()" id="chatSendBtn">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="22" y1="2" x2="11" y2="13"/>
                        <polygon points="22,2 15,22 11,13 2,9"/>
                      </svg>
                    </button>
                  </div>
                </div>
              </div>

              <!-- Quick Insert Panel -->
              <div class="sidebar-panel">
                <div class="panel-header" onclick="togglePanel(this)">
                  <h4>‚ûï Quick Insert</h4>
                  <span class="panel-toggle">‚ñº</span>
                </div>
                <div class="panel-content">
                  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;">
                    <button class="btn btn-secondary btn-small" onclick="insertElement('button')">Button</button>
                    <button class="btn btn-secondary btn-small" onclick="insertElement('heading')">Heading</button>
                    <button class="btn btn-secondary btn-small" onclick="insertElement('paragraph')">Paragraph</button>
                    <button class="btn btn-secondary btn-small" onclick="insertElement('divider')">Divider</button>
                    <button class="btn btn-secondary btn-small" onclick="insertElement('testimonial')">Testimonial</button>
                    <button class="btn btn-secondary btn-small" onclick="insertElement('cta')">CTA Section</button>
                  </div>
                </div>
              </div>

              <!-- Image Upload Panel -->
              <div class="sidebar-panel">
                <div class="panel-header" onclick="togglePanel(this)">
                  <h4>üñºÔ∏è Add Image</h4>
                  <span class="panel-toggle">‚ñº</span>
                </div>
                <div class="panel-content">
                  <div class="upload-zone" onclick="document.getElementById('imageUploadInput').click()">
                    <div class="upload-zone-icon">üìÅ</div>
                    <div class="upload-zone-text">Click to upload image</div>
                    <div class="upload-zone-hint">or paste URL below</div>
                  </div>
                  <input type="file" id="imageUploadInput" accept="image/*" style="display: none;" onchange="handleImageUpload(event)">
                  <div style="margin-top: 0.75rem;">
                    <input type="text" class="property-input" id="imageUrlInput" placeholder="https://example.com/image.jpg" style="width: 100%;">
                    <button class="btn btn-small btn-primary" style="width: 100%; margin-top: 0.5rem;" onclick="insertImageFromUrl()">Insert Image</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" onclick="closeEditorModal()">Cancel</button>
        <button type="button" class="btn btn-secondary" onclick="saveWithoutDeploy()" id="saveOnlyBtn">üíæ Save Draft</button>
        <button type="button" class="btn btn-success" onclick="saveAndDeploy()" id="saveDeployBtn">üöÄ Save & Deploy</button>
      </div>
    </div>
  </div>

  <!-- Link Editor Popup -->
  <div class="link-editor-backdrop" id="linkEditorBackdrop" onclick="closeLinkEditor()"></div>
  <div class="link-editor-popup" id="linkEditorPopup">
    <h4 style="margin-bottom: 1rem; font-weight: 600;">Insert Link</h4>
    <div class="form-group" style="margin-bottom: 1rem;">
      <label style="font-size: 0.8rem; margin-bottom: 0.25rem; display: block;">Link Text</label>
      <input type="text" id="linkText" class="property-input" style="width: 100%;" placeholder="Click here">
    </div>
    <div class="form-group" style="margin-bottom: 1rem;">
      <label style="font-size: 0.8rem; margin-bottom: 0.25rem; display: block;">URL</label>
      <input type="text" id="linkUrl" class="property-input" style="width: 100%;" placeholder="https://example.com">
    </div>
    <div class="form-group" style="margin-bottom: 1rem;">
      <label style="font-size: 0.8rem; display: flex; align-items: center; gap: 0.5rem;">
        <input type="checkbox" id="linkNewTab" checked> Open in new tab
      </label>
    </div>
    <div style="display: flex; gap: 0.5rem; justify-content: flex-end;">
      <button class="btn btn-secondary btn-small" onclick="closeLinkEditor()">Cancel</button>
      <button class="btn btn-primary btn-small" onclick="insertLink()">Insert Link</button>
    </div>
  </div>

  <script>
    // ============================================
    // GLOBALS
    // ============================================
    let currentPageId = null;
    let pages = [];
    let clients = [];
    let selectedGenerateType = null;
    let currentEditingPage = null;

    // ============================================
    // LOADING & INIT
    // ============================================
    window.addEventListener('load', () => {
      setTimeout(() => {
        document.getElementById('loadingScreen').classList.add('hidden');
      }, 1200);
      loadPages();
      loadClients();
    });

    // ============================================
    // CLIENT MANAGEMENT
    // ============================================
    async function loadClients() {
      try {
        const res = await fetch('/api/clients');
        const result = await res.json();
        if (result.success) {
          clients = result.clients || [];
          document.getElementById('navClientCount').textContent = clients.length;
        }
      } catch (error) {
        console.error('Failed to load clients:', error);
      }
    }

    function openAddClientModal() {
      const name = prompt('Enter client name:');
      if (!name) return;

      const url = prompt('Enter client website URL (optional):');
      createClient(name, url);
    }

    async function createClient(name, websiteUrl) {
      try {
        const res = await fetch('/api/clients', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ name, website_url: websiteUrl || null })
        });
        const result = await res.json();
        if (result.success) {
          alert('Client created! You can now generate pages for this client.');
          loadClients();
        } else {
          throw new Error(result.error);
        }
      } catch (error) {
        alert('Error creating client: ' + error.message);
      }
    }

    // ============================================
    // CURSOR EFFECT
    // ============================================
    const cursorGlow = document.getElementById('cursorGlow');
    const orbs = document.querySelectorAll('.bg-gradient-orb');

    document.addEventListener('mousemove', (e) => {
      cursorGlow.style.left = e.clientX + 'px';
      cursorGlow.style.top = e.clientY + 'px';
      cursorGlow.classList.add('active');

      const centerX = window.innerWidth / 2;
      const centerY = window.innerHeight / 2;
      const deltaX = (e.clientX - centerX) / centerX;
      const deltaY = (e.clientY - centerY) / centerY;

      if (orbs[0]) orbs[0].style.transform = `translate(${deltaX * 20}px, ${deltaY * 20}px)`;
      if (orbs[1]) orbs[1].style.transform = `translate(${-deltaX * 15}px, ${-deltaY * 15}px)`;
    });

    document.addEventListener('mouseleave', () => {
      cursorGlow.classList.remove('active');
    });

    // ============================================
    // SIDEBAR
    // ============================================
    function toggleSidebar() {
      document.getElementById('sidebar').classList.toggle('open');
      document.getElementById('sidebarOverlay').classList.toggle('active');
    }

    function closeSidebar() {
      document.getElementById('sidebar').classList.remove('open');
      document.getElementById('sidebarOverlay').classList.remove('active');
    }

    // ============================================
    // DATA LOADING
    // ============================================
    async function loadPages() {
      try {
        const res = await fetch('/api/pages');
        pages = await res.json();
        renderPages();
        updateStats();
      } catch (error) {
        console.error('Failed to load pages:', error);
      }
    }

    function updateStats() {
      document.getElementById('statPages').textContent = pages.length;
      document.getElementById('statLive').textContent = pages.filter(p => p.status === 'live').length;

      // Fix: Ensure view_count is parsed as integer
      const totalViews = pages.reduce((sum, p) => sum + (parseInt(p.view_count) || 0), 0);
      document.getElementById('statViews').textContent = formatNumber(totalViews);

      const totalLeads = pages.reduce((sum, p) => sum + (parseInt(p.lead_count) || 0), 0);
      document.getElementById('statLeads').textContent = formatNumber(totalLeads);

      document.getElementById('pageCount').textContent = pages.length;
      document.getElementById('navPageCount').textContent = pages.length;
    }

    function formatNumber(num) {
      if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
      if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
      return num.toString();
    }

    function renderPages() {
      const container = document.getElementById('pagesContainer');

      if (pages.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-illustration">ü¶Ñ</div>
            <h3>No landing pages yet</h3>
            <p>Create your first page by generating one with AI or importing HTML.</p>
            <button class="btn btn-primary" onclick="openGenerateModal()">Generate with AI</button>
          </div>
        `;
        return;
      }

      container.innerHTML = `
        <div class="pages-table-wrapper">
          <table class="pages-table">
            <thead>
              <tr>
                <th>Name</th>
                <th class="hide-mobile">Client</th>
                <th>Status</th>
                <th>Views</th>
                <th>Leads</th>
                <th class="hide-mobile">Conv.</th>
                <th class="hide-mobile">URL</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              ${pages.map(page => {
                const views = parseInt(page.view_count) || 0;
                const leads = parseInt(page.lead_count) || 0;
                const convRate = views > 0 ? ((leads / views) * 100).toFixed(1) + '%' : '‚Äî';
                const liveUrl = page.status === 'live' ? `${getBaseUrl()}/${page.slug}/` : null;

                return `
                  <tr>
                    <td>
                      <div class="page-name">
                        <strong>${escapeHtml(page.name)}</strong>
                        <small>${page.slug}</small>
                      </div>
                    </td>
                    <td class="hide-mobile">${escapeHtml(page.client_name || '‚Äî')}</td>
                    <td>
                      <span class="status-badge status-${page.status}">
                        <span class="dot"></span>
                        ${page.status === 'live' ? 'Live' : 'Draft'}
                      </span>
                    </td>
                    <td class="metric">${formatNumber(views)}</td>
                    <td class="metric">${formatNumber(leads)}</td>
                    <td class="hide-mobile metric">${convRate}</td>
                    <td class="hide-mobile">
                      ${liveUrl ? `<a href="${liveUrl}" target="_blank" class="page-link">${page.slug}</a>` : '<span class="metric-secondary">‚Äî</span>'}
                    </td>
                    <td>
                      <div class="actions">
                        <button class="btn btn-icon btn-ghost" onclick="openEditor('${page.id}')" title="Visual Edit">üé®</button>
                        <button class="btn btn-icon btn-ghost" onclick="openAnalytics('${page.id}')" title="Analytics">üìä</button>
                        <button class="btn btn-icon btn-ghost" onclick="editPage('${page.id}')" title="Edit HTML">‚úèÔ∏è</button>
                        ${page.status !== 'live' ? `<button class="btn btn-icon btn-ghost" onclick="quickDeploy('${page.id}')" title="Deploy" style="color: var(--success)">üöÄ</button>` : ''}
                        <button class="btn btn-icon btn-ghost" onclick="deletePage('${page.id}')" title="Delete" style="color: var(--error)">üóëÔ∏è</button>
                      </div>
                    </td>
                  </tr>
                `;
              }).join('')}
            </tbody>
          </table>
        </div>
      `;
    }

    function getBaseUrl() {
      return localStorage.getItem('pagesBaseUrl') || 'https://maxwellfinn.github.io/unicorn-landing-pages-live';
    }

    // ============================================
    // CREATE/EDIT MODAL
    // ============================================
    function openCreateModal() {
      document.getElementById('modalTitle').textContent = '‚ú® New Landing Page';
      document.getElementById('pageForm').reset();
      document.getElementById('pageId').value = '';
      document.getElementById('deployResult').innerHTML = '';
      document.getElementById('saveDraftBtn').style.display = 'inline-flex';
      document.getElementById('createModal').classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    function closeCreateModal() {
      document.getElementById('createModal').classList.remove('active');
      document.body.style.overflow = '';
    }

    async function editPage(id) {
      const page = pages.find(p => p.id === id);
      if (!page) return;

      document.getElementById('modalTitle').textContent = '‚úèÔ∏è Edit Landing Page';
      document.getElementById('pageId').value = page.id;
      document.getElementById('pageName').value = page.name;
      document.getElementById('clientName').value = page.client_name || '';
      document.getElementById('pageSlug').value = page.slug;
      document.getElementById('htmlContent').value = page.html_content;
      document.getElementById('metaTitle').value = page.meta_title || '';
      document.getElementById('metaDescription').value = page.meta_description || '';
      document.getElementById('trackingPixel').value = page.tracking_pixel || '';
      document.getElementById('deployResult').innerHTML = '';
      document.getElementById('saveDraftBtn').style.display = page.status === 'live' ? 'none' : 'inline-flex';

      document.getElementById('createModal').classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    async function saveDraft() {
      const id = document.getElementById('pageId').value;
      const data = getFormData();

      try {
        const url = id ? `/api/pages/${id}` : '/api/pages';
        const method = id ? 'PUT' : 'POST';

        const res = await fetch(url, { method, headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(data) });
        if (!res.ok) throw new Error((await res.json()).error);

        await loadPages();
        closeCreateModal();
      } catch (error) {
        alert('Error: ' + error.message);
      }
    }

    async function deployPage() {
      const btn = document.getElementById('deployBtn');
      const originalText = btn.innerHTML;
      btn.innerHTML = '<span class="loading-spinner"></span> Deploying...';
      btn.disabled = true;

      try {
        const data = getFormData();
        const id = document.getElementById('pageId').value;

        let res;
        if (id) {
          await fetch(`/api/pages/${id}`, { method: 'PUT', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(data) });
          res = await fetch(`/api/pages/${id}/deploy`, { method: 'POST' });
        } else {
          res = await fetch('/api/deploy', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(data) });
        }

        const result = await res.json();
        if (!res.ok) throw new Error(result.error);

        document.getElementById('deployResult').innerHTML = `
          <div class="deploy-result">
            <h4>‚úÖ Successfully Deployed!</h4>
            <p>Live at: <a href="${result.liveUrl}" target="_blank">${result.liveUrl}</a></p>
          </div>
        `;

        document.getElementById('pageId').value = result.page.id;
        document.getElementById('saveDraftBtn').style.display = 'none';

        await loadPages();

        // Auto-close after 2 seconds
        setTimeout(() => {
          closeCreateModal();
        }, 2000);

      } catch (error) {
        alert('Deployment failed: ' + error.message);
      } finally {
        btn.innerHTML = originalText;
        btn.disabled = false;
      }
    }

    // ============================================
    // PIPELINE GENERATION (V2)
    // ============================================
    let currentJobId = null;

    async function generatePageV2() {
      if (!selectedGenerateType) {
        alert('Please select a page type');
        return;
      }

      const product = document.getElementById('generateProduct').value.trim();
      if (!product) {
        alert('Please enter a product URL or description');
        return;
      }

      // Show pipeline progress
      document.getElementById('generateStep1').style.display = 'none';
      document.getElementById('generateStep2').style.display = 'block';
      document.getElementById('generateBtn').style.display = 'none';
      document.getElementById('generateCancelBtn').textContent = 'Running...';
      document.getElementById('generateCancelBtn').disabled = true;

      // Reset all steps to pending
      document.querySelectorAll('.pipeline-step').forEach(step => {
        step.classList.remove('running', 'completed', 'failed');
        step.classList.add('pending');
      });

      const pipelineSteps = ['research', 'brand', 'strategy', 'copy', 'design', 'factcheck', 'assembly'];

      try {
        // Step 1: Start the job
        const startRes = await fetch('/api/generate/start', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            page_type: selectedGenerateType,
            target_audience: document.getElementById('generateAudience').value.trim() || null,
            offer_details: `Tone: ${document.getElementById('generateTone').value}`,
            website_url: product.startsWith('http') ? product : null
          })
        });

        const startResult = await startRes.json();
        if (!startRes.ok) throw new Error(startResult.error);

        currentJobId = startResult.job.id;
        let totalTokens = 0;
        let verifiedFacts = 0;

        // Step 2: Run each step in sequence
        for (const stepName of pipelineSteps) {
          // Update UI to show this step is running
          const stepEl = document.querySelector(`.pipeline-step[data-step="${stepName}"]`);
          stepEl.classList.remove('pending');
          stepEl.classList.add('running');

          // Run the step
          const stepRes = await fetch(`/api/generate/${currentJobId}/step/${stepName}`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              url: product.startsWith('http') ? product : null,
              productName: !product.startsWith('http') ? product : null
            })
          });

          const stepResult = await stepRes.json();

          if (!stepRes.ok) {
            stepEl.classList.remove('running');
            stepEl.classList.add('failed');
            throw new Error(`${stepName} failed: ${stepResult.error}`);
          }

          // Mark step as completed
          stepEl.classList.remove('running');
          stepEl.classList.add('completed');

          // Update stats
          totalTokens += stepResult.tokens_used || 0;
          if (stepName === 'factcheck' && stepResult.result?.verified_count) {
            verifiedFacts = stepResult.result.verified_count;
          }

          // Update summary
          document.getElementById('summaryTokens').textContent = totalTokens.toLocaleString();
          document.getElementById('summaryCost').textContent = '$' + ((totalTokens / 1000000) * 9).toFixed(3);
          document.getElementById('summaryFacts').textContent = verifiedFacts;
          document.getElementById('pipelineSummary').style.display = 'block';
        }

        // Generation complete - get the final page
        const statusRes = await fetch(`/api/generate/${currentJobId}/status`);
        const statusResult = await statusRes.json();

        if (statusResult.job.page_id) {
          // Fetch the generated page
          const pageRes = await fetch(`/api/pages/${statusResult.job.page_id}`);
          const pageResult = await pageRes.json();

          if (pageResult.success) {
            // Close generate modal and open create modal with generated content
            closeGenerateModal();

            document.getElementById('modalTitle').textContent = '‚ú® New Landing Page (AI Generated)';
            document.getElementById('pageForm').reset();
            document.getElementById('pageId').value = pageResult.page.id;
            document.getElementById('pageName').value = pageResult.page.name;
            document.getElementById('pageSlug').value = pageResult.page.slug;
            document.getElementById('htmlContent').value = pageResult.page.html_content;
            document.getElementById('deployResult').innerHTML = `
              <div style="padding: 1rem; background: rgba(0, 184, 148, 0.1); border-radius: 8px; margin-bottom: 1rem; border: 1px solid var(--success);">
                <strong style="color: var(--success);">‚úì Page Generated Successfully!</strong><br>
                <small style="color: var(--text-medium);">Tokens used: ${totalTokens.toLocaleString()} | Estimated cost: $${((totalTokens / 1000000) * 9).toFixed(3)} | Facts verified: ${verifiedFacts}</small>
              </div>
            `;
            document.getElementById('saveDraftBtn').style.display = 'inline-flex';
            document.getElementById('createModal').classList.add('active');
            document.body.style.overflow = 'hidden';

            await loadPages();
          }
        }

      } catch (error) {
        alert('Generation failed: ' + error.message);
        resetGenerateModal();
      }
    }

    function resetGenerateModal() {
      document.getElementById('generateStep1').style.display = 'block';
      document.getElementById('generateStep2').style.display = 'none';
      document.getElementById('generateBtn').style.display = 'inline-flex';
      document.getElementById('generateBtn').innerHTML = '‚ú® Generate Page';
      document.getElementById('generateCancelBtn').textContent = 'Cancel';
      document.getElementById('generateCancelBtn').disabled = false;
      document.getElementById('pipelineSummary').style.display = 'none';
      currentJobId = null;
    }

    // Keep the old function for backwards compatibility
    async function generatePage() {
      return generatePageV2();
    }

    async function quickDeploy(id) {
      if (!confirm('Deploy this page live?')) return;

      try {
        const res = await fetch(`/api/pages/${id}/deploy`, { method: 'POST' });
        const result = await res.json();
        if (!res.ok) throw new Error(result.error);

        alert('Deployed! Live at: ' + result.liveUrl);
        await loadPages();
      } catch (error) {
        alert('Deployment failed: ' + error.message);
      }
    }

    async function deletePage(id) {
      if (!confirm('Delete this page? This cannot be undone.')) return;

      try {
        const res = await fetch(`/api/pages/${id}`, { method: 'DELETE' });
        if (!res.ok) throw new Error((await res.json()).error);
        await loadPages();
      } catch (error) {
        alert('Error: ' + error.message);
      }
    }

    function getFormData() {
      return {
        name: document.getElementById('pageName').value,
        client_name: document.getElementById('clientName').value || null,
        slug: document.getElementById('pageSlug').value || null,
        html_content: document.getElementById('htmlContent').value,
        meta_title: document.getElementById('metaTitle').value || null,
        meta_description: document.getElementById('metaDescription').value || null,
        tracking_pixel: document.getElementById('trackingPixel').value || null
      };
    }

    // ============================================
    // ANALYTICS MODAL
    // ============================================
    async function openAnalytics(id) {
      currentPageId = id;
      const page = pages.find(p => p.id === id);
      document.getElementById('analyticsTitle').textContent = `üìä Analytics: ${page?.name || 'Page'}`;
      document.getElementById('analyticsModal').classList.add('active');
      document.body.style.overflow = 'hidden';

      document.querySelectorAll('#analyticsModal .tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('#analyticsModal .tab-content').forEach(c => c.classList.remove('active'));
      document.querySelector('#analyticsModal .tab').classList.add('active');
      document.getElementById('tabOverview').classList.add('active');

      await loadAnalytics(id);
      await loadLeads(id);
      await loadABResults(id);
    }

    function closeAnalyticsModal() {
      document.getElementById('analyticsModal').classList.remove('active');
      document.body.style.overflow = '';
      currentPageId = null;
    }

    function switchTab(event, tab) {
      const modal = event.target.closest('.modal');
      modal.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      modal.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
      event.target.classList.add('active');
      document.getElementById(`tab${tab.charAt(0).toUpperCase() + tab.slice(1)}`).classList.add('active');
    }

    async function loadAnalytics(id) {
      try {
        const res = await fetch(`/api/pages/${id}/analytics`);
        const data = await res.json();

        document.getElementById('aViews').textContent = formatNumber(data.summary.total_views);
        document.getElementById('aLeads').textContent = formatNumber(data.summary.total_leads);
        document.getElementById('aConversion').textContent = data.summary.conversion_rate + '%';

        const sources = data.views_by_source || [];
        document.getElementById('trafficSources').innerHTML = sources.length > 0
          ? `<table class="leads-table"><thead><tr><th>Source</th><th>Views</th></tr></thead><tbody>${sources.map(s => `<tr><td>${escapeHtml(s.source)}</td><td class="metric">${formatNumber(s.views)}</td></tr>`).join('')}</tbody></table>`
          : '<p style="color: var(--text-light); text-align: center; padding: 2rem;">No traffic data yet</p>';
      } catch (error) {
        console.error('Failed to load analytics:', error);
      }
    }

    async function loadLeads(id) {
      try {
        const res = await fetch(`/api/pages/${id}/leads`);
        const leads = await res.json();

        document.getElementById('leadsTable').innerHTML = leads.length > 0
          ? `<table class="leads-table"><thead><tr><th>Date</th><th>Email</th><th>Name</th><th>Phone</th><th>Source</th></tr></thead><tbody>${leads.map(l => `<tr><td>${new Date(l.created_at).toLocaleDateString()}</td><td>${escapeHtml(l.email || '‚Äî')}</td><td>${escapeHtml(l.name || '‚Äî')}</td><td>${escapeHtml(l.phone || '‚Äî')}</td><td>${escapeHtml(l.utm_source || 'direct')}</td></tr>`).join('')}</tbody></table>`
          : '<p style="color: var(--text-light); text-align: center; padding: 2rem;">No leads yet</p>';
      } catch (error) {
        console.error('Failed to load leads:', error);
      }
    }

    async function loadABResults(id) {
      try {
        const res = await fetch(`/api/pages/${id}/ab-results`);
        const data = await res.json();
        const allVariants = [data.control, ...(data.variants || [])];

        document.getElementById('abtestResults').innerHTML = `<table class="leads-table"><thead><tr><th>Variant</th><th>Views</th><th>Conversions</th><th>Rate</th></tr></thead><tbody>${allVariants.map(v => `<tr><td>${escapeHtml(v.name || v.variant_name)}</td><td class="metric">${formatNumber(v.views)}</td><td class="metric">${formatNumber(v.conversions)}</td><td class="metric">${v.conversion_rate}%</td></tr>`).join('')}</tbody></table>`;
      } catch (error) {
        console.error('Failed to load A/B results:', error);
      }
    }

    function exportLeads() {
      if (currentPageId) window.open(`/api/pages/${currentPageId}/leads/export`, '_blank');
    }

    // ============================================
    // GENERATE PAGE MODAL
    // ============================================
    function openGenerateModal() {
      selectedGenerateType = null;
      document.querySelectorAll('.generate-option').forEach(el => el.classList.remove('selected'));
      document.getElementById('generateProduct').value = '';
      document.getElementById('generateAudience').value = '';
      document.getElementById('generateTone').value = 'professional';
      document.getElementById('generateModal').classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    function closeGenerateModal() {
      document.getElementById('generateModal').classList.remove('active');
      document.body.style.overflow = '';
      resetGenerateModal();
    }

    function selectGenerateType(type) {
      selectedGenerateType = type;
      document.querySelectorAll('.generate-option').forEach(el => {
        el.classList.toggle('selected', el.dataset.type === type);
      });
    }

    // ============================================
    // VISUAL EDITOR MODAL
    // ============================================
    let currentDeviceMode = 'desktop';

    function openEditor(id) {
      const page = pages.find(p => p.id === id);
      if (!page) return;

      currentEditingPage = { ...page }; // Clone to track changes
      document.getElementById('editorTitle').textContent = `‚úèÔ∏è Edit: ${page.name}`;
      document.getElementById('previewUrl').textContent = page.slug ? `/${page.slug}` : 'Preview';

      // Load page into iframe with contenteditable enabled
      const iframe = document.getElementById('editorPreview');
      const editableHtml = enableContentEditable(page.html_content);
      iframe.srcdoc = editableHtml;

      // Wait for iframe to load, then set up editing
      iframe.onload = () => {
        setupIframeEditing(iframe);
      };

      // Clear chat
      document.getElementById('chatMessages').innerHTML = `
        <div class="chat-message assistant">
          Click on any text in the preview to edit it directly. Use the toolbar or ask me to make changes!
        </div>
      `;

      document.getElementById('chatInput').value = '';
      document.getElementById('editorModal').classList.add('active');
      document.body.style.overflow = 'hidden';

      // Reset device preview
      setDevicePreview('desktop');
    }

    function enableContentEditable(html) {
      // Add script to enable contenteditable on text elements
      const editScript = `
        <script>
          document.addEventListener('DOMContentLoaded', function() {
            // Make text elements editable
            const editables = document.querySelectorAll('h1, h2, h3, h4, h5, h6, p, span, a, li, td, th, label, button');
            editables.forEach(el => {
              el.contentEditable = 'true';
              el.style.outline = 'none';
              el.addEventListener('focus', function() {
                this.style.outline = '2px solid #3B9FD8';
                this.style.outlineOffset = '2px';
              });
              el.addEventListener('blur', function() {
                this.style.outline = 'none';
                // Notify parent of changes
                window.parent.postMessage({ type: 'contentChanged' }, '*');
              });
            });

            // Track selection for toolbar
            document.addEventListener('selectionchange', function() {
              const selection = window.getSelection();
              if (selection.rangeCount > 0) {
                window.parent.postMessage({ type: 'selectionChanged' }, '*');
              }
            });
          });
        <\/script>
        <style>
          [contenteditable]:hover { outline: 1px dashed #3B9FD8 !important; cursor: text; }
          [contenteditable]:focus { outline: 2px solid #3B9FD8 !important; outline-offset: 2px; }
        </style>
      `;

      // Insert before closing </head> or </body>
      if (html.includes('</head>')) {
        return html.replace('</head>', editScript + '</head>');
      } else if (html.includes('</body>')) {
        return html.replace('</body>', editScript + '</body>');
      } else {
        return html + editScript;
      }
    }

    function setupIframeEditing(iframe) {
      // Listen for messages from iframe
      window.addEventListener('message', (event) => {
        if (event.data.type === 'contentChanged') {
          updateCurrentPageHtml();
        }
      });
    }

    function updateCurrentPageHtml() {
      if (!currentEditingPage) return;
      const iframe = document.getElementById('editorPreview');
      try {
        const doc = iframe.contentDocument || iframe.contentWindow.document;
        // Get the HTML and remove our editing scripts/styles
        let html = doc.documentElement.outerHTML;
        html = html.replace(/<script>[\s\S]*?document\.addEventListener\('DOMContentLoaded'[\s\S]*?<\/script>/gi, '');
        html = html.replace(/<style>\s*\[contenteditable\][\s\S]*?<\/style>/gi, '');
        // Remove contenteditable attributes
        html = html.replace(/\s*contenteditable="true"/gi, '');
        currentEditingPage.html_content = '<!DOCTYPE html>\n' + html;
      } catch (e) {
        console.error('Could not access iframe content:', e);
      }
    }

    function closeEditorModal() {
      document.getElementById('editorModal').classList.remove('active');
      document.body.style.overflow = '';
      currentEditingPage = null;
    }

    // Device Preview Toggle
    function setDevicePreview(device) {
      currentDeviceMode = device;
      const container = document.getElementById('iframeContainer');
      const iframe = document.getElementById('editorPreview');

      // Update button states
      document.querySelectorAll('.device-btn').forEach(btn => btn.classList.remove('active'));
      event.target.closest('.device-btn').classList.add('active');

      // Reset styles
      container.style.display = 'flex';
      container.style.justifyContent = 'center';
      container.style.background = device !== 'desktop' ? '#f0f0f0' : 'transparent';
      iframe.style.transition = 'width 0.3s ease';

      switch(device) {
        case 'mobile':
          iframe.style.width = '375px';
          iframe.style.maxWidth = '100%';
          iframe.style.boxShadow = '0 0 20px rgba(0,0,0,0.1)';
          break;
        case 'tablet':
          iframe.style.width = '768px';
          iframe.style.maxWidth = '100%';
          iframe.style.boxShadow = '0 0 20px rgba(0,0,0,0.1)';
          break;
        default:
          iframe.style.width = '100%';
          iframe.style.boxShadow = 'none';
      }
    }

    // Toolbar Panel Toggle
    function togglePanel(header) {
      header.classList.toggle('collapsed');
      const content = header.nextElementSibling;
      content.classList.toggle('collapsed');
    }

    // Editor Commands
    function editorCommand(command) {
      const iframe = document.getElementById('editorPreview');
      try {
        iframe.contentDocument.execCommand(command, false, null);
        updateCurrentPageHtml();
      } catch (e) {
        console.error('Editor command failed:', e);
      }
    }

    function editorHeading(tag) {
      if (!tag) return;
      const iframe = document.getElementById('editorPreview');
      try {
        iframe.contentDocument.execCommand('formatBlock', false, tag);
        updateCurrentPageHtml();
      } catch (e) {
        console.error('Heading command failed:', e);
      }
      document.getElementById('headingSelect').value = '';
    }

    function editorFont(font) {
      if (!font) return;
      const iframe = document.getElementById('editorPreview');
      try {
        const selection = iframe.contentWindow.getSelection();
        if (selection.rangeCount > 0) {
          const range = selection.getRangeAt(0);
          const span = iframe.contentDocument.createElement('span');
          span.style.fontFamily = font;
          range.surroundContents(span);
          updateCurrentPageHtml();
        }
      } catch (e) {
        console.error('Font command failed:', e);
      }
      document.getElementById('fontSelect').value = '';
    }

    function editorFontSize(size) {
      if (!size) return;
      const iframe = document.getElementById('editorPreview');
      try {
        const selection = iframe.contentWindow.getSelection();
        if (selection.rangeCount > 0) {
          const range = selection.getRangeAt(0);
          const span = iframe.contentDocument.createElement('span');
          span.style.fontSize = size;
          range.surroundContents(span);
          updateCurrentPageHtml();
        }
      } catch (e) {
        console.error('Font size command failed:', e);
      }
      document.getElementById('fontSizeSelect').value = '';
    }

    function editorTextColor(color) {
      const iframe = document.getElementById('editorPreview');
      try {
        iframe.contentDocument.execCommand('foreColor', false, color);
        updateCurrentPageHtml();
      } catch (e) {
        console.error('Text color command failed:', e);
      }
    }

    function editorBgColor(color) {
      const iframe = document.getElementById('editorPreview');
      try {
        iframe.contentDocument.execCommand('hiliteColor', false, color);
        updateCurrentPageHtml();
      } catch (e) {
        console.error('Background color command failed:', e);
      }
    }

    // Link Editor
    function openLinkEditor() {
      const iframe = document.getElementById('editorPreview');
      const selection = iframe.contentWindow.getSelection();
      if (selection.rangeCount > 0) {
        document.getElementById('linkText').value = selection.toString() || '';
      }
      document.getElementById('linkUrl').value = '';
      document.getElementById('linkNewTab').checked = true;
      document.getElementById('linkEditorBackdrop').classList.add('active');
      document.getElementById('linkEditorPopup').classList.add('active');
    }

    function closeLinkEditor() {
      document.getElementById('linkEditorBackdrop').classList.remove('active');
      document.getElementById('linkEditorPopup').classList.remove('active');
    }

    function insertLink() {
      const text = document.getElementById('linkText').value;
      const url = document.getElementById('linkUrl').value;
      const newTab = document.getElementById('linkNewTab').checked;

      if (!url) {
        alert('Please enter a URL');
        return;
      }

      const iframe = document.getElementById('editorPreview');
      try {
        const selection = iframe.contentWindow.getSelection();
        if (selection.rangeCount > 0) {
          const range = selection.getRangeAt(0);
          range.deleteContents();

          const link = iframe.contentDocument.createElement('a');
          link.href = url;
          link.textContent = text || url;
          if (newTab) {
            link.target = '_blank';
            link.rel = 'noopener noreferrer';
          }
          link.contentEditable = 'true';
          range.insertNode(link);
          updateCurrentPageHtml();
        }
      } catch (e) {
        console.error('Insert link failed:', e);
      }

      closeLinkEditor();
    }

    // Image Upload
    function openImageUpload() {
      document.getElementById('imageUploadInput').click();
    }

    function handleImageUpload(event) {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = (e) => {
        insertImageToEditor(e.target.result);
      };
      reader.readAsDataURL(file);
    }

    function insertImageFromUrl() {
      const url = document.getElementById('imageUrlInput').value.trim();
      if (!url) {
        alert('Please enter an image URL');
        return;
      }
      insertImageToEditor(url);
      document.getElementById('imageUrlInput').value = '';
    }

    function insertImageToEditor(src) {
      const iframe = document.getElementById('editorPreview');
      try {
        const selection = iframe.contentWindow.getSelection();
        if (selection.rangeCount > 0) {
          const range = selection.getRangeAt(0);
          const img = iframe.contentDocument.createElement('img');
          img.src = src;
          img.style.maxWidth = '100%';
          img.style.height = 'auto';
          range.insertNode(img);
          updateCurrentPageHtml();
        } else {
          // Insert at end of body if no selection
          const body = iframe.contentDocument.body;
          const img = iframe.contentDocument.createElement('img');
          img.src = src;
          img.style.maxWidth = '100%';
          img.style.height = 'auto';
          body.appendChild(img);
          updateCurrentPageHtml();
        }
      } catch (e) {
        console.error('Insert image failed:', e);
      }
    }

    // Quick Insert Elements
    function insertElement(type) {
      const iframe = document.getElementById('editorPreview');
      let html = '';

      switch(type) {
        case 'button':
          html = '<a href="#" style="display: inline-block; padding: 12px 24px; background: #3B9FD8; color: white; text-decoration: none; border-radius: 6px; font-weight: 600;">Click Here</a>';
          break;
        case 'heading':
          html = '<h2 style="font-size: 2rem; font-weight: 700; margin: 1rem 0;">New Heading</h2>';
          break;
        case 'paragraph':
          html = '<p style="font-size: 1rem; line-height: 1.6; margin: 1rem 0;">Add your paragraph text here. Click to edit.</p>';
          break;
        case 'divider':
          html = '<hr style="border: none; height: 1px; background: #e0e0e0; margin: 2rem 0;">';
          break;
        case 'testimonial':
          html = `<blockquote style="padding: 1.5rem; background: #f9f9f9; border-left: 4px solid #3B9FD8; margin: 1.5rem 0; border-radius: 0 8px 8px 0;">
            <p style="font-style: italic; margin-bottom: 0.5rem;">"This product changed my life! Highly recommended."</p>
            <footer style="font-weight: 600; color: #666;">‚Äî Happy Customer</footer>
          </blockquote>`;
          break;
        case 'cta':
          html = `<div style="text-align: center; padding: 3rem 2rem; background: linear-gradient(135deg, #3B9FD8 0%, #2d7fb0 100%); border-radius: 12px; margin: 2rem 0;">
            <h3 style="color: white; font-size: 1.75rem; margin-bottom: 0.5rem;">Ready to Get Started?</h3>
            <p style="color: rgba(255,255,255,0.9); margin-bottom: 1.5rem;">Join thousands of satisfied customers today.</p>
            <a href="#" style="display: inline-block; padding: 14px 32px; background: white; color: #3B9FD8; text-decoration: none; border-radius: 8px; font-weight: 700;">Get Started Now</a>
          </div>`;
          break;
      }

      try {
        const body = iframe.contentDocument.body;
        const div = iframe.contentDocument.createElement('div');
        div.innerHTML = html;
        body.appendChild(div.firstElementChild || div);
        updateCurrentPageHtml();
      } catch (e) {
        console.error('Insert element failed:', e);
      }
    }

    // Save Draft Only
    async function saveWithoutDeploy() {
      if (!currentEditingPage) return;

      updateCurrentPageHtml();
      const btn = document.getElementById('saveOnlyBtn');
      btn.innerHTML = '<span class="loading-spinner"></span> Saving...';
      btn.disabled = true;

      try {
        await fetch(`/api/pages/${currentEditingPage.id}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            name: currentEditingPage.name,
            html_content: currentEditingPage.html_content,
            client_name: currentEditingPage.client_name,
            slug: currentEditingPage.slug,
            meta_title: currentEditingPage.meta_title,
            meta_description: currentEditingPage.meta_description,
            tracking_pixel: currentEditingPage.tracking_pixel
          })
        });

        await loadPages();
        alert('Draft saved successfully!');
      } catch (error) {
        alert('Save failed: ' + error.message);
      } finally {
        btn.innerHTML = 'üíæ Save Draft';
        btn.disabled = false;
      }
    }

    async function sendChatMessage() {
      const input = document.getElementById('chatInput');
      const message = input.value.trim();
      if (!message || !currentEditingPage) return;

      const chatMessages = document.getElementById('chatMessages');
      const sendBtn = document.getElementById('chatSendBtn');

      // Add user message
      chatMessages.innerHTML += `<div class="chat-message user">${escapeHtml(message)}</div>`;
      input.value = '';

      // Add loading message
      chatMessages.innerHTML += `<div class="chat-message assistant" id="chatLoading"><span class="loading-spinner" style="border-color: rgba(59,159,216,0.3); border-top-color: var(--primary-blue);"></span> Making changes...</div>`;
      chatMessages.scrollTop = chatMessages.scrollHeight;

      // Disable input
      sendBtn.disabled = true;
      input.disabled = true;

      try {
        // Get current HTML from iframe
        const iframe = document.getElementById('editorPreview');
        const currentHtml = iframe.srcdoc;

        const res = await fetch('/api/chat', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            message: message,
            currentHtml: currentHtml,
            pageContext: {
              name: currentEditingPage.name,
              client_name: currentEditingPage.client_name
            }
          })
        });

        const result = await res.json();

        // Remove loading message
        document.getElementById('chatLoading')?.remove();

        if (!res.ok) throw new Error(result.error);

        // Update iframe with new HTML
        iframe.srcdoc = result.html;

        // Update the stored page HTML
        currentEditingPage.html_content = result.html;

        // Add success message
        chatMessages.innerHTML += `
          <div class="chat-message assistant">
            ${escapeHtml(result.message)}
          </div>
        `;

      } catch (error) {
        // Remove loading message
        document.getElementById('chatLoading')?.remove();

        chatMessages.innerHTML += `
          <div class="chat-message assistant" style="border-color: var(--error); background: rgba(225,112,85,0.05);">
            Sorry, I encountered an error: ${escapeHtml(error.message)}
          </div>
        `;
      } finally {
        sendBtn.disabled = false;
        input.disabled = false;
        input.focus();
        chatMessages.scrollTop = chatMessages.scrollHeight;
      }
    }

    // Handle Enter key in chat
    document.addEventListener('DOMContentLoaded', () => {
      const chatInput = document.getElementById('chatInput');
      if (chatInput) {
        chatInput.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            sendChatMessage();
          }
        });
      }
    });

    async function saveAndDeploy() {
      if (!currentEditingPage) return;

      // Get latest changes from iframe
      updateCurrentPageHtml();

      const btn = document.getElementById('saveDeployBtn');
      btn.innerHTML = '<span class="loading-spinner"></span> Saving & Deploying...';
      btn.disabled = true;

      try {
        // First save the updated HTML
        await fetch(`/api/pages/${currentEditingPage.id}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            name: currentEditingPage.name,
            html_content: currentEditingPage.html_content,
            client_name: currentEditingPage.client_name,
            slug: currentEditingPage.slug,
            meta_title: currentEditingPage.meta_title,
            meta_description: currentEditingPage.meta_description,
            tracking_pixel: currentEditingPage.tracking_pixel
          })
        });

        // Then deploy
        const res = await fetch(`/api/pages/${currentEditingPage.id}/deploy`, { method: 'POST' });
        const result = await res.json();
        if (!res.ok) throw new Error(result.error);

        await loadPages();

        alert('Page saved and deployed! Live at: ' + result.liveUrl);
        closeEditorModal();
      } catch (error) {
        alert('Deployment failed: ' + error.message);
      } finally {
        btn.innerHTML = 'üöÄ Save & Deploy';
        btn.disabled = false;
      }
    }

    // ============================================
    // UTILITIES
    // ============================================
    function escapeHtml(text) {
      if (!text) return '';
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // Close modals on escape
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        closeLinkEditor();
        closeCreateModal();
        closeAnalyticsModal();
        closeGenerateModal();
        closeEditorModal();
      }
    });

    // Close modals on overlay click
    document.querySelectorAll('.modal-overlay').forEach(overlay => {
      overlay.addEventListener('click', (e) => {
        if (e.target === overlay) {
          closeCreateModal();
          closeAnalyticsModal();
          closeGenerateModal();
          closeEditorModal();
        }
      });
    });
  </script>
</body>
</html>
